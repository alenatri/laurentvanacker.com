**********************
Windows PowerShell transcript start
Start time: 20191213085323
Username: LAVANACK09\lavanack
RunAs User: LAVANACK09\lavanack
Configuration Name: 
Machine: LAVANACK09 (Microsoft Windows NT 10.0.18363.0)
Host Application: C:\WINDOWS\system32\WindowsPowerShell\v1.0\PowerShell_ISE.exe
Process ID: 9612
PSVersion: 5.1.18362.145
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.18362.145
BuildVersion: 10.0.18362.145
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Users\lavanack\OneDrive - Microsoft\Source Control\GitHub\laurentvanacker.com\PowerShell\IIS\AutomatedLab\NLB & IIS\AutomatedLab - NLB & IIS_20191213085323.txt
VERBOSE: [08:53:30][AutomatedLabUnattended.psm1] Importing from 2 folders
VERBOSE: Exporting function 'Add-UnattendedNetworkAdapter'.
VERBOSE: Exporting function 'Add-UnattendedRenameNetworkAdapters'.
VERBOSE: Exporting function 'Add-UnattendedSynchronousCommand'.
VERBOSE: Exporting function 'Export-UnattendedFile'.
VERBOSE: Exporting function 'Get-UnattendedContent'.
VERBOSE: Exporting function 'Import-UnattendedContent'.
VERBOSE: Exporting function 'Set-UnattendedAdministratorName'.
VERBOSE: Exporting function 'Set-UnattendedAdministratorPassword'.
VERBOSE: Exporting function 'Set-UnattendedAntiMalware'.
VERBOSE: Exporting function 'Set-UnattendedAutoLogon'.
VERBOSE: Exporting function 'Set-UnattendedComputerName'.
VERBOSE: Exporting function 'Set-UnattendedDomain'.
VERBOSE: Exporting function 'Set-UnattendedFirewallState'.
VERBOSE: Exporting function 'Set-UnattendedIpSettings'.
VERBOSE: Exporting function 'Set-UnattendedLocalIntranetSites'.
VERBOSE: Exporting function 'Set-UnattendedPackage'.
VERBOSE: Exporting function 'Set-UnattendedProductKey'.
VERBOSE: Exporting function 'Set-UnattendedTimeZone'.
VERBOSE: Exporting function 'Set-UnattendedUserLocale'.
VERBOSE: Exporting function 'Set-UnattendedWorkgroup'.
VERBOSE: Importing function 'Add-UnattendedNetworkAdapter'.
VERBOSE: Importing function 'Add-UnattendedRenameNetworkAdapters'.
VERBOSE: Importing function 'Add-UnattendedSynchronousCommand'.
VERBOSE: Importing function 'Export-UnattendedFile'.
VERBOSE: Importing function 'Get-UnattendedContent'.
VERBOSE: Importing function 'Import-UnattendedContent'.
VERBOSE: Importing function 'Set-UnattendedAdministratorName'.
VERBOSE: Importing function 'Set-UnattendedAdministratorPassword'.
VERBOSE: Importing function 'Set-UnattendedAntiMalware'.
VERBOSE: Importing function 'Set-UnattendedAutoLogon'.
VERBOSE: Importing function 'Set-UnattendedComputerName'.
VERBOSE: Importing function 'Set-UnattendedDomain'.
VERBOSE: Importing function 'Set-UnattendedFirewallState'.
VERBOSE: Importing function 'Set-UnattendedIpSettings'.
VERBOSE: Importing function 'Set-UnattendedLocalIntranetSites'.
VERBOSE: Importing function 'Set-UnattendedPackage'.
VERBOSE: Importing function 'Set-UnattendedProductKey'.
VERBOSE: Importing function 'Set-UnattendedTimeZone'.
VERBOSE: Importing function 'Set-UnattendedUserLocale'.
VERBOSE: Importing function 'Set-UnattendedWorkgroup'.
VERBOSE: Populating RepositorySourceLocation property for module AutomatedLabDefinition.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabDefinition\5.16.0\AutomatedLabDefinitionNetwork.psm1'.
VERBOSE: Exporting function 'Add-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'Get-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'Remove-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'New-LabNetworkAdapterDefinition'.
VERBOSE: Importing function 'Add-LabVirtualNetworkDefinition'.
VERBOSE: Importing function 'Get-LabVirtualNetworkDefinition'.
VERBOSE: Importing function 'New-LabNetworkAdapterDefinition'.
VERBOSE: Importing function 'Remove-LabVirtualNetworkDefinition'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabDefinition\5.16.0\AutomatedLabDefinitionAzureServices.psm1'.
VERBOSE: Exporting function 'Add-LabAzureWebAppDefinition'.
VERBOSE: Exporting function 'Get-LabAzureWebAppDefinition'.
VERBOSE: Exporting function 'Add-LabAzureAppServicePlanDefinition'.
VERBOSE: Exporting function 'Get-LabAzureAppServicePlanDefinition'.
VERBOSE: Importing function 'Add-LabAzureAppServicePlanDefinition'.
VERBOSE: Importing function 'Add-LabAzureWebAppDefinition'.
VERBOSE: Importing function 'Get-LabAzureAppServicePlanDefinition'.
VERBOSE: Importing function 'Get-LabAzureWebAppDefinition'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabDefinition\5.16.0\AutomatedLabDefinition.psm1'.
VERBOSE: Exporting function 'Add-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'Get-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'New-LabNetworkAdapterDefinition'.
VERBOSE: Exporting function 'Remove-LabVirtualNetworkDefinition'.
VERBOSE: Exporting function 'Add-LabAzureAppServicePlanDefinition'.
VERBOSE: Exporting function 'Add-LabAzureWebAppDefinition'.
VERBOSE: Exporting function 'Get-LabAzureAppServicePlanDefinition'.
VERBOSE: Exporting function 'Get-LabAzureWebAppDefinition'.
VERBOSE: Exporting function 'Get-LabVolumesOnPhysicalDisks'.
VERBOSE: Exporting function 'Get-LabFreeDiskSpace'.
VERBOSE: Exporting function 'New-LabDefinition'.
VERBOSE: Exporting function 'Get-LabDefinition'.
VERBOSE: Exporting function 'Set-LabDefinition'.
VERBOSE: Exporting function 'Export-LabDefinition'.
VERBOSE: Exporting function 'Test-LabDefinition'.
VERBOSE: Exporting function 'Add-LabDomainDefinition'.
VERBOSE: Exporting function 'Get-LabDomainDefinition'.
VERBOSE: Exporting function 'Remove-LabDomainDefinition'.
VERBOSE: Exporting function 'Add-LabIsoImageDefinition'.
VERBOSE: Exporting function 'Get-LabIsoImageDefinition'.
VERBOSE: Exporting function 'Remove-LabIsoImageDefinition'.
VERBOSE: Exporting function 'Add-LabDiskDefinition'.
VERBOSE: Exporting function 'Add-LabMachineDefinition'.
VERBOSE: Exporting function 'Get-LabMachineDefinition'.
VERBOSE: Exporting function 'Remove-LabMachineDefinition'.
VERBOSE: Exporting function 'Get-LabMachineRoleDefinition'.
VERBOSE: Exporting function 'Get-LabPostInstallationActivity'.
VERBOSE: Exporting function 'Get-DiskSpeed'.
VERBOSE: Exporting function 'Set-LabLocalVirtualMachineDiskAuto'.
VERBOSE: Exporting function 'Get-LabVirtualNetwork'.
VERBOSE: Exporting function 'Get-LabAvailableAddresseSpace'.
VERBOSE: Exporting function 'Repair-LabDuplicateIpAddresses'.
VERBOSE: Exporting function 'Set-LinuxPackage'.
VERBOSE: Importing function 'Add-LabAzureAppServicePlanDefinition'.
VERBOSE: Importing function 'Add-LabAzureWebAppDefinition'.
VERBOSE: Importing function 'Add-LabDiskDefinition'.
VERBOSE: Importing function 'Add-LabDomainDefinition'.
VERBOSE: Importing function 'Add-LabIsoImageDefinition'.
VERBOSE: Importing function 'Add-LabMachineDefinition'.
VERBOSE: Importing function 'Add-LabVirtualNetworkDefinition'.
VERBOSE: Importing function 'Export-LabDefinition'.
VERBOSE: Importing function 'Get-DiskSpeed'.
VERBOSE: Importing function 'Get-LabAvailableAddresseSpace'.
VERBOSE: Importing function 'Get-LabAzureAppServicePlanDefinition'.
VERBOSE: Importing function 'Get-LabAzureWebAppDefinition'.
VERBOSE: Importing function 'Get-LabDefinition'.
VERBOSE: Importing function 'Get-LabDomainDefinition'.
VERBOSE: Importing function 'Get-LabIsoImageDefinition'.
VERBOSE: Importing function 'Get-LabMachineDefinition'.
VERBOSE: Importing function 'Get-LabMachineRoleDefinition'.
VERBOSE: Importing function 'Get-LabPostInstallationActivity'.
VERBOSE: Importing function 'Get-LabVirtualNetwork'.
VERBOSE: Importing function 'Get-LabVirtualNetworkDefinition'.
VERBOSE: Importing function 'Get-LabVolumesOnPhysicalDisks'.
VERBOSE: Importing function 'New-LabDefinition'.
VERBOSE: Importing function 'New-LabNetworkAdapterDefinition'.
VERBOSE: Importing function 'Remove-LabDomainDefinition'.
VERBOSE: Importing function 'Remove-LabIsoImageDefinition'.
VERBOSE: Importing function 'Remove-LabMachineDefinition'.
VERBOSE: Importing function 'Remove-LabVirtualNetworkDefinition'.
VERBOSE: Importing function 'Repair-LabDuplicateIpAddresses'.
VERBOSE: Importing function 'Set-LabDefinition'.
VERBOSE: Importing function 'Set-LabLocalVirtualMachineDiskAuto'.
VERBOSE: Importing function 'Test-LabDefinition'.
VERBOSE: Populating RepositorySourceLocation property for module AutomatedLab.Common.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLab.Common\2.0.178\AutomatedLab.Common.psm1'.
VERBOSE: Exporting function 'Add-AccountPrivilege'.
VERBOSE: Exporting function 'Add-FunctionToPSSession'.
VERBOSE: Exporting function 'Add-StringIncrement'.
VERBOSE: Exporting function 'Add-VariableToPSSession'.
VERBOSE: Exporting function 'Get-ConsoleText'.
VERBOSE: Exporting function 'Get-DotNetFrameworkVersion'.
VERBOSE: Exporting function 'Get-FullMesh'.
VERBOSE: Exporting function 'Get-RunspacePool'.
VERBOSE: Exporting function 'Get-StringSection'.
VERBOSE: Exporting function 'Get-Type'.
VERBOSE: Exporting function 'Install-SoftwarePackage'.
VERBOSE: Exporting function 'Invoke-Ternary'.
VERBOSE: Exporting function 'New-RunspacePool'.
VERBOSE: Exporting function 'Read-Choice'.
VERBOSE: Exporting function 'Read-HashTable'.
VERBOSE: Exporting function 'Receive-RunspaceJob'.
VERBOSE: Exporting function 'Remove-RunspacePool'.
VERBOSE: Exporting function 'Send-ModuleToPSSession'.
VERBOSE: Exporting function 'Split-Array'.
VERBOSE: Exporting function 'Start-RunspaceJob'.
VERBOSE: Exporting function 'Sync-Parameter'.
VERBOSE: Exporting function 'Test-HashtableKeys'.
VERBOSE: Exporting function 'Test-IsAdministrator'.
VERBOSE: Exporting function 'Wait-RunspaceJob'.
VERBOSE: Exporting function 'Get-DscConfigurationImportedResource'.
VERBOSE: Exporting function 'ConvertTo-BinaryIP'.
VERBOSE: Exporting function 'ConvertTo-DecimalIP'.
VERBOSE: Exporting function 'ConvertTo-DottedDecimalIP'.
VERBOSE: Exporting function 'ConvertTo-Mask'.
VERBOSE: Exporting function 'ConvertTo-MaskLength'.
VERBOSE: Exporting function 'Get-BroadcastAddress'.
VERBOSE: Exporting function 'Get-NetworkAddress'.
VERBOSE: Exporting function 'Get-NetworkRange'.
VERBOSE: Exporting function 'Get-NetworkSummary'.
VERBOSE: Exporting function 'Get-PublicIpAddress'.
VERBOSE: Exporting function 'Test-Port'.
VERBOSE: Exporting function 'Get-PerformanceCounterID'.
VERBOSE: Exporting function 'Get-PerformanceCounterLocalName'.
VERBOSE: Exporting function 'Get-PerformanceDataCollectorSet'.
VERBOSE: Exporting function 'New-PerformanceDataCollectorSet'.
VERBOSE: Exporting function 'Remove-PerformanceDataCollectorSet'.
VERBOSE: Exporting function 'Start-PerformanceDataCollectorSet'.
VERBOSE: Exporting function 'Stop-PerformanceDataCollectorSet'.
VERBOSE: Exporting function 'Add-CATemplateStandardPermission'.
VERBOSE: Exporting function 'Add-Certificate2'.
VERBOSE: Exporting function 'Enable-AutoEnrollment'.
VERBOSE: Exporting function 'Find-CertificateAuthority'.
VERBOSE: Exporting function 'Get-CATemplate'.
VERBOSE: Exporting function 'Get-Certificate2'.
VERBOSE: Exporting function 'Get-NextOid'.
VERBOSE: Exporting function 'New-CATemplate'.
VERBOSE: Exporting function 'Publish-CaTemplate'.
VERBOSE: Exporting function 'Request-Certificate'.
VERBOSE: Exporting function 'Test-CATemplate'.
VERBOSE: Exporting function 'Get-TfsAccessTokenString'.
VERBOSE: Exporting function 'Get-TfsAgentPool'.
VERBOSE: Exporting function 'Get-TfsAgentQueue'.
VERBOSE: Exporting function 'Get-TfsBuildDefinition'.
VERBOSE: Exporting function 'Get-TfsBuildDefinitionTemplate'.
VERBOSE: Exporting function 'Get-TfsBuildStep'.
VERBOSE: Exporting function 'Get-TfsGitRepository'.
VERBOSE: Exporting function 'Get-TfsProcessTemplate'.
VERBOSE: Exporting function 'Get-TfsProject'.
VERBOSE: Exporting function 'Get-TfsReleaseDefinition'.
VERBOSE: Exporting function 'Get-TfsReleaseStep'.
VERBOSE: Exporting function 'New-TfsAgentQueue'.
VERBOSE: Exporting function 'New-TfsBuildDefinition'.
VERBOSE: Exporting function 'New-TfsProject'.
VERBOSE: Exporting function 'New-TfsReleaseDefinition'.
VERBOSE: Exporting function 'Set-TfsProject'.
VERBOSE: Importing function 'Add-AccountPrivilege'.
VERBOSE: Importing function 'Add-CATemplateStandardPermission'.
VERBOSE: Importing function 'Add-Certificate2'.
VERBOSE: Importing function 'Add-FunctionToPSSession'.
VERBOSE: Importing function 'Add-StringIncrement'.
VERBOSE: Importing function 'Add-VariableToPSSession'.
VERBOSE: Importing function 'ConvertTo-BinaryIP'.
VERBOSE: Importing function 'ConvertTo-DecimalIP'.
VERBOSE: Importing function 'ConvertTo-DottedDecimalIP'.
VERBOSE: Importing function 'ConvertTo-Mask'.
VERBOSE: Importing function 'ConvertTo-MaskLength'.
VERBOSE: Importing function 'Enable-AutoEnrollment'.
VERBOSE: Importing function 'Find-CertificateAuthority'.
VERBOSE: Importing function 'Get-BroadcastAddress'.
VERBOSE: Importing function 'Get-CATemplate'.
VERBOSE: Importing function 'Get-Certificate2'.
VERBOSE: Importing function 'Get-ConsoleText'.
VERBOSE: Importing function 'Get-DotNetFrameworkVersion'.
VERBOSE: Importing function 'Get-DscConfigurationImportedResource'.
VERBOSE: Importing function 'Get-FullMesh'.
VERBOSE: Importing function 'Get-NetworkAddress'.
VERBOSE: Importing function 'Get-NetworkRange'.
VERBOSE: Importing function 'Get-NetworkSummary'.
VERBOSE: Importing function 'Get-NextOid'.
VERBOSE: Importing function 'Get-PerformanceCounterID'.
VERBOSE: Importing function 'Get-PerformanceCounterLocalName'.
VERBOSE: Importing function 'Get-PerformanceDataCollectorSet'.
VERBOSE: Importing function 'Get-PublicIpAddress'.
VERBOSE: Importing function 'Get-RunspacePool'.
VERBOSE: Importing function 'Get-StringSection'.
VERBOSE: Importing function 'Get-TfsAccessTokenString'.
VERBOSE: Importing function 'Get-TfsAgentPool'.
VERBOSE: Importing function 'Get-TfsAgentQueue'.
VERBOSE: Importing function 'Get-TfsBuildDefinition'.
VERBOSE: Importing function 'Get-TfsBuildDefinitionTemplate'.
VERBOSE: Importing function 'Get-TfsBuildStep'.
VERBOSE: Importing function 'Get-TfsGitRepository'.
VERBOSE: Importing function 'Get-TfsProcessTemplate'.
VERBOSE: Importing function 'Get-TfsProject'.
VERBOSE: Importing function 'Get-TfsReleaseDefinition'.
VERBOSE: Importing function 'Get-TfsReleaseStep'.
VERBOSE: Importing function 'Get-Type'.
VERBOSE: Importing function 'Install-SoftwarePackage'.
VERBOSE: Importing function 'Invoke-Ternary'.
VERBOSE: Importing function 'New-CATemplate'.
VERBOSE: Importing function 'New-PerformanceDataCollectorSet'.
VERBOSE: Importing function 'New-RunspacePool'.
VERBOSE: Importing function 'New-TfsAgentQueue'.
VERBOSE: Importing function 'New-TfsBuildDefinition'.
VERBOSE: Importing function 'New-TfsProject'.
VERBOSE: Importing function 'New-TfsReleaseDefinition'.
VERBOSE: Importing function 'Publish-CaTemplate'.
VERBOSE: Importing function 'Read-Choice'.
VERBOSE: Importing function 'Read-HashTable'.
VERBOSE: Importing function 'Receive-RunspaceJob'.
VERBOSE: Importing function 'Remove-PerformanceDataCollectorSet'.
VERBOSE: Importing function 'Remove-RunspacePool'.
VERBOSE: Importing function 'Request-Certificate'.
VERBOSE: Importing function 'Send-ModuleToPSSession'.
VERBOSE: Importing function 'Set-TfsProject'.
VERBOSE: Importing function 'Split-Array'.
VERBOSE: Importing function 'Start-PerformanceDataCollectorSet'.
VERBOSE: Importing function 'Start-RunspaceJob'.
VERBOSE: Importing function 'Stop-PerformanceDataCollectorSet'.
VERBOSE: Importing function 'Sync-Parameter'.
VERBOSE: Importing function 'Test-CATemplate'.
VERBOSE: Importing function 'Test-HashtableKeys'.
VERBOSE: Importing function 'Test-IsAdministrator'.
VERBOSE: Importing function 'Test-Port'.
VERBOSE: Importing function 'Wait-RunspaceJob'.
VERBOSE: Populating RepositorySourceLocation property for module AutomatedLabWorker.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorkerInternals.psm1'.
VERBOSE: Exporting function 'Test-IpInSameSameNetwork'.
VERBOSE: Importing function 'Test-IpInSameSameNetwork'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorkerADCS.psm1'.
VERBOSE: Exporting function 'Install-LWLabCAServers'.
VERBOSE: Exporting function 'Install-LWLabCAServers2008'.
VERBOSE: Importing function 'Install-LWLabCAServers'.
VERBOSE: Importing function 'Install-LWLabCAServers2008'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorkerDisks.psm1'.
VERBOSE: Exporting function 'New-LWReferenceVHDX'.
VERBOSE: Exporting function 'New-LWVHDX'.
VERBOSE: Exporting function 'Remove-LWVHDX'.
VERBOSE: Exporting function 'Add-LWVMVHDX'.
VERBOSE: Importing function 'Add-LWVMVHDX'.
VERBOSE: Importing function 'New-LWReferenceVHDX'.
VERBOSE: Importing function 'New-LWVHDX'.
VERBOSE: Importing function 'Remove-LWVHDX'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorkerVirtualMachines.psm1'.
VERBOSE: Exporting function 'New-LWHypervVM'.
VERBOSE: Exporting function 'New-LWHypervLinuxVm'.
VERBOSE: Exporting function 'Remove-LWHypervVM'.
VERBOSE: Exporting function 'Wait-LWHypervVMRestart'.
VERBOSE: Exporting function 'Start-LWHypervVM'.
VERBOSE: Exporting function 'Stop-LWHypervVM'.
VERBOSE: Exporting function 'Save-LWHypervVM'.
VERBOSE: Exporting function 'Checkpoint-LWHypervVM'.
VERBOSE: Exporting function 'Remove-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Restore-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Get-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Get-LWHypervVMStatus'.
VERBOSE: Exporting function 'Enable-LWHypervVMRemoting'.
VERBOSE: Exporting function 'Mount-LWIsoImage'.
VERBOSE: Exporting function 'Dismount-LWIsoImage'.
VERBOSE: Exporting function 'Repair-LWHypervNetworkConfig'.
VERBOSE: Exporting function 'Set-LWHypervVMDescription'.
VERBOSE: Exporting function 'Get-LWHypervVMDescription'.
VERBOSE: Importing function 'Checkpoint-LWHypervVM'.
VERBOSE: Importing function 'Dismount-LWIsoImage'.
VERBOSE: Importing function 'Enable-LWHypervVMRemoting'.
VERBOSE: Importing function 'Get-LWHypervVMDescription'.
VERBOSE: Importing function 'Get-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Get-LWHypervVMStatus'.
VERBOSE: Importing function 'Mount-LWIsoImage'.
VERBOSE: Importing function 'New-LWHypervLinuxVm'.
VERBOSE: Importing function 'New-LWHypervVM'.
VERBOSE: Importing function 'Remove-LWHypervVM'.
VERBOSE: Importing function 'Remove-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Repair-LWHypervNetworkConfig'.
VERBOSE: Importing function 'Restore-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Save-LWHypervVM'.
VERBOSE: Importing function 'Set-LWHypervVMDescription'.
VERBOSE: Importing function 'Start-LWHypervVM'.
VERBOSE: Importing function 'Stop-LWHypervVM'.
VERBOSE: Importing function 'Wait-LWHypervVMRestart'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorkerNetwork.psm1'.
VERBOSE: Exporting function 'New-LWHypervNetworkSwitch'.
VERBOSE: Exporting function 'Remove-LWNetworkSwitch'.
VERBOSE: Importing function 'New-LWHypervNetworkSwitch'.
VERBOSE: Importing function 'Remove-LWNetworkSwitch'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabAzureWorkerNetwork.psm1'.
VERBOSE: Exporting function 'New-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'Remove-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'Get-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'New-LWAzureLoadBalancer'.
VERBOSE: Exporting function 'Remove-LWAzureLoadBalancer'.
VERBOSE: Exporting function 'Set-LWAzureDnsServer'.
VERBOSE: Exporting function 'Add-LWAzureLoadBalancedPort'.
VERBOSE: Exporting function 'Get-LWAzureLoadBalancedPort'.
VERBOSE: Exporting function 'Get-LabAzureLoadBalancedPort'.
VERBOSE: Importing function 'Add-LWAzureLoadBalancedPort'.
VERBOSE: Importing function 'Get-LabAzureLoadBalancedPort'.
VERBOSE: Importing function 'Get-LWAzureLoadBalancedPort'.
VERBOSE: Importing function 'Get-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'New-LWAzureLoadBalancer'.
VERBOSE: Importing function 'New-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'Remove-LWAzureLoadBalancer'.
VERBOSE: Importing function 'Remove-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'Set-LWAzureDnsServer'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabAzureWorkerVirtualMachines.psm1'.
VERBOSE: Exporting function 'New-LWAzureVM'.
VERBOSE: Exporting function 'Initialize-LWAzureVM'.
VERBOSE: Exporting function 'Remove-LWAzureVM'.
VERBOSE: Exporting function 'Start-LWAzureVM'.
VERBOSE: Exporting function 'Stop-LWAzureVM'.
VERBOSE: Exporting function 'Wait-LWAzureRestartVM'.
VERBOSE: Exporting function 'Get-LWAzureVMStatus'.
VERBOSE: Exporting function 'Get-LWAzureVMConnectionInfo'.
VERBOSE: Exporting function 'Enable-LWAzureVMRemoting'.
VERBOSE: Exporting function 'Enable-LWAzureWinRm'.
VERBOSE: Exporting function 'Connect-LWAzureLabSourcesDrive'.
VERBOSE: Exporting function 'Mount-LWAzureIsoImage'.
VERBOSE: Exporting function 'Dismount-LWAzureIsoImage'.
VERBOSE: Exporting function 'Checkpoint-LWAzureVM'.
VERBOSE: Exporting function 'Restore-LWAzureVmSnapshot'.
VERBOSE: Exporting function 'Remove-LWAzureVmSnapshot'.
VERBOSE: Exporting function 'Get-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Checkpoint-LWAzureVM'.
VERBOSE: Importing function 'Connect-LWAzureLabSourcesDrive'.
VERBOSE: Importing function 'Dismount-LWAzureIsoImage'.
VERBOSE: Importing function 'Enable-LWAzureVMRemoting'.
VERBOSE: Importing function 'Enable-LWAzureWinRm'.
VERBOSE: Importing function 'Get-LWAzureVMConnectionInfo'.
VERBOSE: Importing function 'Get-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Get-LWAzureVMStatus'.
VERBOSE: Importing function 'Initialize-LWAzureVM'.
VERBOSE: Importing function 'Mount-LWAzureIsoImage'.
VERBOSE: Importing function 'New-LWAzureVM'.
VERBOSE: Importing function 'Remove-LWAzureVM'.
VERBOSE: Importing function 'Remove-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Restore-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Start-LWAzureVM'.
VERBOSE: Importing function 'Stop-LWAzureVM'.
VERBOSE: Importing function 'Wait-LWAzureRestartVM'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabVMWareWorkerVirtualMachines.psm1'.
VERBOSE: Exporting function 'New-LWVMWareVM'.
VERBOSE: Exporting function 'Remove-LWVMWareVM'.
VERBOSE: Exporting function 'Start-LWVMWareVM'.
VERBOSE: Exporting function 'Save-LWVMWareVM'.
VERBOSE: Exporting function 'Stop-LWVMWareVM'.
VERBOSE: Exporting function 'Wait-LWVMWareRestartVM'.
VERBOSE: Exporting function 'Get-LWVMWareVMStatus'.
VERBOSE: Exporting function 'Enable-LWVMWareVMRemoting'.
VERBOSE: Importing function 'Enable-LWVMWareVMRemoting'.
VERBOSE: Importing function 'Get-LWVMWareVMStatus'.
VERBOSE: Importing function 'New-LWVMWareVM'.
VERBOSE: Importing function 'Remove-LWVMWareVM'.
VERBOSE: Importing function 'Save-LWVMWareVM'.
VERBOSE: Importing function 'Start-LWVMWareVM'.
VERBOSE: Importing function 'Stop-LWVMWareVM'.
VERBOSE: Importing function 'Wait-LWVMWareRestartVM'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabVMWareWorkerNetwork.psm1'.
VERBOSE: Exporting function 'Get-LWVMWareNetworkSwitch'.
VERBOSE: Importing function 'Get-LWVMWareNetworkSwitch'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\AutomatedLabWorker\5.16.0\AutomatedLabWorker.psm1'.
VERBOSE: Exporting function 'Test-IpInSameSameNetwork'.
VERBOSE: Exporting function 'Install-LWLabCAServers'.
VERBOSE: Exporting function 'Install-LWLabCAServers2008'.
VERBOSE: Exporting function 'Add-LWVMVHDX'.
VERBOSE: Exporting function 'New-LWReferenceVHDX'.
VERBOSE: Exporting function 'New-LWVHDX'.
VERBOSE: Exporting function 'Remove-LWVHDX'.
VERBOSE: Exporting function 'Checkpoint-LWHypervVM'.
VERBOSE: Exporting function 'Dismount-LWIsoImage'.
VERBOSE: Exporting function 'Enable-LWHypervVMRemoting'.
VERBOSE: Exporting function 'Get-LWHypervVMDescription'.
VERBOSE: Exporting function 'Get-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Get-LWHypervVMStatus'.
VERBOSE: Exporting function 'Mount-LWIsoImage'.
VERBOSE: Exporting function 'New-LWHypervLinuxVm'.
VERBOSE: Exporting function 'New-LWHypervVM'.
VERBOSE: Exporting function 'Remove-LWHypervVM'.
VERBOSE: Exporting function 'Remove-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Repair-LWHypervNetworkConfig'.
VERBOSE: Exporting function 'Restore-LWHypervVMSnapshot'.
VERBOSE: Exporting function 'Save-LWHypervVM'.
VERBOSE: Exporting function 'Set-LWHypervVMDescription'.
VERBOSE: Exporting function 'Start-LWHypervVM'.
VERBOSE: Exporting function 'Stop-LWHypervVM'.
VERBOSE: Exporting function 'Wait-LWHypervVMRestart'.
VERBOSE: Exporting function 'New-LWHypervNetworkSwitch'.
VERBOSE: Exporting function 'Remove-LWNetworkSwitch'.
VERBOSE: Exporting function 'Add-LWAzureLoadBalancedPort'.
VERBOSE: Exporting function 'Get-LabAzureLoadBalancedPort'.
VERBOSE: Exporting function 'Get-LWAzureLoadBalancedPort'.
VERBOSE: Exporting function 'Get-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'New-LWAzureLoadBalancer'.
VERBOSE: Exporting function 'New-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'Remove-LWAzureLoadBalancer'.
VERBOSE: Exporting function 'Remove-LWAzureNetworkSwitch'.
VERBOSE: Exporting function 'Set-LWAzureDnsServer'.
VERBOSE: Exporting function 'Checkpoint-LWAzureVM'.
VERBOSE: Exporting function 'Connect-LWAzureLabSourcesDrive'.
VERBOSE: Exporting function 'Dismount-LWAzureIsoImage'.
VERBOSE: Exporting function 'Enable-LWAzureVMRemoting'.
VERBOSE: Exporting function 'Enable-LWAzureWinRm'.
VERBOSE: Exporting function 'Get-LWAzureVMConnectionInfo'.
VERBOSE: Exporting function 'Get-LWAzureVmSnapshot'.
VERBOSE: Exporting function 'Get-LWAzureVMStatus'.
VERBOSE: Exporting function 'Initialize-LWAzureVM'.
VERBOSE: Exporting function 'Mount-LWAzureIsoImage'.
VERBOSE: Exporting function 'New-LWAzureVM'.
VERBOSE: Exporting function 'Remove-LWAzureVM'.
VERBOSE: Exporting function 'Remove-LWAzureVmSnapshot'.
VERBOSE: Exporting function 'Restore-LWAzureVmSnapshot'.
VERBOSE: Exporting function 'Start-LWAzureVM'.
VERBOSE: Exporting function 'Stop-LWAzureVM'.
VERBOSE: Exporting function 'Wait-LWAzureRestartVM'.
VERBOSE: Exporting function 'Enable-LWVMWareVMRemoting'.
VERBOSE: Exporting function 'Get-LWVMWareVMStatus'.
VERBOSE: Exporting function 'New-LWVMWareVM'.
VERBOSE: Exporting function 'Remove-LWVMWareVM'.
VERBOSE: Exporting function 'Save-LWVMWareVM'.
VERBOSE: Exporting function 'Start-LWVMWareVM'.
VERBOSE: Exporting function 'Stop-LWVMWareVM'.
VERBOSE: Exporting function 'Wait-LWVMWareRestartVM'.
VERBOSE: Exporting function 'Get-LWVMWareNetworkSwitch'.
VERBOSE: Exporting function 'Invoke-LWCommand'.
VERBOSE: Exporting function 'Get-LWHypervWindowsFeature'.
VERBOSE: Exporting function 'Get-LWAzureWindowsFeature'.
VERBOSE: Exporting function 'Install-LWHypervWindowsFeature'.
VERBOSE: Exporting function 'Install-LWAzureWindowsFeature'.
VERBOSE: Exporting function 'Uninstall-LWHypervWindowsFeature'.
VERBOSE: Exporting function 'Uninstall-LWAzureWindowsFeature'.
VERBOSE: Exporting function 'Wait-LWLabJob'.
VERBOSE: Importing function 'Add-LWAzureLoadBalancedPort'.
VERBOSE: Importing function 'Add-LWVMVHDX'.
VERBOSE: Importing function 'Checkpoint-LWAzureVM'.
VERBOSE: Importing function 'Checkpoint-LWHypervVM'.
VERBOSE: Importing function 'Connect-LWAzureLabSourcesDrive'.
VERBOSE: Importing function 'Dismount-LWAzureIsoImage'.
VERBOSE: Importing function 'Dismount-LWIsoImage'.
VERBOSE: Importing function 'Enable-LWAzureVMRemoting'.
VERBOSE: Importing function 'Enable-LWAzureWinRm'.
VERBOSE: Importing function 'Enable-LWHypervVMRemoting'.
VERBOSE: Importing function 'Enable-LWVMWareVMRemoting'.
VERBOSE: Importing function 'Get-LabAzureLoadBalancedPort'.
VERBOSE: Importing function 'Get-LWAzureLoadBalancedPort'.
VERBOSE: Importing function 'Get-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'Get-LWAzureVMConnectionInfo'.
VERBOSE: Importing function 'Get-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Get-LWAzureVMStatus'.
VERBOSE: Importing function 'Get-LWAzureWindowsFeature'.
VERBOSE: Importing function 'Get-LWHypervVMDescription'.
VERBOSE: Importing function 'Get-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Get-LWHypervVMStatus'.
VERBOSE: Importing function 'Get-LWHypervWindowsFeature'.
VERBOSE: Importing function 'Get-LWVMWareNetworkSwitch'.
VERBOSE: Importing function 'Get-LWVMWareVMStatus'.
VERBOSE: Importing function 'Initialize-LWAzureVM'.
VERBOSE: Importing function 'Install-LWAzureWindowsFeature'.
VERBOSE: Importing function 'Install-LWHypervWindowsFeature'.
VERBOSE: Importing function 'Install-LWLabCAServers'.
VERBOSE: Importing function 'Install-LWLabCAServers2008'.
VERBOSE: Importing function 'Invoke-LWCommand'.
VERBOSE: Importing function 'Mount-LWAzureIsoImage'.
VERBOSE: Importing function 'Mount-LWIsoImage'.
VERBOSE: Importing function 'New-LWAzureLoadBalancer'.
VERBOSE: Importing function 'New-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'New-LWAzureVM'.
VERBOSE: Importing function 'New-LWHypervLinuxVm'.
VERBOSE: Importing function 'New-LWHypervNetworkSwitch'.
VERBOSE: Importing function 'New-LWHypervVM'.
VERBOSE: Importing function 'New-LWReferenceVHDX'.
VERBOSE: Importing function 'New-LWVHDX'.
VERBOSE: Importing function 'New-LWVMWareVM'.
VERBOSE: Importing function 'Remove-LWAzureLoadBalancer'.
VERBOSE: Importing function 'Remove-LWAzureNetworkSwitch'.
VERBOSE: Importing function 'Remove-LWAzureVM'.
VERBOSE: Importing function 'Remove-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Remove-LWHypervVM'.
VERBOSE: Importing function 'Remove-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Remove-LWNetworkSwitch'.
VERBOSE: Importing function 'Remove-LWVHDX'.
VERBOSE: Importing function 'Remove-LWVMWareVM'.
VERBOSE: Importing function 'Repair-LWHypervNetworkConfig'.
VERBOSE: Importing function 'Restore-LWAzureVmSnapshot'.
VERBOSE: Importing function 'Restore-LWHypervVMSnapshot'.
VERBOSE: Importing function 'Save-LWHypervVM'.
VERBOSE: Importing function 'Save-LWVMWareVM'.
VERBOSE: Importing function 'Set-LWAzureDnsServer'.
VERBOSE: Importing function 'Set-LWHypervVMDescription'.
VERBOSE: Importing function 'Start-LWAzureVM'.
VERBOSE: Importing function 'Start-LWHypervVM'.
VERBOSE: Importing function 'Start-LWVMWareVM'.
VERBOSE: Importing function 'Stop-LWAzureVM'.
VERBOSE: Importing function 'Stop-LWHypervVM'.
VERBOSE: Importing function 'Stop-LWVMWareVM'.
VERBOSE: Importing function 'Test-IpInSameSameNetwork'.
VERBOSE: Importing function 'Uninstall-LWAzureWindowsFeature'.
VERBOSE: Importing function 'Uninstall-LWHypervWindowsFeature'.
VERBOSE: Importing function 'Wait-LWAzureRestartVM'.
VERBOSE: Importing function 'Wait-LWHypervVMRestart'.
VERBOSE: Importing function 'Wait-LWLabJob'.
VERBOSE: Importing function 'Wait-LWVMWareRestartVM'.
VERBOSE: [08:53:36][AutomatedLab.psm1] Trying to check if user postponed telemetry setting
VERBOSE: [08:53:36][AutomatedLab.psm1] Next check is ''.
VERBOSE: Import-Lab Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Lab.xml,ErrorAction=<null>,PassThru=True)
VERBOSE: Clear-Lab Entering... )
VERBOSE: Clear-Lab...leaving...(Time elapsed: 00:00:00:111)
VERBOSE: Test-LabHostRemoting Entering... )
VERBOSE: Test-LabHostRemoting...leaving...(Time elapsed: 00:00:00:301)
VERBOSE: [08:53:36][Write-ScreenInfo] Validating lab definition
VERBOSE: [08:53:36][Write-ScreenInfo] 08:53:36|00:00:00|00:00:00.004| Validating lab definition
08:53:36|00:00:00|00:00:00.004| Validating lab definition
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Test-LabDefinition Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Lab.xml,Quiet=True)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:53:37][Test-LabDefinition] There are 1 machine XML file referenced in the lab xml file
VERBOSE: [08:53:37][Test-LabDefinition] Starting validation against all xml files
VERBOSE: [08:53:41][Write-ScreenInfo] Could not invoke validator AutomatedLab.UnknownRoleProperties
VERBOSE: [08:53:41][Write-ScreenInfo] 08:53:41|00:00:04|00:00:04.229| - Could not invoke validator AutomatedLab.UnknownRoleProperties
08:53:41|00:00:04|00:00:04.229| - Could not invoke validator AutomatedLab.UnknownRoleProperties
VERBOSE: [08:53:41][Test-LabDefinition] Lab Validation complete, overvall runtime was 00:00:00.6207094
VERBOSE: Test-LabDefinition...leaving...(Time elapsed: 00:00:04:396)
VERBOSE: [08:53:41][Write-ScreenInfo] Success
VERBOSE: [08:53:41][Write-ScreenInfo] 08:53:41|00:00:04|00:00:04.823| - Success
08:53:41|00:00:04|00:00:04.823| - Success
VERBOSE: [08:53:42][Write-ScreenInfo] Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: [08:53:42][Write-ScreenInfo] 08:53:42|00:00:05|00:00:00.000| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
08:53:42|00:00:05|00:00:00.000| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Import-Lab...leaving - return value is 'True'...(Time elapsed: 00:00:02:248)
VERBOSE: Get-LabVM Entering... )
**********************
Command start time: 20191213085357
**********************
PS>if ($HyperVLabVMPath -is [System.Collections.IEnumerator]) 
                    { 
                        'System.Collections.IEnumerator'
                    }
                    else
                    { 
                        $HyperVLabVMPath 
                    }
                    
>> CommandInvocation(Out-String): "Out-String"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\DC01"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\CA01"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE01"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE02"
C:\AutomatedLab-VMs\DC01
C:\AutomatedLab-VMs\CA01
C:\AutomatedLab-VMs\IISNODE01
C:\AutomatedLab-VMs\IISNODE02
**********************
Command start time: 20191213085359
**********************
PS>$HyperVLabVMPath
>> CommandInvocation(Out-String): "Out-String"
>> ParameterBinding(Out-String): name="Stream"; value="True"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\DC01"
C:\AutomatedLab-VMs\DC01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\CA01"
C:\AutomatedLab-VMs\CA01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE01"
C:\AutomatedLab-VMs\IISNODE01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE02"
C:\AutomatedLab-VMs\IISNODE02
VERBOSE: Remove-VM will remove virtual machine "DC01".
VERBOSE: Remove-VM will remove virtual machine "CA01".
VERBOSE: Remove-VM will remove virtual machine "IISNODE01".
VERBOSE: Remove-VM will remove virtual machine "IISNODE02".
**********************
Command start time: 20191213085414
**********************
PS>$HyperVLabVMPath
>> CommandInvocation(Out-String): "Out-String"
>> ParameterBinding(Out-String): name="Stream"; value="True"
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\DC01"
C:\AutomatedLab-VMs\DC01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\CA01"
C:\AutomatedLab-VMs\CA01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE01"
C:\AutomatedLab-VMs\IISNODE01
>> ParameterBinding(Out-String): name="InputObject"; value="C:\AutomatedLab-VMs\IISNODE02"
C:\AutomatedLab-VMs\IISNODE02
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\DC01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\DC01\DC01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\DC01\DC01\Virtual Machines".
VERBOSE: Performing the operation "Remove File" on target "C:\AutomatedLab-VMs\DC01\DC01.vhdx".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\CA01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\CA01\CA01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\CA01\CA01\Virtual Machines".
VERBOSE: Performing the operation "Remove File" on target "C:\AutomatedLab-VMs\CA01\CA01.vhdx".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE01\IISNODE01".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE01\IISNODE01\Virtual Machines".
VERBOSE: Performing the operation "Remove File" on target "C:\AutomatedLab-VMs\IISNODE01\IISNODE01.vhdx".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE02".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE02\IISNODE02".
VERBOSE: Performing the operation "Remove Directory" on target "C:\AutomatedLab-VMs\IISNODE02\IISNODE02\Virtual Machines".
VERBOSE: Performing the operation "Remove File" on target "C:\AutomatedLab-VMs\IISNODE02\IISNODE02.vhdx".
VERBOSE: Remove-Lab Entering... (Name=NLBIISLab,Verbose=True,Confirm=<null>,ErrorAction=<null>)
VERBOSE: Import-Lab Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab,NoValidation=True)
VERBOSE: Clear-Lab Entering... )
VERBOSE: Clear-Lab...leaving...(Time elapsed: 00:00:00:088)
VERBOSE: Test-LabHostRemoting Entering... )
VERBOSE: Test-LabHostRemoting...leaving...(Time elapsed: 00:00:00:138)
VERBOSE: [08:54:38][Write-ScreenInfo] Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: [08:54:38][Write-ScreenInfo] 08:54:38|00:01:01|00:00:56.275| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
08:54:38|00:01:01|00:00:56.275| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Import-Lab...leaving - return value is 'True'...(Time elapsed: 00:00:01:809)
VERBOSE: Performing the operation "Remove the lab completely" on target "NLBIISLab".
VERBOSE: [08:54:40][Write-ScreenInfo] Removing lab 'NLBIISLab'
VERBOSE: [08:54:40][Write-ScreenInfo] 08:54:40|00:01:03|00:00:00.000| Removing lab 'NLBIISLab'
08:54:40|00:01:03|00:00:00.000| Removing lab 'NLBIISLab'
VERBOSE: [08:54:40][Write-ScreenInfo] Removing lab sessions
VERBOSE: [08:54:40][Write-ScreenInfo] 08:54:40|00:01:03|00:00:00.148| - Removing lab sessions
08:54:40|00:01:03|00:00:00.148| - Removing lab sessions
VERBOSE: Remove-LabPSSession Entering... (All=True)
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: [08:54:41][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:687)
VERBOSE: [08:54:41][Remove-Lab] ...done
VERBOSE: [08:54:41][Write-ScreenInfo] Removing lab background jobs
VERBOSE: [08:54:41][Write-ScreenInfo] 08:54:41|00:01:04|00:00:01.120| - Removing lab background jobs
08:54:41|00:01:04|00:00:01.120| - Removing lab background jobs
VERBOSE: [08:54:42][Remove-Lab] Removing remaining 1 jobs...
VERBOSE: [08:54:42][Remove-Lab] ...done
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01,ErrorAction=<null>)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01,ErrorAction=<null>)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01,ErrorAction=<null>)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02,ErrorAction=<null>)
VERBOSE: Remove-LabVM Entering... (Name=System.Object[])
VERBOSE: [08:54:42][Write-ScreenInfo] Removing Lab VM 'DC01' (and its associated disks)
VERBOSE: [08:54:42][Write-ScreenInfo] 08:54:42|00:01:05|00:00:02.106| - Removing Lab VM 'DC01' (and its associated disks)
08:54:42|00:01:05|00:00:02.106| - Removing Lab VM 'DC01' (and its associated disks)
VERBOSE: Remove-LWHypervVM Entering... (Name=DC01)
VERBOSE: Remove-LWHypervVM...leaving...(Time elapsed: 00:00:00:089)
VERBOSE: [08:54:43][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:43][Get-HostFile] File loaded with 8 lines
VERBOSE: [08:54:43][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:43][Get-HostFile] File loaded with 8 lines
VERBOSE: [08:54:43][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:43][Get-HostFile] File loaded with 40 lines
VERBOSE: [08:54:43][Write-ScreenInfo] Lab VM 'DC01' has been removed
VERBOSE: [08:54:43][Write-ScreenInfo] 08:54:43|00:01:06|00:00:03.082| - Lab VM 'DC01' has been removed
08:54:43|00:01:06|00:00:03.082| - Lab VM 'DC01' has been removed
VERBOSE: [08:54:44][Write-ScreenInfo] Removing Lab VM 'CA01' (and its associated disks)
VERBOSE: [08:54:44][Write-ScreenInfo] 08:54:44|00:01:07|00:00:03.303| - Removing Lab VM 'CA01' (and its associated disks)
08:54:44|00:01:07|00:00:03.303| - Removing Lab VM 'CA01' (and its associated disks)
VERBOSE: Remove-LWHypervVM Entering... (Name=CA01)
VERBOSE: Remove-LWHypervVM...leaving...(Time elapsed: 00:00:00:072)
VERBOSE: [08:54:44][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:44][Get-HostFile] File loaded with 7 lines
VERBOSE: [08:54:44][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:44][Get-HostFile] File loaded with 7 lines
VERBOSE: [08:54:44][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:44][Get-HostFile] File loaded with 39 lines
VERBOSE: [08:54:44][Write-ScreenInfo] Lab VM 'CA01' has been removed
VERBOSE: [08:54:44][Write-ScreenInfo] 08:54:44|00:01:07|00:00:03.884| - Lab VM 'CA01' has been removed
08:54:44|00:01:07|00:00:03.884| - Lab VM 'CA01' has been removed
VERBOSE: [08:54:44][Write-ScreenInfo] Removing Lab VM 'IISNODE01' (and its associated disks)
VERBOSE: [08:54:44][Write-ScreenInfo] 08:54:44|00:01:07|00:00:04.122| - Removing Lab VM 'IISNODE01' (and its associated disks)
08:54:44|00:01:07|00:00:04.122| - Removing Lab VM 'IISNODE01' (and its associated disks)
VERBOSE: Remove-LWHypervVM Entering... (Name=IISNODE01)
VERBOSE: Remove-LWHypervVM...leaving...(Time elapsed: 00:00:00:076)
VERBOSE: [08:54:45][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:45][Get-HostFile] File loaded with 6 lines
VERBOSE: [08:54:45][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:45][Get-HostFile] File loaded with 6 lines
VERBOSE: [08:54:45][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:45][Get-HostFile] File loaded with 38 lines
VERBOSE: [08:54:45][Write-ScreenInfo] Lab VM 'IISNODE01' has been removed
VERBOSE: [08:54:45][Write-ScreenInfo] 08:54:45|00:01:08|00:00:04.720| - Lab VM 'IISNODE01' has been removed
08:54:45|00:01:08|00:00:04.720| - Lab VM 'IISNODE01' has been removed
VERBOSE: [08:54:45][Write-ScreenInfo] Removing Lab VM 'IISNODE02' (and its associated disks)
VERBOSE: [08:54:45][Write-ScreenInfo] 08:54:45|00:01:08|00:00:04.955| - Removing Lab VM 'IISNODE02' (and its associated disks)
08:54:45|00:01:08|00:00:04.955| - Removing Lab VM 'IISNODE02' (and its associated disks)
VERBOSE: Remove-LWHypervVM Entering... (Name=IISNODE02)
VERBOSE: Remove-LWHypervVM...leaving...(Time elapsed: 00:00:00:076)
VERBOSE: [08:54:45][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:45][Get-HostFile] File loaded with 5 lines
VERBOSE: [08:54:46][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:46][Get-HostFile] File loaded with 5 lines
VERBOSE: [08:54:46][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:46][Get-HostFile] File loaded with 37 lines
VERBOSE: [08:54:46][Write-ScreenInfo] Lab VM 'IISNODE02' has been removed
VERBOSE: [08:54:46][Write-ScreenInfo] 08:54:46|00:01:09|00:00:05.539| - Lab VM 'IISNODE02' has been removed
08:54:46|00:01:09|00:00:05.539| - Lab VM 'IISNODE02' has been removed
VERBOSE: Get-LabVHDX Entering... (All=True)
VERBOSE: [08:54:46][Remove-Lab] Lab knows about 0 disks
VERBOSE: [08:54:46][Write-ScreenInfo] Removing entries in the hosts file
VERBOSE: [08:54:46][Write-ScreenInfo] 08:54:46|00:01:09|00:00:05.697| - Removing entries in the hosts file
08:54:46|00:01:09|00:00:05.697| - Removing entries in the hosts file
VERBOSE: [08:54:46][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:54:46][Get-HostFile] File loaded with 36 lines
VERBOSE: [08:54:46][Write-ScreenInfo] Removing virtual networks
VERBOSE: [08:54:46][Write-ScreenInfo] 08:54:46|00:01:09|00:00:05.876| - Removing virtual networks
08:54:46|00:01:09|00:00:05.876| - Removing virtual networks
VERBOSE: Remove-LabNetworkSwitches Entering... )
VERBOSE: [08:54:46][Remove-LabNetworkSwitches] Removing Hyper-V network switch 'NLBIISLab'...
VERBOSE: Remove-LWNetworkSwitch Entering... (Name=NLBIISLab)
VERBOSE: [08:54:52][Remove-LWNetworkSwitch] Network switch 'NLBIISLab' removed
VERBOSE: Remove-LWNetworkSwitch...leaving...(Time elapsed: 00:00:06:087)
VERBOSE: [08:54:52][Remove-LabNetworkSwitches] ...done
VERBOSE: [08:54:52][Remove-LabNetworkSwitches] done
VERBOSE: Remove-LabNetworkSwitches...leaving...(Time elapsed: 00:00:06:183)
VERBOSE: [08:54:53][Write-ScreenInfo] Removing Lab XML files
VERBOSE: [08:54:53][Write-ScreenInfo] 08:54:53|00:01:16|00:00:12.336| - Removing Lab XML files
08:54:53|00:01:16|00:00:12.336| - Removing Lab XML files
VERBOSE: [08:54:53][Write-ScreenInfo] Done removing lab 'NLBIISLab'
VERBOSE: [08:54:53][Write-ScreenInfo] 08:54:53|00:01:16|00:00:13.115| - Done removing lab 'NLBIISLab'
08:54:53|00:01:16|00:00:13.115| - Done removing lab 'NLBIISLab'
VERBOSE: Remove-Lab...leaving...(Time elapsed: 00:00:07:159)
VERBOSE: New-LabDefinition Entering... (Name=NLBIISLab,DefaultVirtualizationEngine=HyperV)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:27][Write-ScreenInfo] Initialization
VERBOSE: [08:57:27][Write-ScreenInfo] 08:57:27|00:00:00|00:00:00.000| Initialization
08:57:27|00:00:00|00:00:00.000| Initialization
VERBOSE: [08:57:27][Write-ScreenInfo] Host operating system version: '10.0.18363'
VERBOSE: [08:57:27][Write-ScreenInfo] 08:57:27|00:00:00|00:00:00.066| - Host operating system version: '10.0.18363'
08:57:27|00:00:00|00:00:00.066| - Host operating system version: '10.0.18363'
VERBOSE: [08:57:27][Write-ScreenInfo] Creating new lab definition with name 'NLBIISLab'
VERBOSE: [08:57:27][Write-ScreenInfo] 08:57:27|00:00:00|00:00:00.149| - Creating new lab definition with name 'NLBIISLab'
08:57:27|00:00:00|00:00:00.149| - Creating new lab definition with name 'NLBIISLab'
VERBOSE: [08:57:27][Write-ScreenInfo] Location of lab definition files will be 'C:\ProgramData\AutomatedLab\Labs\NLBIISLab'
VERBOSE: [08:57:27][Write-ScreenInfo] 08:57:27|00:00:00|00:00:00.229| - Location of lab definition files will be 'C:\ProgramData\AutomatedLab\Labs\NLBIISLab'
08:57:27|00:00:00|00:00:00.229| - Location of lab definition files will be 'C:\ProgramData\AutomatedLab\Labs\NLBIISLab'
VERBOSE: [08:57:27][Update-LabSysinternalsTools] Get last check time of SysInternals suite
VERBOSE: [08:57:27][Update-LabSysinternalsTools] Last check was '12/12/2019 16:14:48'.
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:29][Write-ScreenInfo] Location of LabSources folder is 'C:\LabSources'
VERBOSE: [08:57:29][Write-ScreenInfo] 08:57:29|00:00:02|00:00:02.071| - Location of LabSources folder is 'C:\LabSources'
08:57:29|00:00:02|00:00:02.071| - Location of LabSources folder is 'C:\LabSources'
VERBOSE: Get-LabIsoImageDefinition Entering... )
VERBOSE: Get-LabIsoImageDefinition...leaving...(Time elapsed: 00:00:00:093)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:29][Write-ScreenInfo] Auto-adding ISO files
VERBOSE: [08:57:29][Write-ScreenInfo] 08:57:29|00:00:02|00:00:00.002| - Auto-adding ISO files
08:57:29|00:00:02|00:00:00.002| - Auto-adding ISO files
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Get-LabAvailableOperatingSystem Entering... (Path=C:\LabSources\ISOs)
VERBOSE: [08:57:29][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:29][Write-ScreenInfo] found 18 OS images in the cache
VERBOSE: [08:57:29][Write-ScreenInfo] 08:57:29|00:00:02|00:00:00.379|   - found 18 OS images in the cache
08:57:29|00:00:02|00:00:00.379|   - found 18 OS images in the cache
VERBOSE: [08:57:29][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:361)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Add-LabIsoImageDefinition Entering... (Path=C:\LabSources\ISOs)
VERBOSE: [08:57:30][Add-LabIsoImageDefinition] Read 8 ISO images from the cache
VERBOSE: Get-LabAzureLabSourcesStorage Entering... (ErrorAction=<null>)
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\Az.Accounts\1.6.4\Microsoft.Azure.PowerShell.Cmdlets.Accounts.dll'.
VERBOSE: Importing cmdlet 'Get-AzProfile'.
VERBOSE: Importing cmdlet 'Register-AzModule'.
VERBOSE: Importing cmdlet 'Select-AzProfile'.
VERBOSE: Importing cmdlet 'Connect-AzAccount'.
VERBOSE: Importing cmdlet 'Disconnect-AzAccount'.
VERBOSE: Importing cmdlet 'Get-AzContext'.
VERBOSE: Importing cmdlet 'Import-AzContext'.
VERBOSE: Importing cmdlet 'Save-AzContext'.
VERBOSE: Importing cmdlet 'Set-AzContext'.
VERBOSE: Importing cmdlet 'Disable-AzDataCollection'.
VERBOSE: Importing cmdlet 'Enable-AzDataCollection'.
VERBOSE: Importing cmdlet 'Add-AzEnvironment'.
VERBOSE: Importing cmdlet 'Get-AzEnvironment'.
VERBOSE: Importing cmdlet 'Remove-AzEnvironment'.
VERBOSE: Importing cmdlet 'Set-AzEnvironment'.
VERBOSE: Importing cmdlet 'Send-Feedback'.
VERBOSE: Importing cmdlet 'Get-AzSubscription'.
VERBOSE: Importing cmdlet 'Get-AzTenant'.
VERBOSE: Importing cmdlet 'Uninstall-AzureRm'.
VERBOSE: Importing cmdlet 'Resolve-AzError'.
VERBOSE: Importing cmdlet 'Clear-AzDefault'.
VERBOSE: Importing cmdlet 'Get-AzDefault'.
VERBOSE: Importing cmdlet 'Set-AzDefault'.
VERBOSE: Importing cmdlet 'Disable-AzureRmAlias'.
VERBOSE: Importing cmdlet 'Enable-AzureRmAlias'.
VERBOSE: Importing cmdlet 'Disable-AzContextAutosave'.
VERBOSE: Importing cmdlet 'Enable-AzContextAutosave'.
VERBOSE: Importing cmdlet 'Get-AzContextAutosaveSetting'.
VERBOSE: Importing cmdlet 'Clear-AzContext'.
VERBOSE: Importing cmdlet 'Remove-AzContext'.
VERBOSE: Importing cmdlet 'Rename-AzContext'.
VERBOSE: Importing cmdlet 'Select-AzContext'.
VERBOSE: Importing alias 'Login-AzAccount'.
VERBOSE: Importing alias 'Login-AzureRmAccount'.
VERBOSE: Importing alias 'Add-AzAccount'.
VERBOSE: Importing alias 'Logout-AzAccount'.
VERBOSE: Importing alias 'Logout-AzureRmAccount'.
VERBOSE: Importing alias 'Remove-AzAccount'.
VERBOSE: Importing alias 'Save-AzProfile'.
VERBOSE: Importing alias 'Select-AzSubscription'.
VERBOSE: Importing alias 'Get-AzureRmDomain'.
VERBOSE: Importing alias 'Get-AzDomain'.
VERBOSE: Importing alias 'Resolve-Error'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\Az.Storage\1.9.0\Microsoft.Azure.PowerShell.Cmdlets.Storage.Management.dll'.
VERBOSE: Importing cmdlet 'Add-AzRmStorageContainerLegalHold'.
VERBOSE: Importing cmdlet 'Disable-AzStorageBlobDeleteRetentionPolicy'.
VERBOSE: Importing cmdlet 'Enable-AzStorageBlobDeleteRetentionPolicy'.
VERBOSE: Importing cmdlet 'Get-AzStorageBlobServiceProperty'.
VERBOSE: Importing cmdlet 'Get-AzRmStorageContainer'.
VERBOSE: Importing cmdlet 'Get-AzRmStorageContainerImmutabilityPolicy'.
VERBOSE: Importing cmdlet 'Lock-AzRmStorageContainerImmutabilityPolicy'.
VERBOSE: Importing cmdlet 'New-AzRmStorageContainer'.
VERBOSE: Importing cmdlet 'Remove-AzRmStorageContainer'.
VERBOSE: Importing cmdlet 'Remove-AzRmStorageContainerImmutabilityPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzRmStorageContainerLegalHold'.
VERBOSE: Importing cmdlet 'Set-AzRmStorageContainerImmutabilityPolicy'.
VERBOSE: Importing cmdlet 'Update-AzStorageBlobServiceProperty'.
VERBOSE: Importing cmdlet 'Update-AzRmStorageContainer'.
VERBOSE: Importing cmdlet 'Get-AzRmStorageShare'.
VERBOSE: Importing cmdlet 'New-AzRmStorageShare'.
VERBOSE: Importing cmdlet 'Remove-AzRmStorageShare'.
VERBOSE: Importing cmdlet 'Update-AzRmStorageShare'.
VERBOSE: Importing cmdlet 'Add-AzStorageAccountManagementPolicyAction'.
VERBOSE: Importing cmdlet 'Add-AzStorageAccountNetworkRule'.
VERBOSE: Importing cmdlet 'Get-AzStorageAccount'.
VERBOSE: Importing cmdlet 'Get-AzStorageAccountKey'.
VERBOSE: Importing cmdlet 'Get-AzStorageAccountManagementPolicy'.
VERBOSE: Importing cmdlet 'Get-AzStorageAccountNetworkRuleSet'.
VERBOSE: Importing cmdlet 'New-AzStorageAccount'.
VERBOSE: Importing cmdlet 'New-AzStorageAccountKey'.
VERBOSE: Importing cmdlet 'New-AzStorageAccountManagementPolicyFilter'.
VERBOSE: Importing cmdlet 'New-AzStorageAccountManagementPolicyRule'.
VERBOSE: Importing cmdlet 'Remove-AzStorageAccount'.
VERBOSE: Importing cmdlet 'Remove-AzStorageAccountManagementPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzStorageAccountNetworkRule'.
VERBOSE: Importing cmdlet 'Set-AzCurrentStorageAccount'.
VERBOSE: Importing cmdlet 'Set-AzStorageAccount'.
VERBOSE: Importing cmdlet 'Set-AzStorageAccountManagementPolicy'.
VERBOSE: Importing cmdlet 'Update-AzStorageAccountNetworkRuleSet'.
VERBOSE: Importing cmdlet 'Get-AzStorageAccountNameAvailability'.
VERBOSE: Importing cmdlet 'Get-AzStorageUsage'.
VERBOSE: Loading module from path 'C:\Program Files\WindowsPowerShell\Modules\Az.Storage\1.9.0\Microsoft.Azure.PowerShell.Cmdlets.Storage.dll'.
VERBOSE: Importing cmdlet 'Get-AzStorageTableStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Get-AzStorageTable'.
VERBOSE: Importing cmdlet 'New-AzStorageTableSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageTableStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'New-AzStorageTable'.
VERBOSE: Importing cmdlet 'Remove-AzStorageTableStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzStorageTable'.
VERBOSE: Importing cmdlet 'Set-AzStorageTableStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Get-AzStorageQueue'.
VERBOSE: Importing cmdlet 'New-AzStorageQueue'.
VERBOSE: Importing cmdlet 'Remove-AzStorageQueue'.
VERBOSE: Importing cmdlet 'Get-AzStorageQueueStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'New-AzStorageQueueSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageQueueStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzStorageQueueStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Set-AzStorageQueueStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Close-AzStorageFileHandle'.
VERBOSE: Importing cmdlet 'Get-AzStorageFile'.
VERBOSE: Importing cmdlet 'Get-AzStorageFileContent'.
VERBOSE: Importing cmdlet 'Get-AzStorageFileCopyState'.
VERBOSE: Importing cmdlet 'Get-AzStorageFileHandle'.
VERBOSE: Importing cmdlet 'Get-AzStorageShare'.
VERBOSE: Importing cmdlet 'Get-AzStorageShareStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'New-AzStorageDirectory'.
VERBOSE: Importing cmdlet 'New-AzStorageFileSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageShare'.
VERBOSE: Importing cmdlet 'New-AzStorageShareSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageShareStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzStorageDirectory'.
VERBOSE: Importing cmdlet 'Remove-AzStorageFile'.
VERBOSE: Importing cmdlet 'Remove-AzStorageShare'.
VERBOSE: Importing cmdlet 'Remove-AzStorageShareStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Set-AzStorageFileContent'.
VERBOSE: Importing cmdlet 'Set-AzStorageShareQuota'.
VERBOSE: Importing cmdlet 'Set-AzStorageShareStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Start-AzStorageFileCopy'.
VERBOSE: Importing cmdlet 'Stop-AzStorageFileCopy'.
VERBOSE: Importing cmdlet 'Disable-AzStorageDeleteRetentionPolicy'.
VERBOSE: Importing cmdlet 'Disable-AzStorageStaticWebsite'.
VERBOSE: Importing cmdlet 'Enable-AzStorageDeleteRetentionPolicy'.
VERBOSE: Importing cmdlet 'Enable-AzStorageStaticWebsite'.
VERBOSE: Importing cmdlet 'Get-AzStorageCORSRule'.
VERBOSE: Importing cmdlet 'Get-AzStorageServiceLoggingProperty'.
VERBOSE: Importing cmdlet 'Get-AzStorageServiceMetricsProperty'.
VERBOSE: Importing cmdlet 'Get-AzStorageServiceProperty'.
VERBOSE: Importing cmdlet 'New-AzStorageAccountSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageContext'.
VERBOSE: Importing cmdlet 'Remove-AzStorageCORSRule'.
VERBOSE: Importing cmdlet 'Set-AzStorageCORSRule'.
VERBOSE: Importing cmdlet 'Set-AzStorageServiceLoggingProperty'.
VERBOSE: Importing cmdlet 'Set-AzStorageServiceMetricsProperty'.
VERBOSE: Importing cmdlet 'Update-AzStorageServiceProperty'.
VERBOSE: Importing cmdlet 'Set-AzStorageContainerAcl'.
VERBOSE: Importing cmdlet 'Remove-AzStorageBlob'.
VERBOSE: Importing cmdlet 'Set-AzStorageBlobContent'.
VERBOSE: Importing cmdlet 'Get-AzStorageBlob'.
VERBOSE: Importing cmdlet 'Get-AzStorageBlobContent'.
VERBOSE: Importing cmdlet 'Get-AzStorageBlobCopyState'.
VERBOSE: Importing cmdlet 'Get-AzStorageContainer'.
VERBOSE: Importing cmdlet 'Get-AzStorageContainerStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'New-AzStorageBlobSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageContainer'.
VERBOSE: Importing cmdlet 'New-AzStorageContainerSASToken'.
VERBOSE: Importing cmdlet 'New-AzStorageContainerStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Remove-AzStorageContainer'.
VERBOSE: Importing cmdlet 'Remove-AzStorageContainerStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Set-AzStorageContainerStoredAccessPolicy'.
VERBOSE: Importing cmdlet 'Start-AzStorageBlobCopy'.
VERBOSE: Importing cmdlet 'Start-AzStorageBlobIncrementalCopy'.
VERBOSE: Importing cmdlet 'Stop-AzStorageBlobCopy'.
VERBOSE: Importing alias 'Disable-AzStorageSoftDelete'.
VERBOSE: Importing alias 'Enable-AzStorageSoftDelete'.
VERBOSE: Importing alias 'Get-AzStorageContainerAcl'.
VERBOSE: Importing alias 'Start-CopyAzureStorageBlob'.
VERBOSE: Importing alias 'Stop-CopyAzureStorageBlob'.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_windows_server_2019_x64_dvd_4cb967d8.iso' with a size '4843268096' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_windows_10_business_edition_version_1809_updated_june_2019_x64_dvd_3e2fb1ea.iso' with a size '4988125184' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\14393.0.160715-1616.RS1_RELEASE_SERVER_VOL_X64FRE_EN-US.ISO' with a size '5129654272' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_windows_10_enterprise_ltsc_2019_x64_dvd_5795bb03.iso' with a size '4330432512' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' with a size '6006587392' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_sql_server_2016_standard_with_service_pack_2_x64_dvd_12124191.iso' with a size '2970245120' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\en_windows_server_2012_r2_with_update_x64_dvd_6052708.iso' with a size '5397889024' is already in the cache.
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] The ISO 'C:\LabSources\ISOs\ubuntu-19.04-desktop-amd64.iso' with a size '2097152000' is already in the cache.
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_windows_server_2019_x64_dvd_4cb967d8.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:04.765|   - Added 'C:\LabSources\ISOs\en_windows_server_2019_x64_dvd_4cb967d8.iso'
08:57:34|00:00:07|00:00:04.765|   - Added 'C:\LabSources\ISOs\en_windows_server_2019_x64_dvd_4cb967d8.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_windows_10_business_edition_version_1809_updated_june_2019_x64_dvd_3e2fb1ea.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:04.849|   - Added 'C:\LabSources\ISOs\en_windows_10_business_edition_version_1809_updated_june_2019_x64_dvd_3e2fb1ea.iso'
08:57:34|00:00:07|00:00:04.849|   - Added 'C:\LabSources\ISOs\en_windows_10_business_edition_version_1809_updated_june_2019_x64_dvd_3e2fb1ea.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\14393.0.160715-1616.RS1_RELEASE_SERVER_VOL_X64FRE_EN-US.ISO'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:04.940|   - Added 'C:\LabSources\ISOs\14393.0.160715-1616.RS1_RELEASE_SERVER_VOL_X64FRE_EN-US.ISO'
08:57:34|00:00:07|00:00:04.940|   - Added 'C:\LabSources\ISOs\14393.0.160715-1616.RS1_RELEASE_SERVER_VOL_X64FRE_EN-US.ISO'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_windows_10_enterprise_ltsc_2019_x64_dvd_5795bb03.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:05.015|   - Added 'C:\LabSources\ISOs\en_windows_10_enterprise_ltsc_2019_x64_dvd_5795bb03.iso'
08:57:34|00:00:07|00:00:05.015|   - Added 'C:\LabSources\ISOs\en_windows_10_enterprise_ltsc_2019_x64_dvd_5795bb03.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:05.098|   - Added 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso'
08:57:34|00:00:07|00:00:05.098|   - Added 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_sql_server_2016_standard_with_service_pack_2_x64_dvd_12124191.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:05.195|   - Added 'C:\LabSources\ISOs\en_sql_server_2016_standard_with_service_pack_2_x64_dvd_12124191.iso'
08:57:34|00:00:07|00:00:05.195|   - Added 'C:\LabSources\ISOs\en_sql_server_2016_standard_with_service_pack_2_x64_dvd_12124191.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\en_windows_server_2012_r2_with_update_x64_dvd_6052708.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:05.296|   - Added 'C:\LabSources\ISOs\en_windows_server_2012_r2_with_update_x64_dvd_6052708.iso'
08:57:34|00:00:07|00:00:05.296|   - Added 'C:\LabSources\ISOs\en_windows_server_2012_r2_with_update_x64_dvd_6052708.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] Added 'C:\LabSources\ISOs\ubuntu-19.04-desktop-amd64.iso'
VERBOSE: [08:57:34][Write-ScreenInfo] 08:57:34|00:00:07|00:00:05.401|   - Added 'C:\LabSources\ISOs\ubuntu-19.04-desktop-amd64.iso'
08:57:34|00:00:07|00:00:05.401|   - Added 'C:\LabSources\ISOs\ubuntu-19.04-desktop-amd64.iso'
VERBOSE: [08:57:34][Add-LabIsoImageDefinition] Final Lab ISO count: 8
VERBOSE: Add-LabIsoImageDefinition...leaving...(Time elapsed: 00:00:04:429)
VERBOSE: [08:57:35][Write-ScreenInfo] Done
VERBOSE: [08:57:35][Write-ScreenInfo] 08:57:35|00:00:07|00:00:05.552|   - Done
08:57:35|00:00:07|00:00:05.552|   - Done
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: New-LabDefinition...leaving...(Time elapsed: 00:00:00:490)
VERBOSE: Add-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab,HyperVProperties=System.Collections.Hashtable[](1),AddressSpace=10.0.0.0/16)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:36][Add-LabVirtualNetworkDefinition] Network 'NLBIISLab' added. Lab has 1 network(s) defined
VERBOSE: Add-LabVirtualNetworkDefinition...leaving...(Time elapsed: 00:00:00:191)
VERBOSE: Add-LabDomainDefinition Entering... (Name=contoso.com,AdminUser=Administrator,AdminPassword=P@ssw0rd)
VERBOSE: [08:57:36][Add-LabDomainDefinition] Added domain 'contoso.com'. Lab now has 1 domain(s) defined
VERBOSE: Add-LabDomainDefinition...leaving...(Time elapsed: 00:00:00:087)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Add-LabMachineDefinition Entering... (Name=DC01,Roles=AutomatedLab.Role[](1),IpAddress=10.0.0.1,DomainName=contoso.com,Network=NLBIISLab,Processors=2,Memory=2147483648,OperatingSystem=Windows Server 2016 Standard (Desktop Experience))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:37][Write-ScreenInfo] Adding Hyper-V machine definition 'DC01'        (Roles: RootDC)
VERBOSE: [08:57:37][Write-ScreenInfo] 08:57:37|00:00:10|00:00:00.002| - Adding Hyper-V machine definition 'DC01'        (Roles: RootDC)
08:57:37|00:00:10|00:00:00.002| - Adding Hyper-V machine definition 'DC01'        (Roles: RootDC)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDomainDefinition Entering... )
VERBOSE: [08:57:38][Add-LabMachineDefinition] Detect if a virtual switch already exists with same name as lab being deployed. If so, use this switch for defining network name and address space.
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: [08:57:41][Add-LabMachineDefinition] One or more virtual network(s) has been specified.
VERBOSE: [08:57:41][Add-LabMachineDefinition] Virtual network 'NLBIISLab' specified with address space '10.0.0.0/16'
VERBOSE: [08:57:41][Add-LabMachineDefinition] Address space specified is valid
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,UseDhcp=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:083)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:42][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:42][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:313)
VERBOSE: [08:57:43][Write-ScreenInfo] The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:43][Write-ScreenInfo] 08:57:43|00:00:15|00:00:05.333|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
08:57:43|00:00:15|00:00:05.333|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:43][Write-ScreenInfo] Done
VERBOSE: [08:57:43][Write-ScreenInfo] 08:57:43|00:00:15|00:00:05.460|   - Done
08:57:43|00:00:15|00:00:05.460|   - Done
VERBOSE: Add-LabMachineDefinition...leaving...(Time elapsed: 00:00:00:593)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Add-LabMachineDefinition Entering... (Name=CA01,Roles=AutomatedLab.Role[](1),IpAddress=10.0.0.2,DomainName=contoso.com,Network=NLBIISLab,Processors=2,Memory=2147483648,OperatingSystem=Windows Server 2016 Standard (Desktop Experience))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:43][Write-ScreenInfo] Adding Hyper-V machine definition 'CA01'        (Roles: CaRoot)
VERBOSE: [08:57:43][Write-ScreenInfo] 08:57:43|00:00:16|00:00:00.001| - Adding Hyper-V machine definition 'CA01'        (Roles: CaRoot)
08:57:43|00:00:16|00:00:00.001| - Adding Hyper-V machine definition 'CA01'        (Roles: CaRoot)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDomainDefinition Entering... )
VERBOSE: [08:57:44][Add-LabMachineDefinition] Detect if a virtual switch already exists with same name as lab being deployed. If so, use this switch for defining network name and address space.
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: [08:57:44][Add-LabMachineDefinition] One or more virtual network(s) has been specified.
VERBOSE: [08:57:44][Add-LabMachineDefinition] Virtual network 'NLBIISLab' specified with address space '10.0.0.0/16'
VERBOSE: [08:57:44][Add-LabMachineDefinition] Address space specified is valid
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,UseDhcp=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:071)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:45][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:45][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:305)
VERBOSE: [08:57:45][Write-ScreenInfo] The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:45][Write-ScreenInfo] 08:57:45|00:00:18|00:00:01.623|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
08:57:45|00:00:18|00:00:01.623|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:45][Write-ScreenInfo] Done
VERBOSE: [08:57:45][Write-ScreenInfo] 08:57:45|00:00:18|00:00:01.728|   - Done
08:57:45|00:00:18|00:00:01.728|   - Done
VERBOSE: Add-LabMachineDefinition...leaving...(Time elapsed: 00:00:00:554)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,Ipv4Address=AutomatedLab.IPNetwork[](1))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:076)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,Ipv4Address=AutomatedLab.IPNetwork[](1))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Add-LabMachineDefinition Entering... (Name=IISNODE01,NetworkAdapter=AutomatedLab.NetworkAdapter[](2),DomainName=contoso.com,Processors=2,Memory=2147483648,OperatingSystem=Windows Server 2016 Standard (Desktop Experience))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:46][Write-ScreenInfo] Adding Hyper-V machine definition 'IISNODE01'
VERBOSE: [08:57:46][Write-ScreenInfo] 08:57:46|00:00:19|00:00:00.000| - Adding Hyper-V machine definition 'IISNODE01'
08:57:46|00:00:19|00:00:00.000| - Adding Hyper-V machine definition 'IISNODE01'
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDomainDefinition Entering... )
VERBOSE: [08:57:47][Add-LabMachineDefinition] Detect if a virtual switch already exists with same name as lab being deployed. If so, use this switch for defining network name and address space.
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: [08:57:47][Add-LabMachineDefinition] One or more virtual network(s) has been specified.
VERBOSE: [08:57:47][Add-LabMachineDefinition] Virtual network 'NLBIISLab' specified with address space '10.0.0.0/16'
VERBOSE: [08:57:47][Add-LabMachineDefinition] Address space specified is valid
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:47][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:47][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:304)
VERBOSE: [08:57:47][Write-ScreenInfo] The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:47][Write-ScreenInfo] 08:57:47|00:00:20|00:00:01.343|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
08:57:47|00:00:20|00:00:01.343|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:47][Write-ScreenInfo] Done
VERBOSE: [08:57:47][Write-ScreenInfo] 08:57:47|00:00:20|00:00:01.439|   - Done
08:57:47|00:00:20|00:00:01.439|   - Done
VERBOSE: Add-LabMachineDefinition...leaving...(Time elapsed: 00:00:00:537)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,Ipv4Address=AutomatedLab.IPNetwork[](1))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:068)
VERBOSE: New-LabNetworkAdapterDefinition Entering... (VirtualSwitch=NLBIISLab,Ipv4Address=AutomatedLab.IPNetwork[](1))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: New-LabNetworkAdapterDefinition...leaving...(Time elapsed: 00:00:00:068)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Add-LabMachineDefinition Entering... (Name=IISNODE02,NetworkAdapter=AutomatedLab.NetworkAdapter[](2),DomainName=contoso.com,Processors=2,Memory=2147483648,OperatingSystem=Windows Server 2016 Standard (Desktop Experience))
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:49][Write-ScreenInfo] Adding Hyper-V machine definition 'IISNODE02'
VERBOSE: [08:57:49][Write-ScreenInfo] 08:57:49|00:00:21|00:00:00.001| - Adding Hyper-V machine definition 'IISNODE02'
08:57:49|00:00:21|00:00:00.001| - Adding Hyper-V machine definition 'IISNODE02'
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Get-LabDomainDefinition Entering... )
VERBOSE: [08:57:49][Add-LabMachineDefinition] Detect if a virtual switch already exists with same name as lab being deployed. If so, use this switch for defining network name and address space.
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: [08:57:49][Add-LabMachineDefinition] One or more virtual network(s) has been specified.
VERBOSE: [08:57:49][Add-LabMachineDefinition] Virtual network 'NLBIISLab' specified with address space '10.0.0.0/16'
VERBOSE: [08:57:49][Add-LabMachineDefinition] Address space specified is valid
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... (Name=NLBIISLab)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:50][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:50][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:307)
VERBOSE: [08:57:50][Write-ScreenInfo] The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:50][Write-ScreenInfo] 08:57:50|00:00:23|00:00:01.373|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
08:57:50|00:00:23|00:00:01.373|   - The operating system 'Windows Server 2016 Standard (Desktop Experience)' is available multiple times. Choosing the one with the highest version (10.0.14393.1198)
VERBOSE: [08:57:50][Write-ScreenInfo] Done
VERBOSE: [08:57:50][Write-ScreenInfo] 08:57:50|00:00:23|00:00:01.469|   - Done
08:57:50|00:00:23|00:00:01.469|   - Done
VERBOSE: Add-LabMachineDefinition...leaving...(Time elapsed: 00:00:00:546)
VERBOSE: Install-Lab Entering... )
VERBOSE: Export-LabDefinition Entering... (Force=True,ExportDefaultUnattendedXml=True)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:51][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:51][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:324)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: Get-LabMachineDefinition Entering... (Role=Routing)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: [08:57:51][Export-LabDefinition] Looking for a root DC in the machine's domain 'contoso.com'
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: [08:57:52][Export-LabDefinition] RootDC found, using the IP address of 'DC01' for DNS:
VERBOSE: [08:57:52][Export-LabDefinition] Looking for a root DC in the machine's domain 'contoso.com'
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: [08:57:52][Export-LabDefinition] RootDC found, using the IP address of 'DC01' for DNS:
VERBOSE: [08:57:52][Export-LabDefinition] Looking for a root DC in the machine's domain 'contoso.com'
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: [08:57:52][Export-LabDefinition] RootDC found, using the IP address of 'DC01' for DNS:
VERBOSE: [08:57:52][Export-LabDefinition] Looking for a root DC in the machine's domain 'contoso.com'
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: [08:57:52][Export-LabDefinition] RootDC found, using the IP address of 'DC01' for DNS:
VERBOSE: [08:57:52][Export-LabDefinition] Looking for a root DC in the machine's domain 'contoso.com'
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: [08:57:52][Export-LabDefinition] RootDC found, using the IP address of 'DC01' for DNS:
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:57:53][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:57:53][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:309)
VERBOSE: [08:57:53][Export-LabDefinition] Space needed by HyperV base disks:                     28
VERBOSE: [08:57:53][Export-LabDefinition] Space needed by HyperV base disks but already claimed: -28
VERBOSE: [08:57:53][Export-LabDefinition] Space estimated for HyperV data:                       8
VERBOSE: [08:57:53][Write-ScreenInfo] Estimated (additional) local drive space needed for all machines: 8 GB
VERBOSE: [08:57:53][Write-ScreenInfo] 08:57:53|00:00:26|00:00:26.248| Estimated (additional) local drive space needed for all machines: 8 GB
08:57:53|00:00:26|00:00:26.248| Estimated (additional) local drive space needed for all machines: 8 GB
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:53][Set-LabLocalVirtualMachineDiskAuto] Read 2 drive infos from the cache
VERBOSE: Importing function 'Clear-StorageDiagnosticInfo'.
VERBOSE: Importing function 'Get-StorageDiagnosticInfoInternal'.
VERBOSE: Importing function 'Get-StorageSubSystem'.
VERBOSE: Importing function 'New-MaskingSet'.
VERBOSE: Importing function 'New-StorageFileServer'.
VERBOSE: Importing function 'New-StoragePool'.
VERBOSE: Importing function 'New-StorageSubsystemVirtualDisk'.
VERBOSE: Importing function 'Start-StorageDiagnosticLog'.
VERBOSE: Importing function 'Stop-StorageDiagnosticLog'.
VERBOSE: Importing alias 'Disable-StorageDiagnosticLog'.
VERBOSE: Importing alias 'Enable-StorageDiagnosticLog'.
VERBOSE: Exporting function 'Get-StorageHealth'.
VERBOSE: Exporting function 'Get-StorageHealthSettingInternal'.
VERBOSE: Exporting function 'Remove-StorageHealthSettingInternal'.
VERBOSE: Exporting function 'Set-StorageHealthSettingInternal'.
VERBOSE: Exporting function 'Clear-StorageDiagnosticInfo'.
VERBOSE: Exporting function 'Get-StorageDiagnosticInfoInternal'.
VERBOSE: Exporting function 'Get-StorageSubSystem'.
VERBOSE: Exporting function 'New-MaskingSet'.
VERBOSE: Exporting function 'New-StorageFileServer'.
VERBOSE: Exporting function 'New-StoragePool'.
VERBOSE: Exporting function 'New-StorageSubsystemVirtualDisk'.
VERBOSE: Exporting function 'Start-StorageDiagnosticLog'.
VERBOSE: Exporting function 'Stop-StorageDiagnosticLog'.
VERBOSE: Exporting function 'CreateErrorRecord'.
VERBOSE: Exporting function 'Get-StorageHistory'.
VERBOSE: Exporting function 'Show-StorageHistory'.
VERBOSE: Exporting function 'Get-PhysicalDisk'.
VERBOSE: Exporting function 'Get-PhysicalExtent'.
VERBOSE: Exporting function 'Get-PhysicalExtentAssociation'.
VERBOSE: Exporting function 'Enable-PhysicalDiskIdentification'.
VERBOSE: Exporting function 'Disable-PhysicalDiskIdentification'.
VERBOSE: Exporting function 'Reset-PhysicalDisk'.
VERBOSE: Exporting function 'Get-StorageFirmwareInformation'.
VERBOSE: Exporting function 'Update-StorageFirmware'.
VERBOSE: Exporting function 'Get-PhysicalDiskStorageNodeView'.
VERBOSE: Exporting function 'Get-DiskStorageNodeView'.
VERBOSE: Exporting function 'Get-StorageEnclosureStorageNodeView'.
VERBOSE: Exporting function 'Get-StorageHealthAction'.
VERBOSE: Exporting function 'Get-StorageFaultDomain'.
VERBOSE: Exporting function 'Get-StorageScaleUnit'.
VERBOSE: Exporting function 'Get-StorageChassis'.
VERBOSE: Exporting function 'Get-StorageRack'.
VERBOSE: Exporting function 'Get-StorageSite'.
VERBOSE: Exporting function 'ValidateFaultDomainsExist'.
VERBOSE: Exporting function 'Add-StorageFaultDomain'.
VERBOSE: Exporting function 'Remove-StorageFaultDomain'.
VERBOSE: Exporting function 'New-Volume'.
VERBOSE: Exporting function 'Get-StorageExtendedStatus'.
VERBOSE: Exporting function 'Get-StorageAdvancedProperty'.
VERBOSE: Exporting function 'Get-StorageHealthReport'.
VERBOSE: Exporting function 'Get-StorageHealthSetting'.
VERBOSE: Exporting function 'Set-StorageHealthSetting'.
VERBOSE: Exporting function 'Remove-StorageHealthSetting'.
VERBOSE: Exporting function 'Debug-StorageSubSystem'.
VERBOSE: Exporting function 'Debug-FileShare'.
VERBOSE: Exporting function 'Debug-Volume'.
VERBOSE: Exporting function 'Enable-StorageMaintenanceMode'.
VERBOSE: Exporting function 'Disable-StorageMaintenanceMode'.
VERBOSE: Exporting function 'Get-StorageDiagnosticInfo'.
VERBOSE: Exporting function 'Remove-StorageHealthIntent'.
VERBOSE: Exporting alias 'Disable-StorageDiagnosticLog'.
VERBOSE: Exporting alias 'Enable-StorageDiagnosticLog'.
VERBOSE: Exporting alias 'Enable-PhysicalDiskIndication'.
VERBOSE: Exporting alias 'Disable-PhysicalDiskIndication'.
VERBOSE: Exporting alias 'Get-PhysicalDiskSNV'.
VERBOSE: Exporting alias 'Get-DiskSNV'.
VERBOSE: Exporting alias 'Get-StorageEnclosureSNV'.
VERBOSE: Operation '' complete.
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_DiskDrive'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskDrive.DeviceID="\\\\.\\PHYSICALDRIVE0"} WHERE AssocClass=Win32_DiskDriveToDiskPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskPartition.DeviceID="Disk #0, Partition #0"} WHERE AssocClass=Win32_LogicalDiskToPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskPartition.DeviceID="Disk #0, Partition #1"} WHERE AssocClass=Win32_LogicalDiskToPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskPartition.DeviceID="Disk #0, Partition #2"} WHERE AssocClass=Win32_LogicalDiskToPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskPartition.DeviceID="Disk #0, Partition #3"} WHERE AssocClass=Win32_LogicalDiskToPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskDrive.DeviceID="\\\\.\\PHYSICALDRIVE1"} WHERE AssocClass=Win32_DiskDriveToDiskPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = ASSOCIATORS OF {Win32_DiskPartition.DeviceID="Disk #1, Partition #0"} WHERE AssocClass=Win32_LogicalDiskToPartition,'queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] Measuring speed on fixed drives...
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] (cached) Measurements for drive C: (serial: ) (signature: 0): Read=604 MB/s  Write=1476 MB/s  Total=2080 MB/s
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] (cached) Measurements for drive E: (serial: ) (signature: 0): Read=15 MB/s  Write=12 MB/s  Total=27 MB/s
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] Boot drive is drive 'C:'
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] Selecing drive C for VMs based on speed though this drive is actually the boot drive but is much faster than second fastest drive (E)
VERBOSE: [08:57:56][Set-LabLocalVirtualMachineDiskAuto] Selected system disk, speed of next fastest disk compared to system disk is 1.31%
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:56][Write-ScreenInfo] Location of Hyper-V machines will be 'C:\AutomatedLab-VMs'
VERBOSE: [08:57:56][Write-ScreenInfo] 08:57:56|00:00:29|00:00:29.674| Location of Hyper-V machines will be 'C:\AutomatedLab-VMs'
08:57:56|00:00:29|00:00:29.674| Location of Hyper-V machines will be 'C:\AutomatedLab-VMs'
VERBOSE: Export-LabDefinition...leaving...(Time elapsed: 00:00:00:466)
VERBOSE: [08:57:57][Write-ScreenInfo] Done
VERBOSE: [08:57:57][Write-ScreenInfo] 08:57:57|00:00:30|00:00:30.052| Done
08:57:57|00:00:30|00:00:30.052| Done
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Import-Lab Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Lab.xml)
VERBOSE: Clear-Lab Entering... )
VERBOSE: Clear-Lab...leaving...(Time elapsed: 00:00:00:089)
VERBOSE: Test-LabHostRemoting Entering... )
VERBOSE: Test-LabHostRemoting...leaving...(Time elapsed: 00:00:00:203)
VERBOSE: [08:57:57][Write-ScreenInfo] Validating lab definition
VERBOSE: [08:57:57][Write-ScreenInfo] 08:57:57|00:00:30|00:00:00.000| Validating lab definition
08:57:57|00:00:30|00:00:00.000| Validating lab definition
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: [08:57:58][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:57:58][Get-HostFile] File loaded with 30 lines
VERBOSE: [08:57:58][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:57:58][Get-HostFile] File loaded with 30 lines
VERBOSE: [08:57:58][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:57:58][Get-HostFile] File loaded with 30 lines
VERBOSE: [08:57:58][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:57:58][Get-HostFile] File loaded with 30 lines
VERBOSE: Test-LabDefinition Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Lab.xml,Quiet=True)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:57:58][Test-LabDefinition] There are 1 machine XML file referenced in the lab xml file
VERBOSE: [08:57:58][Test-LabDefinition] Starting validation against all xml files
VERBOSE: [08:57:59][Write-ScreenInfo] Could not invoke validator AutomatedLab.UnknownRoleProperties
VERBOSE: [08:57:59][Write-ScreenInfo] 08:57:59|00:00:31|00:00:01.237| - Could not invoke validator AutomatedLab.UnknownRoleProperties
08:57:59|00:00:31|00:00:01.237| - Could not invoke validator AutomatedLab.UnknownRoleProperties
VERBOSE: [08:57:59][Test-LabDefinition] Lab Validation complete, overvall runtime was 00:00:00.5429277
VERBOSE: Test-LabDefinition...leaving...(Time elapsed: 00:00:01:138)
VERBOSE: [08:57:59][Write-ScreenInfo] Success
VERBOSE: [08:57:59][Write-ScreenInfo] 08:57:59|00:00:32|00:00:01.691| - Success
08:57:59|00:00:32|00:00:01.691| - Success
VERBOSE: [08:58:00][Write-ScreenInfo] Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: [08:58:00][Write-ScreenInfo] 08:58:00|00:00:32|00:00:00.002| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
08:58:00|00:00:32|00:00:00.002| Lab 'NLBIISLab' hosted on 'HyperV' imported with 4 machines
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Get-LabAzureDefaultLocation Entering... (ErrorAction=<null>)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Import-Lab...leaving - return value is 'True'...(Time elapsed: 00:00:00:622)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Unblock-LabSources Entering... )
VERBOSE: [08:58:01][Unblock-LabSources] Imported Cache\Timestamps from regirtry
VERBOSE: [08:58:01][Unblock-LabSources] Last unblock less than 24 hours ago, doing nothing
VERBOSE: Unblock-LabSources...leaving...(Time elapsed: 00:00:00:075)
VERBOSE: Get-LabVM Entering... )
VERBOSE: [08:58:01][Send-ALNotification] Send-ALToastNotification
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: Update-LabMemorySettings Entering... )
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: Update-LabMemorySettings...leaving...(Time elapsed: 00:00:00:087)
VERBOSE: [08:58:02][Write-ScreenInfo] Creating virtual networks
VERBOSE: [08:58:02][Write-ScreenInfo] 08:58:02|00:00:35|00:00:00.001| Creating virtual networks
08:58:02|00:00:35|00:00:00.001| Creating virtual networks
VERBOSE: New-LabNetworkSwitches Entering... )
VERBOSE: [08:58:02][New-LabNetworkSwitches] Creating network switch ''...
VERBOSE: New-LWHypervNetworkSwitch Entering... (VirtualNetwork=AutomatedLab.VirtualNetwork[](1))
VERBOSE: [08:58:02][Write-ScreenInfo] Creating Hyper-V virtual network 'NLBIISLab'
VERBOSE: [08:58:02][Write-ScreenInfo] 08:58:02|00:00:35|00:00:00.000| - Creating Hyper-V virtual network 'NLBIISLab'
08:58:02|00:00:35|00:00:00.000| - Creating Hyper-V virtual network 'NLBIISLab'
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_NetworkAdapter'.
VERBOSE: Perform operation 'Enumerate Associated CimInstances' with following parameters, ''sourceRole' = ,'sourceInstance' = Win32_NetworkAdapter: [00000030] Hyper-V Virtual Ethernet Adapter (DeviceID = "30"),'associationClassName' = ,'namespaceName' = root/cimv2,'resultClassName' = Win32_NetworkAdapterConfiguration,'resultRole' = '.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: Operation 'Enumerate Associated CimInstances' complete.
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Perform operation 'Invoke CimMethod' with following parameters, ''instance' = Win32_NetworkAdapterConfiguration: [00000030] Hyper-V Virtual Ethernet Adapter (Index = 30),'methodName' = EnableStatic,'namespaceName' = root/cimv2'.
VERBOSE: Operation 'Invoke CimMethod' complete.
VERBOSE: [08:58:07][Write-ScreenInfo] Done
VERBOSE: [08:58:07][Write-ScreenInfo] 08:58:07|00:00:40|00:00:04.489|   - Done
08:58:07|00:00:40|00:00:04.489|   - Done
VERBOSE: New-LWHypervNetworkSwitch...leaving...(Time elapsed: 00:00:00:384)
VERBOSE: [08:58:07][New-LabNetworkSwitches] done
VERBOSE: New-LabNetworkSwitches...leaving...(Time elapsed: 00:00:00:645)
VERBOSE: [08:58:07][Write-ScreenInfo] Done
VERBOSE: [08:58:07][Write-ScreenInfo] 08:58:07|00:00:40|00:00:05.327| - Done
08:58:07|00:00:40|00:00:05.327| - Done
VERBOSE: Get-LabVM Entering... (All=True)
VERBOSE: [08:58:08][Write-ScreenInfo] done
VERBOSE: [08:58:08][Write-ScreenInfo] 08:58:08|00:00:40|00:00:08.035| done
08:58:08|00:00:40|00:00:08.035| done
VERBOSE: [08:58:08][Write-ScreenInfo] Creating base images
VERBOSE: [08:58:08][Write-ScreenInfo] 08:58:08|00:00:40|00:00:00.002| Creating base images
08:58:08|00:00:40|00:00:00.002| Creating base images
VERBOSE: New-LabBaseImages Entering... )
VERBOSE: Get-LabVM Entering... (All=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:08][New-LabBaseImages] Host OS version is '10.0.18363' and OS to create disk for is version '10.0.14393.1198'. So, setting partition style to GPT.
VERBOSE: [08:58:08][New-LabBaseImages] The base image C:\AutomatedLab-VMs\BASE_WindowsServer2016Standard(DesktopExperience)_10.0.14393.1198.vhdx already exists
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:08][New-LabBaseImages] Host OS version is '10.0.18363' and OS to create disk for is version '10.0.14393.1198'. So, setting partition style to GPT.
VERBOSE: [08:58:08][New-LabBaseImages] Base disk for operating system 'Windows Server 2016 Standard (Desktop Experience)' already created previously
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:09][New-LabBaseImages] Host OS version is '10.0.18363' and OS to create disk for is version '10.0.14393.1198'. So, setting partition style to GPT.
VERBOSE: [08:58:09][New-LabBaseImages] Base disk for operating system 'Windows Server 2016 Standard (Desktop Experience)' already created previously
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:09][New-LabBaseImages] Host OS version is '10.0.18363' and OS to create disk for is version '10.0.14393.1198'. So, setting partition style to GPT.
VERBOSE: [08:58:09][New-LabBaseImages] Base disk for operating system 'Windows Server 2016 Standard (Desktop Experience)' already created previously
VERBOSE: [08:58:09][Write-ScreenInfo] All base images were created previously
VERBOSE: [08:58:09][Write-ScreenInfo] 08:58:09|00:00:42|00:00:01.101| - All base images were created previously
08:58:09|00:00:42|00:00:01.101| - All base images were created previously
VERBOSE: Start-ShellHWDetectionService Entering... )
VERBOSE: [08:58:09][Start-ShellHWDetectionService] Starting the ShellHWDetection service (Shell Hardware Detection) again.
VERBOSE: Start-ShellHWDetectionService...leaving...(Time elapsed: 00:00:01:398)
VERBOSE: New-LabBaseImages...leaving...(Time elapsed: 00:00:01:486)
VERBOSE: [08:58:10][Write-ScreenInfo] Done
VERBOSE: [08:58:10][Write-ScreenInfo] 08:58:10|00:00:43|00:00:02.748| - Done
08:58:10|00:00:43|00:00:02.748| - Done
VERBOSE: [08:58:11][Write-ScreenInfo] done
VERBOSE: [08:58:11][Write-ScreenInfo] 08:58:11|00:00:43|00:00:10.969| done
08:58:11|00:00:43|00:00:10.969| done
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: [08:58:11][Write-ScreenInfo] Creating Additional Disks
VERBOSE: [08:58:11][Write-ScreenInfo] 08:58:11|00:00:44|00:00:00.001| Creating Additional Disks
08:58:11|00:00:44|00:00:00.001| Creating Additional Disks
VERBOSE: New-LabVHDX Entering... )
VERBOSE: [08:58:11][New-LabVHDX] Stopping the ShellHWDetection service (Shell Hardware Detection) to prevent the OS from responding to the new disks.
VERBOSE: Stop-ShellHWDetectionService Entering... )
VERBOSE: [08:58:11][Stop-ShellHWDetectionService] Stopping the ShellHWDetection service (Shell Hardware Detection) to prevent the OS from responding to the new disks.
VERBOSE: Stop-ShellHWDetectionService...leaving...(Time elapsed: 00:00:01:827)
VERBOSE: [08:58:13][New-LabVHDX] No disks found to create. Either the given name is wrong or there is no disk defined yet
VERBOSE: New-LabVHDX...leaving...(Time elapsed: 00:00:01:916)
VERBOSE: [08:58:13][Write-ScreenInfo] Done
VERBOSE: [08:58:13][Write-ScreenInfo] 08:58:13|00:00:46|00:00:02.169| - Done
08:58:13|00:00:46|00:00:02.169| - Done
VERBOSE: [08:58:13][Write-ScreenInfo] Creating VMs
VERBOSE: [08:58:13][Write-ScreenInfo] 08:58:13|00:00:46|00:00:00.002| Creating VMs
08:58:13|00:00:46|00:00:00.002| Creating VMs
VERBOSE: [08:58:13][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:13][Get-HostFile] File loaded with 30 lines
VERBOSE: [08:58:13][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:13][Get-HostFile] File loaded with 33 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 34 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 35 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 36 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 37 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 38 lines
VERBOSE: [08:58:14][Get-HostFile] Opening file 'C:\WINDOWS\System32\drivers\etc\hosts'
VERBOSE: [08:58:14][Get-HostFile] File loaded with 39 lines
VERBOSE: [08:58:14][Write-ScreenInfo] The hosts file has been added 8 records. Clean them up using 'Remove-Lab' or manually if needed
VERBOSE: [08:58:14][Write-ScreenInfo] 08:58:14|00:00:47|00:00:01.277| - The hosts file has been added 8 records. Clean them up using 'Remove-Lab' or manually if needed
08:58:14|00:00:47|00:00:01.277| - The hosts file has been added 8 records. Clean them up using 'Remove-Lab' or manually if needed
VERBOSE: New-LabVM Entering... (Name=System.Object[],CreateCheckPoints=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True,ErrorAction=Stop)
VERBOSE: [08:58:15][Write-ScreenInfo] Creating HyperV machine 'DC01'
08:58:15|00:00:48|00:00:00.001| - Creating HyperV machine 'DC01'
VERBOSE: [08:58:15][Write-ScreenInfo] 08:58:15|00:00:48|00:00:00.001| - Creating HyperV machine 'DC01'
VERBOSE: New-LWHypervVM Entering... (Machine=DC01,ProgressIndicator=1)
VERBOSE: [08:58:15][New-LWHypervVM] Creating machine with the name 'DC01' in the path ''
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (Role=RootDC, FirstChildDC)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:19][New-LWHypervVM] 	VM Disk path is 'C:\AutomatedLab-VMs\DC01\DC01.vhdx'
VERBOSE: [08:58:19][Write-ScreenInfo] .
.
VERBOSE: [08:58:20][New-LWHypervVM] 	created differencing disk 'C:\AutomatedLab-VMs\DC01\DC01.vhdx' pointing to ''
VERBOSE: [08:58:20][Write-ScreenInfo] .
.
VERBOSE: Set-LWHypervVMDescription Entering... (ComputerName=DC01,Hashtable=System.Collections.Hashtable)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:175)
VERBOSE: [08:58:22][New-LWHypervVM] 	Machine '' created
VERBOSE: [08:58:22][Write-ScreenInfo] .
.
VERBOSE: [08:58:24][New-LWHypervVM] 	Disk mounted to drive D:
VERBOSE: [08:58:24][New-LWHypervVM] 	Unattended file copied to VM Disk 'D:\unattend.xml'
VERBOSE: [08:58:24][New-LWHypervVM] Copying AL tools to VHD...
VERBOSE: [08:58:24][New-LWHypervVM] ...done
VERBOSE: [08:58:24][New-LWHypervVM] 	disk image dismounted
VERBOSE: [08:58:24][Write-ScreenInfo] .
.
VERBOSE: [08:58:24][New-LWHypervVM] 	Settings RAM, start and stop actions
VERBOSE: [08:58:24][New-LWHypervVM] 	Settings static memory to 2147483648
VERBOSE: [08:58:25][New-LWHypervVM] Creating snapshot named 'DC01 - post OS Installation'
VERBOSE: [08:58:25][Write-ScreenInfo] .
.
VERBOSE: New-LWHypervVM...leaving...(Time elapsed: 00:00:03:302)
VERBOSE: Start-LabVM Entering... (ComputerName=DC01,NoNewline=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:113)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:200)
VERBOSE: [08:58:26][Start-LabVM] Starting VMs 'DC01'
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:103)
VERBOSE: Start-LWHypervVM...leaving...(Time elapsed: 00:00:00:538)
VERBOSE: Start-LabVM...leaving...(Time elapsed: 00:00:00:633)
VERBOSE: [08:58:27][Write-ScreenInfo] Done
VERBOSE: [08:58:27][Write-ScreenInfo] 08:58:27|00:01:00|00:00:12.327|   - Done
08:58:27|00:01:00|00:00:12.327|   - Done
VERBOSE: [08:58:27][Write-ScreenInfo] Creating HyperV machine 'CA01'
08:58:27|00:01:00|00:00:00.002| - Creating HyperV machine 'CA01'
VERBOSE: [08:58:27][Write-ScreenInfo] 08:58:27|00:01:00|00:00:00.002| - Creating HyperV machine 'CA01'
VERBOSE: New-LWHypervVM Entering... (Machine=CA01,ProgressIndicator=1)
VERBOSE: [08:58:27][New-LWHypervVM] Creating machine with the name 'CA01' in the path ''
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (Role=RootDC, FirstChildDC)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:32][New-LWHypervVM] 	VM Disk path is 'C:\AutomatedLab-VMs\CA01\CA01.vhdx'
VERBOSE: [08:58:32][Write-ScreenInfo] .
.
VERBOSE: [08:58:33][New-LWHypervVM] 	created differencing disk 'C:\AutomatedLab-VMs\CA01\CA01.vhdx' pointing to ''
VERBOSE: [08:58:33][Write-ScreenInfo] .
.
VERBOSE: Set-LWHypervVMDescription Entering... (ComputerName=CA01,Hashtable=System.Collections.Hashtable)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:153)
VERBOSE: [08:58:34][New-LWHypervVM] 	Machine '' created
VERBOSE: [08:58:35][Write-ScreenInfo] .
.
VERBOSE: [08:58:35][New-LWHypervVM] 	Disk mounted to drive D:
VERBOSE: [08:58:35][New-LWHypervVM] 	Unattended file copied to VM Disk 'D:\unattend.xml'
VERBOSE: [08:58:35][New-LWHypervVM] Copying AL tools to VHD...
VERBOSE: [08:58:36][New-LWHypervVM] ...done
VERBOSE: [08:58:36][New-LWHypervVM] 	disk image dismounted
VERBOSE: [08:58:36][Write-ScreenInfo] .
.
VERBOSE: [08:58:36][New-LWHypervVM] 	Settings RAM, start and stop actions
VERBOSE: [08:58:36][New-LWHypervVM] 	Settings static memory to 2147483648
VERBOSE: [08:58:36][New-LWHypervVM] Creating snapshot named 'CA01 - post OS Installation'
VERBOSE: [08:58:36][Write-ScreenInfo] .
.
VERBOSE: New-LWHypervVM...leaving...(Time elapsed: 00:00:02:461)
VERBOSE: [08:58:37][Write-ScreenInfo] Done
VERBOSE: [08:58:37][Write-ScreenInfo] 08:58:37|00:01:09|00:00:09.257|   - Done
08:58:37|00:01:09|00:00:09.257|   - Done
VERBOSE: [08:58:37][Write-ScreenInfo] Creating HyperV machine 'IISNODE01'
08:58:37|00:01:09|00:00:00.002| - Creating HyperV machine 'IISNODE01'
VERBOSE: [08:58:37][Write-ScreenInfo] 08:58:37|00:01:09|00:00:00.002| - Creating HyperV machine 'IISNODE01'
VERBOSE: New-LWHypervVM Entering... (Machine=IISNODE01,ProgressIndicator=1)
VERBOSE: [08:58:37][New-LWHypervVM] Creating machine with the name 'IISNODE01' in the path ''
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (Role=RootDC, FirstChildDC)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:42][New-LWHypervVM] 	VM Disk path is 'C:\AutomatedLab-VMs\IISNODE01\IISNODE01.vhdx'
VERBOSE: [08:58:42][Write-ScreenInfo] .
.
VERBOSE: [08:58:43][New-LWHypervVM] 	created differencing disk 'C:\AutomatedLab-VMs\IISNODE01\IISNODE01.vhdx' pointing to ''
VERBOSE: [08:58:43][Write-ScreenInfo] .
.
VERBOSE: Set-LWHypervVMDescription Entering... (ComputerName=IISNODE01,Hashtable=System.Collections.Hashtable)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:123)
VERBOSE: [08:58:45][New-LWHypervVM] 	Machine '' created
VERBOSE: [08:58:45][Write-ScreenInfo] .
.
VERBOSE: [08:58:45][New-LWHypervVM] 	Disk mounted to drive D:
VERBOSE: [08:58:45][New-LWHypervVM] 	Unattended file copied to VM Disk 'D:\unattend.xml'
VERBOSE: [08:58:45][New-LWHypervVM] Copying AL tools to VHD...
VERBOSE: [08:58:46][New-LWHypervVM] ...done
VERBOSE: [08:58:46][New-LWHypervVM] 	disk image dismounted
VERBOSE: [08:58:46][Write-ScreenInfo] .
.
VERBOSE: [08:58:46][New-LWHypervVM] 	Settings RAM, start and stop actions
VERBOSE: [08:58:46][New-LWHypervVM] 	Settings static memory to 2147483648
VERBOSE: [08:58:46][New-LWHypervVM] Creating snapshot named 'IISNODE01 - post OS Installation'
VERBOSE: [08:58:46][Write-ScreenInfo] .
.
VERBOSE: New-LWHypervVM...leaving...(Time elapsed: 00:00:02:205)
VERBOSE: [08:58:47][Write-ScreenInfo] Done
VERBOSE: [08:58:47][Write-ScreenInfo] 08:58:47|00:01:19|00:00:09.800|   - Done
08:58:47|00:01:19|00:00:09.800|   - Done
VERBOSE: [08:58:47][Write-ScreenInfo] Creating HyperV machine 'IISNODE02'
08:58:47|00:01:19|00:00:00.002| - Creating HyperV machine 'IISNODE02'
VERBOSE: [08:58:47][Write-ScreenInfo] 08:58:47|00:01:19|00:00:00.002| - Creating HyperV machine 'IISNODE02'
VERBOSE: New-LWHypervVM Entering... (Machine=IISNODE02,ProgressIndicator=1)
VERBOSE: [08:58:47][New-LWHypervVM] Creating machine with the name 'IISNODE02' in the path ''
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (Role=RootDC, FirstChildDC)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = root\cimv2,'className' = Win32_OperatingSystem'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:51][New-LWHypervVM] 	VM Disk path is 'C:\AutomatedLab-VMs\IISNODE02\IISNODE02.vhdx'
VERBOSE: [08:58:51][Write-ScreenInfo] .
.
VERBOSE: [08:58:52][New-LWHypervVM] 	created differencing disk 'C:\AutomatedLab-VMs\IISNODE02\IISNODE02.vhdx' pointing to ''
VERBOSE: [08:58:52][Write-ScreenInfo] .
.
VERBOSE: Set-LWHypervVMDescription Entering... (ComputerName=IISNODE02,Hashtable=System.Collections.Hashtable)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:132)
VERBOSE: [08:58:54][New-LWHypervVM] 	Machine '' created
VERBOSE: [08:58:54][Write-ScreenInfo] .
.
VERBOSE: [08:58:54][New-LWHypervVM] 	Disk mounted to drive D:
VERBOSE: [08:58:54][New-LWHypervVM] 	Unattended file copied to VM Disk 'D:\unattend.xml'
VERBOSE: [08:58:54][New-LWHypervVM] Copying AL tools to VHD...
VERBOSE: [08:58:54][New-LWHypervVM] ...done
VERBOSE: [08:58:55][New-LWHypervVM] 	disk image dismounted
VERBOSE: [08:58:55][Write-ScreenInfo] .
.
VERBOSE: [08:58:55][New-LWHypervVM] 	Settings RAM, start and stop actions
VERBOSE: [08:58:55][New-LWHypervVM] 	Settings static memory to 2147483648
VERBOSE: [08:58:55][New-LWHypervVM] Creating snapshot named 'IISNODE02 - post OS Installation'
VERBOSE: [08:58:55][Write-ScreenInfo] .
.
VERBOSE: New-LWHypervVM...leaving...(Time elapsed: 00:00:02:262)
VERBOSE: [08:58:55][Write-ScreenInfo] Done
VERBOSE: [08:58:55][Write-ScreenInfo] 08:58:55|00:01:28|00:00:08.840|   - Done
08:58:55|00:01:28|00:00:08.840|   - Done
VERBOSE: [08:58:56][Write-ScreenInfo] Waiting for all machines to finish installing
VERBOSE: [08:58:56][Write-ScreenInfo] 08:58:56|00:01:28|00:00:00.001| - Waiting for all machines to finish installing
08:58:56|00:01:28|00:00:00.001| - Waiting for all machines to finish installing
VERBOSE: [08:58:56][Write-ScreenInfo] Done
VERBOSE: [08:58:56][Write-ScreenInfo] 08:58:56|00:01:28|00:00:00.105|   - Done
08:58:56|00:01:28|00:00:00.105|   - Done
VERBOSE: New-LabVM...leaving...(Time elapsed: 00:00:02:677)
VERBOSE: Export-LabDefinition Entering... (Force=True,ExportDefaultUnattendedXml=True,Silent=True)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:57][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:58:57][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:462)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... (Role=RootDC)
VERBOSE: Get-LabMachineDefinition Entering... (Role=Routing)
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabMachineDefinition Entering... )
VERBOSE: Get-LabAvailableOperatingSystem Entering... (NoDisplay=True)
VERBOSE: Perform operation 'Enumerate CimInstances' with following parameters, ''namespaceName' = Root\CIMv2,'className' = Win32_LogicalDisk'.
VERBOSE: Operation 'Enumerate CimInstances' complete.
VERBOSE: [08:58:58][Get-LabAvailableOperatingSystem] Found 8 ISO files
VERBOSE: [08:58:59][Get-LabAvailableOperatingSystem] Cached data is still up to date
VERBOSE: Get-LabAvailableOperatingSystem...leaving - return value is 'Windows Server 2019 Standard Windows Server 2019 Standard (Desktop Experience) Windows Server 2019 Datacenter Windows Server 2019 Datacenter (Desktop Experience) Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows 10 Enterprise LTSC Windows 10 Enterprise N LTSC Windows Server 2016 Standard Windows Server 2016 Standard (Desktop Experience) Windows Server 2016 Datacenter Windows Server 2016 Datacenter (Desktop Experience) Windows Server 2012 R2 Standard (Server Core Installation) Windows Server 2012 R2 Standard (Server with a GUI) Windows Server 2012 R2 Datacenter (Server Core Installation) Windows Server 2012 R2 Datacenter (Server with a GUI)'...(Time elapsed: 00:00:00:539)
VERBOSE: [08:58:59][Export-LabDefinition] Space needed by HyperV base disks:                     28
VERBOSE: [08:58:59][Export-LabDefinition] Space needed by HyperV base disks but already claimed: -28
VERBOSE: [08:58:59][Export-LabDefinition] Space estimated for HyperV data:                       0
VERBOSE: Get-LabDefinition Entering... )
VERBOSE: [08:58:59][Export-LabDefinition] Calling 'Get-LabFreeDiskSpace' targeting path 'C:\AutomatedLab-VMs'
VERBOSE: [08:58:59][Export-LabDefinition] Free disk space is '86.5GB'
VERBOSE: Export-LabDefinition...leaving...(Time elapsed: 00:00:00:678)
VERBOSE: [08:59:00][Write-ScreenInfo] Done
VERBOSE: [08:59:00][Write-ScreenInfo] 08:59:00|00:01:32|00:00:46.593| - Done
08:59:00|00:01:32|00:00:46.593| - Done
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: [08:59:00][Write-ScreenInfo] Installing Root Domain Controllers
VERBOSE: [08:59:00][Write-ScreenInfo] 08:59:00|00:01:33|00:00:00.001| Installing Root Domain Controllers
08:59:00|00:01:33|00:00:00.001| Installing Root Domain Controllers
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: [08:59:00][Write-ScreenInfo] Machines with RootDC role to be installed: 'DC01'
VERBOSE: [08:59:00][Write-ScreenInfo] 08:59:00|00:01:33|00:00:00.304| - Machines with RootDC role to be installed: 'DC01'
08:59:00|00:01:33|00:00:00.304| - Machines with RootDC role to be installed: 'DC01'
VERBOSE: Install-LabRootDcs Entering... (CreateCheckPoints=<null>)
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: [08:59:01][Write-ScreenInfo] Waiting for machines to start up
08:59:01|00:01:34|00:00:01.453| - Waiting for machines to start up
VERBOSE: [08:59:02][Write-ScreenInfo] 08:59:01|00:01:34|00:00:01.453| - Waiting for machines to start up
VERBOSE: Start-LabVM Entering... (RoleName=RootDC,Wait=True,DoNotUseCredSsp=True,ProgressIndicator=10,PostDelaySeconds=5)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:116)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:203)
VERBOSE: [08:59:03][Start-LabVM] Starting VMs ''
VERBOSE: Wait-LabVM Entering... (ComputerName=DC01,TimeoutInMinutes=60,DoNotUseCredSsp=True,ProgressIndicator=10,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [08:59:04][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:319)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:115)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [08:59:05][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [08:59:05][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [08:59:05][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: Connection Timeout
VERBOSE: [08:59:07][New-LabPSSession] Port was NOT open, cannot create session.
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: '...(Time elapsed: 00:00:08:028)
VERBOSE: [08:59:13][Wait-LabVM] Computer '' was not reachable, waiting...
VERBOSE: [08:59:13][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [08:59:13][Write-ScreenInfo] .
.
VERBOSE: [08:59:23][Write-ScreenInfo] .
.
VERBOSE: [08:59:34][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:27:026)
VERBOSE: [08:59:40][Wait-LabVM] The following machines are ready: DC01
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=DC01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:457)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [08:59:42][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:146)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:251)
VERBOSE: [08:59:44][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [08:59:45][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [08:59:45][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [08:59:45][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [08:59:45][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [08:59:46][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 1'...(Time elapsed: 00:00:00:139)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [08:59:46][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [08:59:48][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:01:494)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:707)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=DC01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:457)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:554)
VERBOSE: [08:59:49][Write-ScreenInfo] .
.
VERBOSE: Start-LabVM...leaving...(Time elapsed: 00:00:00:779)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [08:59:50][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:143)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:254)
VERBOSE: [08:59:51][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [08:59:52][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [08:59:52][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [08:59:52][New-LabPSSession] Session DC01_8ccdf947-25d6-4cc1-bee5-5ba8a147e321 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 1'...(Time elapsed: 00:00:00:464)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [08:59:53][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
Cannot find any service with service name 'ADWS'.
    + CategoryInfo          : ObjectNotFound: (ADWS:String) [Get-Service], ServiceCommandException
    + FullyQualifiedErrorId : NoServiceFoundForGivenName,Microsoft.PowerShell.Commands.GetServiceCommand
    + PSComputerName        : DC01
Cannot find any service with service name 'ADWS'.
    + CategoryInfo          : ObjectNotFound: (ADWS:String) [Get-Service], ServiceCommandException
    + FullyQualifiedErrorId : NoServiceFoundForGivenName,Microsoft.PowerShell.Commands.GetServiceCommand
    + PSComputerName        : DC01

VERBOSE: [08:59:53][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:896)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:135)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:01:241)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=Create folder 'C:\DeployDebug' for debug info,NoDisplay=True,ScriptBlock=
            New-Item -ItemType Directory -Path 'c:\DeployDebug' -ErrorAction SilentlyContinue | Out-Null

            $acl = Get-Acl -Path C:\DeployDebug
            $rule = New-Object System.Security.AccessControl.FileSystemAccessRule('Everyone', 'Read', 'ObjectInherit', 'None', 'Allow')
            $acl.AddAccessRule($rule)
            Set-Acl -Path C:\DeployDebug -AclObject $acl
        ,DoNotUseCredSsp=True)
VERBOSE: [08:59:55][Invoke-LabCommand] Executing lab command activity 'Create folder 'C:\DeployDebug' for debug info' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:157)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:266)
VERBOSE: [08:59:56][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [08:59:57][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [08:59:57][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [08:59:57][New-LabPSSession] Session DC01_8ccdf947-25d6-4cc1-bee5-5ba8a147e321 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 1'...(Time elapsed: 00:00:00:359)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=
            New-Item -ItemType Directory -Path 'c:\DeployDebug' -ErrorAction SilentlyContinue | Out-Null

            $acl = Get-Acl -Path C:\DeployDebug
            $rule = New-Object System.Security.AccessControl.FileSystemAccessRule('Everyone', 'Read', 'ObjectInherit', 'None', 'Allow')
            $acl.AddAccessRule($rule)
            Set-Acl -Path C:\DeployDebug -AclObject $acl
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Create folder 'C:\DeployDebug' for debug info)
VERBOSE: [08:59:57][Invoke-LWCommand] Starting Activity 'Create folder 'C:\DeployDebug' for debug info'
VERBOSE: [08:59:57][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_87b97753-43f2-491f-a364-12e6abaa7cdf'
VERBOSE: [08:59:57][Invoke-LWCommand] Finished Installation Activity 'Create folder 'C:\DeployDebug' for debug info'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:349)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:531)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=Install Root DC (DC01),AsJob=True,UseLocalCredential=True,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ScriptBlock=
    param (
        [string]$DomainName,
        [string]$Password,
        [string]$ForestFunctionalLevel,
        [string]$DomainFunctionalLevel,
        [string]$NetBiosDomainName,
        [string]$DatabasePath,
        [string]$LogPath,
        [string]$SysvolPath,
        [string]$DsrmPassword
    )

    $VerbosePreference = $using:VerbosePreference

    Start-Transcript -Path C:\DeployDebug\ALDCPromo.log

    ([WMIClass]'Win32_NetworkAdapterConfiguration').SetDNSSuffixSearchOrder($DomainName) | Out-Null

    Write-Verbose -Message "Starting installation of Root Domain Controller on '$(HOSTNAME.EXE)'"

    Write-Verbose -Message 'Installing AD-Domain-Services windows feature'
    $result = Install-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools
    if (-not $result.Success)
    {
        throw 'Could not install AD-Domain-Services windows feature'
    }
    else
    {
        Write-Verbose -Message 'AD-Domain-Services windows feature installed successfully'
    }

    $safeDsrmPassword = ConvertTo-SecureString -String $DsrmPassword -AsPlainText -Force

    Write-Verbose -Message "Creating a new forest named '$DomainName' on the machine '$(HOSTNAME.EXE)'"
    $result = Install-ADDSForest -DomainName $DomainName `
    -SafeModeAdministratorPassword $safeDsrmPassword `
    -InstallDNS `
    -DomainMode $DomainFunctionalLevel `
    -Force `
    -ForestMode $ForestFunctionalLevel `
    -DomainNetbiosName $NetBiosDomainName `
    -SysvolPath $SysvolPath `
    -DatabasePath $DatabasePath `
    -LogPath $LogPath

    if ($result.Status -eq 'Error')
    {
        throw 'Could not install new domain'
    }
    else
    {
        Write-Verbose -Message 'AD-Domain-Services windows feature installed successfully'
    }

    Set-ItemProperty -Path Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters -Name 'Repl Perform Initial Synchronizations' -Value 0 -Type DWord

    Write-Verbose -Message 'finished installing the Root Domain Controller'
,ArgumentList=System.Object[])
VERBOSE: [08:59:58][Invoke-LabCommand] Executing lab command activity 'Install Root DC (DC01)' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:113)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:205)
VERBOSE: [08:59:59][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=True,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:00:00][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:00:00][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:00:00][New-LabPSSession] Session DC01_8ccdf947-25d6-4cc1-bee5-5ba8a147e321 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 1'...(Time elapsed: 00:00:00:341)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=True,Verbose=True,ComputerName=DC01,Retries=3,ArgumentList=System.Object[],ScriptBlock=
    param (
        [string]$DomainName,
        [string]$Password,
        [string]$ForestFunctionalLevel,
        [string]$DomainFunctionalLevel,
        [string]$NetBiosDomainName,
        [string]$DatabasePath,
        [string]$LogPath,
        [string]$SysvolPath,
        [string]$DsrmPassword
    )

    $VerbosePreference = $using:VerbosePreference

    Start-Transcript -Path C:\DeployDebug\ALDCPromo.log

    ([WMIClass]'Win32_NetworkAdapterConfiguration').SetDNSSuffixSearchOrder($DomainName) | Out-Null

    Write-Verbose -Message "Starting installation of Root Domain Controller on '$(HOSTNAME.EXE)'"

    Write-Verbose -Message 'Installing AD-Domain-Services windows feature'
    $result = Install-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools
    if (-not $result.Success)
    {
        throw 'Could not install AD-Domain-Services windows feature'
    }
    else
    {
        Write-Verbose -Message 'AD-Domain-Services windows feature installed successfully'
    }

    $safeDsrmPassword = ConvertTo-SecureString -String $DsrmPassword -AsPlainText -Force

    Write-Verbose -Message "Creating a new forest named '$DomainName' on the machine '$(HOSTNAME.EXE)'"
    $result = Install-ADDSForest -DomainName $DomainName `
    -SafeModeAdministratorPassword $safeDsrmPassword `
    -InstallDNS `
    -DomainMode $DomainFunctionalLevel `
    -Force `
    -ForestMode $ForestFunctionalLevel `
    -DomainNetbiosName $NetBiosDomainName `
    -SysvolPath $SysvolPath `
    -DatabasePath $DatabasePath `
    -LogPath $LogPath

    if ($result.Status -eq 'Error')
    {
        throw 'Could not install new domain'
    }
    else
    {
        Write-Verbose -Message 'AD-Domain-Services windows feature installed successfully'
    }

    Set-ItemProperty -Path Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters -Name 'Repl Perform Initial Synchronizations' -Value 0 -Type DWord

    Write-Verbose -Message 'finished installing the Root Domain Controller'
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Root DC (DC01))
VERBOSE: [09:00:00][Invoke-LWCommand] Starting Activity 'Install Root DC (DC01)'
VERBOSE: [09:00:00][Invoke-LWCommand] Finished Installation Activity 'Install Root DC (DC01)'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:205)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:398)
VERBOSE: [09:00:01][Write-ScreenInfo] Waiting for Root Domain Controllers to complete installation of Active Directory and restart
09:00:01|00:02:33|00:01:00.591| - Waiting for Root Domain Controllers to complete installation of Active Directory and restart
VERBOSE: [09:00:01][Write-ScreenInfo] 09:00:01|00:02:33|00:01:00.591| - Waiting for Root Domain Controllers to complete installation of Active Directory and restart
VERBOSE: Get-LabVM Entering... (Role=FirstChildDC, DC)
VERBOSE: Get-LabVM Entering... (Role=Routing)
VERBOSE: Get-LabVM Entering... )
VERBOSE: Wait-LabVMRestart Entering... (ComputerName=DC01,StartMachinesWhileWaiting=<null>,DoNotUseCredSsp=True,ProgressIndicator=30,TimeoutInMinutes=60,ErrorAction=Stop,MonitorJob=System.Object[](1),NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Wait-LWHypervVMRestart Entering... (ComputerName=DC01,TimeoutInMinutes=60,ProgressIndicator=30,NoNewLine=True,StartMachinesWhileWaiting=<null>,ErrorAction=<null>,ErrorVariable=hypervWaitError,MonitorJob=System.Management.Automation.Job[](1))
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:00:35][Write-ScreenInfo] .
.
VERBOSE: [09:01:08][Write-ScreenInfo] .
.
VERBOSE: [09:01:40][Write-ScreenInfo] .
.
VERBOSE: [09:02:13][Write-ScreenInfo] .
.
VERBOSE: [09:02:45][Write-ScreenInfo] .
.
VERBOSE: [09:03:18][Write-ScreenInfo] .
.
VERBOSE: [09:03:44][Wait-LWHypervVMRestart] Machine 'DC01' is now stopped
VERBOSE: [09:03:46][Wait-LWHypervVMRestart] All machines have stopped: (DC01)
VERBOSE: Wait-LabVM Entering... (ComputerName=DC01,ProgressIndicator=30,TimeoutInMinutes=56.25988946,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:03:47][Remove-LabPSSession] Removed 1 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:540)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:185)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:03:49][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:03:49][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:03:49][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: Connection Timeout
VERBOSE: [09:03:51][New-LabPSSession] Port was NOT open, cannot create session.
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: '...(Time elapsed: 00:00:07:823)
VERBOSE: [09:03:56][Wait-LabVM] Computer '' was not reachable, waiting...
VERBOSE: [09:03:56][Wait-LabVM] Waiting for 1 machines to respond in timeout (56.25988946 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=30,NoNewLine=True,NoDisplay=True,Timeout=56)
VERBOSE: [09:03:57][Write-ScreenInfo] .
.
VERBOSE: [09:04:27][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:31:468)
VERBOSE: [09:04:28][Wait-LabVM] The following machines are ready: DC01
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:106)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: Wait-LWHypervVMRestart...leaving...(Time elapsed: 00:00:00:232)
VERBOSE: Wait-LabVMRestart...leaving...(Time elapsed: 00:00:00:310)
VERBOSE: [09:04:29][Write-ScreenInfo] done
done
VERBOSE: [09:04:29][Write-ScreenInfo] Root Domain Controllers have now restarted. Waiting for Active Directory to start up
09:04:29|00:07:02|00:05:28.789| - Root Domain Controllers have now restarted. Waiting for Active Directory to start up
VERBOSE: [09:04:29][Write-ScreenInfo] 09:04:29|00:07:02|00:05:28.789| - Root Domain Controllers have now restarted. Waiting for Active Directory to start up
VERBOSE: Wait-LabVM Entering... (ComputerName=DC01,DoNotUseCredSsp=True,TimeoutInMinutes=30,ProgressIndicator=30,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:29][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:246)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:116)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:30][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:04:30][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:04:30][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [09:04:31][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:04:31][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:083)
VERBOSE: [09:04:31][Wait-LabVM] Computer 'DC01' was reachable
VERBOSE: [09:04:31][Wait-LabVM] Waiting for 1 machines to respond in timeout (30 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=30,NoNewLine=True,NoDisplay=True,Timeout=30)
VERBOSE: [09:04:32][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:291)
VERBOSE: [09:04:32][Wait-LabVM] The following machines are ready: DC01
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:106)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:179)
VERBOSE: Wait-LabADReady Entering... (ComputerName=DC01,TimeoutInMinutes=20,ErrorAction=Stop,ProgressIndicator=30,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:04:33][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:109)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:200)
VERBOSE: [09:04:34][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:34][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:04:35][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:04:35][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:242)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:04:35][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:04:38][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:03:212)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:03:338)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:03:399)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:04:42][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:162)
VERBOSE: [09:04:42][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:43][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:04:43][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:04:43][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:290)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:04:43][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:04:43][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:172)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:297)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:352)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:04:47][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: [09:04:48][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:49][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:04:49][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:04:49][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:247)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:04:49][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:04:49][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:159)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:280)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:356)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:04:53][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:096)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:156)
VERBOSE: [09:04:54][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:04:54][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:04:54][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:04:54][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:240)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:04:54][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:04:55][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:182)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:308)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:372)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:04:58][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: [09:04:59][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:00][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:00][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:00][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:241)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:05:00][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:05:00][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:173)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:295)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:353)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:05:04][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:096)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:168)
VERBOSE: [09:05:05][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:05][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:05][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:05][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:258)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:05:06][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:05:06][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:175)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:313)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:375)
VERBOSE: [09:05:06][Write-ScreenInfo] .
.
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:05:10][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:094)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:160)
VERBOSE: [09:05:10][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:11][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:11][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:11][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:238)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:05:11][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:05:11][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:162)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:293)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:354)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:05:15][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:094)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:183)
VERBOSE: [09:05:16][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:17][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:17][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:17][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:252)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:05:17][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:05:18][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:803)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:928)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:00:986)
VERBOSE: Test-LabADReady Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=GetAdwsServiceStatus,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,DoNotUseCredSsp=True,PassThru=True,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:05:22][Invoke-LabCommand] Executing lab command activity 'GetAdwsServiceStatus' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:169)
VERBOSE: [09:05:23][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:23][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:23][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:23][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:237)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=

        if ((Get-Service -Name ADWS).Status -eq 'Running')
        {
            try
            {
                $env:ADPS_LoadDefaultDrive = 0
                $WarningPreference = 'SilentlyContinue'
                Import-Module -Name ActiveDirectory -ErrorAction Stop
                [bool](Get-ADDomainController -Server $env:COMPUTERNAME -ErrorAction SilentlyContinue)
            }
            catch
            {
                $false
            }
        }

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=GetAdwsServiceStatus)
VERBOSE: [09:05:23][Invoke-LWCommand] Starting Activity 'GetAdwsServiceStatus'
VERBOSE: [09:05:26][Invoke-LWCommand] Finished Installation Activity 'GetAdwsServiceStatus'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:02:586)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:02:707)
VERBOSE: Test-LabADReady...leaving...(Time elapsed: 00:00:02:765)
VERBOSE: [09:05:26][Wait-LabADReady] Active Directory is now ready on Domain Controller 'DC01'
VERBOSE: [09:05:26][Wait-LabADReady] Domain Controllers specified are now ready:
VERBOSE: [09:05:26][Wait-LabADReady] DC01
VERBOSE: Wait-LabADReady...leaving...(Time elapsed: 00:00:02:836)
VERBOSE: Get-LabVirtualNetworkDefinition Entering... )
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Create reverse lookup zone,ComputerName=DC01,ScriptBlock=
                param
                (
                    [string]$ip
                )

                $zoneName = "$($ip.split('.')[2]).$($ip.split('.')[1]).$($ip.split('.')[0]).in-addr.arpa"
                dnscmd . /ZoneAdd "$zoneName" /DsPrimary /DP /forest
                dnscmd . /Config "$zoneName" /AllowUpdate 2
                ipconfig.exe -registerdns
            ,ArgumentList=10.0.0.0,NoDisplay=True)
VERBOSE: [09:05:28][Invoke-LabCommand] Executing lab command activity 'Create reverse lookup zone' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:128)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:234)
VERBOSE: [09:05:29][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:31][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:31][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:05:31][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [09:05:31][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:05:31][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:094)
VERBOSE: Invoke-LWCommand Entering... (PassThru=<null>,AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,ArgumentList=10.0.0.0,ScriptBlock=
                param
                (
                    [string]$ip
                )

                $zoneName = "$($ip.split('.')[2]).$($ip.split('.')[1]).$($ip.split('.')[0]).in-addr.arpa"
                dnscmd . /ZoneAdd "$zoneName" /DsPrimary /DP /forest
                dnscmd . /Config "$zoneName" /AllowUpdate 2
                ipconfig.exe -registerdns
            ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Create reverse lookup zone)
VERBOSE: [09:05:32][Invoke-LWCommand] Starting Activity 'Create reverse lookup zone'
VERBOSE: [09:05:35][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_82c537e3-b076-4099-b047-cc83fe663cfa'
VERBOSE: [09:05:35][Invoke-LWCommand] Finished Installation Activity 'Create reverse lookup zone'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:03:524)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:03:691)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Make installation user Domain Admin,ComputerName=DC01,ScriptBlock=
            $PSDefaultParameterValues = @{
                '*-AD*:Server' = $env:COMPUTERNAME
            }

            $user = Get-ADUser -Identity ([System.Security.Principal.WindowsIdentity]::GetCurrent().User) -Server localhost

            Add-ADGroupMember -Identity 'Domain Admins' -Members $user -Server localhost
            Add-ADGroupMember -Identity 'Enterprise Admins' -Members $user -Server localhost
            Add-ADGroupMember -Identity 'Schema Admins' -Members $user -Server localhost
        ,NoDisplay=True,ErrorAction=<null>)
VERBOSE: [09:05:36][Invoke-LabCommand] Executing lab command activity 'Make installation user Domain Admin' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:155)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:254)
VERBOSE: [09:05:37][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:38][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:38][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:05:38][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=
            $PSDefaultParameterValues = @{
                '*-AD*:Server' = $env:COMPUTERNAME
            }

            $user = Get-ADUser -Identity ([System.Security.Principal.WindowsIdentity]::GetCurrent().User) -Server localhost

            Add-ADGroupMember -Identity 'Domain Admins' -Members $user -Server localhost
            Add-ADGroupMember -Identity 'Enterprise Admins' -Members $user -Server localhost
            Add-ADGroupMember -Identity 'Schema Admins' -Members $user -Server localhost
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Make installation user Domain Admin)
VERBOSE: [09:05:38][Invoke-LWCommand] Starting Activity 'Make installation user Domain Admin'
VERBOSE: [09:05:39][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_b4c6026b-d577-42e5-811f-3e5df8acbad2'
VERBOSE: [09:05:39][Invoke-LWCommand] Finished Installation Activity 'Make installation user Domain Admin'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:849)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:972)
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Register non domain joined machines in DNS,ComputerName=DC01,ScriptBlock=Restart-Service -Name DNS -WarningAction SilentlyContinue
,NoDisplay=True)
VERBOSE: [09:05:40][Invoke-LabCommand] Executing lab command activity 'Register non domain joined machines in DNS' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:103)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:181)
VERBOSE: [09:05:41][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:41][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:41][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:05:41][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:091)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=Restart-Service -Name DNS -WarningAction SilentlyContinue
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Register non domain joined machines in DNS)
VERBOSE: [09:05:42][Invoke-LWCommand] Starting Activity 'Register non domain joined machines in DNS'
VERBOSE: [09:05:42][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_c12a3408-383c-481c-8abc-f261fb965a9d'
VERBOSE: [09:05:42][Invoke-LWCommand] Finished Installation Activity 'Register non domain joined machines in DNS'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:756)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:911)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Add flat domain name DNS record to speed up start of gpsvc in 2016,ComputerName=DC01,ScriptBlock=
            $machine = $args[0] | Where-Object { $_.Name -eq $env:COMPUTERNAME }
            dnscmd localhost /recordadd $env:USERDNSDOMAIN $env:USERDOMAIN A $machine.IpV4Address
        ,ArgumentList=System.Object[](1),NoDisplay=True)
VERBOSE: [09:05:43][Invoke-LabCommand] Executing lab command activity 'Add flat domain name DNS record to speed up start of gpsvc in 2016' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: [09:05:44][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:44][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:44][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:05:45][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:080)
VERBOSE: Invoke-LWCommand Entering... (PassThru=<null>,AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,ArgumentList=System.Object[](1),ScriptBlock=
            $machine = $args[0] | Where-Object { $_.Name -eq $env:COMPUTERNAME }
            dnscmd localhost /recordadd $env:USERDNSDOMAIN $env:USERDOMAIN A $machine.IpV4Address
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Add flat domain name DNS record to speed up start of gpsvc in 2016)
VERBOSE: [09:05:45][Invoke-LWCommand] Starting Activity 'Add flat domain name DNS record to speed up start of gpsvc in 2016'
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: [09:05:45][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_b63bc902-53c1-4e62-bcfd-fd1982b8eabb'
VERBOSE: [09:05:45][Invoke-LWCommand] Finished Installation Activity 'Add flat domain name DNS record to speed up start of gpsvc in 2016'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:378)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:582)
VERBOSE: Get-LabVM Entering... (All=True,IncludeLinux=True)
VERBOSE: Enable-LabVMRemoting Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... )
VERBOSE: Get-LabVM Entering... (All=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=SetLabVMRemoting,ScriptBlock=
        param ($DomainName, $UserName, $Password)
        
        $RegPath = 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon'
        
        Set-ItemProperty -Path $RegPath -Name AutoAdminLogon -Value 1 -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultUserName -Value $UserName -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultPassword -Value $Password -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultDomainName -Value $DomainName -ErrorAction SilentlyContinue
        
        Enable-WSManCredSSP -Role Server -Force | Out-Null
    ,DoNotUseCredSsp=True,NoDisplay=True,ArgumentList=System.Object[],ErrorAction=Stop)
VERBOSE: [09:05:47][Invoke-LabCommand] Executing lab command activity 'SetLabVMRemoting' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:156)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:272)
VERBOSE: [09:05:48][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:49][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:49][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:05:49][New-LabPSSession] Session DC01_0739b058-8747-4e55-85ec-5219db41cb35 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 2'...(Time elapsed: 00:00:00:278)
VERBOSE: Invoke-LWCommand Entering... (PassThru=<null>,AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,ArgumentList=System.Object[],ScriptBlock=
        param ($DomainName, $UserName, $Password)
        
        $RegPath = 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon'
        
        Set-ItemProperty -Path $RegPath -Name AutoAdminLogon -Value 1 -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultUserName -Value $UserName -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultPassword -Value $Password -ErrorAction SilentlyContinue
        Set-ItemProperty -Path $RegPath -Name DefaultDomainName -Value $DomainName -ErrorAction SilentlyContinue
        
        Enable-WSManCredSSP -Role Server -Force | Out-Null
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=SetLabVMRemoting)
VERBOSE: [09:05:49][Invoke-LWCommand] Starting Activity 'SetLabVMRemoting'
VERBOSE: [09:05:49][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_2cf57123-e181-46d3-acb8-86aa9fe2195c'
VERBOSE: [09:05:49][Invoke-LWCommand] Finished Installation Activity 'SetLabVMRemoting'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:592)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:719)
VERBOSE: Enable-LabVMRemoting...leaving...(Time elapsed: 00:00:00:788)
VERBOSE: Restart-ServiceResilient Entering... (ComputerName=DC01,ServiceName=nlasvc,NoNewLine=True)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,AsJob=True,PassThru=True,NoDisplay=True,ActivityName=Restart service 'nlasvc' on computers 'DC01',ScriptBlock=
        param
        (
            [string]$ServiceName
        )

        function Get-ServiceRestartInfo
        {
            param
            (
                [string]$ServiceName,
                [switch]$WasStopped,
                [switch]$WasStarted,
                [double]$Index
            )

            $serviceDisplayName = (Get-Service $ServiceName).DisplayName

            $newestEvent = "($((Get-EventLog -LogName System -newest 1).Index)) " + (Get-EventLog -LogName System -newest 1).Message
            Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Get-ServiceRestartInfo - ServiceName: $ServiceName ($serviceDisplayName) - WasStopped: $WasStopped - WasStarted:$WasStarted - Index: $Index - Newest event: $newestEvent"


            $result = $true

            if ($WasStopped)
            {
                $events = @(Get-EventLog -LogName System -Index ($Index..($Index+10000)) | Where-Object {$_.Message -like "*$serviceDisplayName*entered*stopped*"})
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Events found: $($events.count)"
                $result = ($events.count -gt 0)
            }
            if ($WasStarted)
            {
                $events = @(Get-EventLog -LogName System -Index ($Index..($Index+10000)) | Where-Object {$_.Message -like "*$serviceDisplayName*entered*running*"})
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Events found: $($events.count)"
                $result = ($events.count -gt 0)
            }

            Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Result:$result"
            $result
        }


        $BackupVerbosePreference = $VerbosePreference
        $BackupDebugPreference   = $DebugPreference
        $VerbosePreference = 'Continue'
        $DebugPreference   = 'Continue'

        $ServiceName = 'nlasvc'

        $dependentServices = Get-Service -Name $ServiceName -DependentServices | Where-Object {$_.Status -eq 'Running'} | Select-Object -ExpandProperty Name
        Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent services: '$($dependentServices -join ',')'"


        $serviceDisplayName = (Get-Service $ServiceName).DisplayName
        if ((Get-Service -Name "$ServiceName").Status -eq 'Running')
        {
            $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
            $retries = 5
            do
            {
                Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to stop service '$ServiceName'"
                $EAPbackup = $ErrorActionPreference
                $WAPbackup = $WarningPreference

                $ErrorActionPreference = 'SilentlyContinue'
                $WarningPreference     = 'SilentlyContinue'
                Stop-Service -Name $ServiceName -Force
                $ErrorActionPreference = $EAPbackup
                $WarningPreference = $WAPbackup

                $retries--
                Start-Sleep -Seconds 1
            }
            until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStopped -Index $newestEventLogIndex) -or $retries -le 0)
        }

        if ($retries -gt 0)
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' has been stopped"
        }
        else
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' could NOT be stopped"
            return
        }


        if (-not (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex))
        {
            #if service did not start by itself
            $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
            $retries = 5
            do
            {
                Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to start service '$ServiceName'"
                Start-Service -Name $ServiceName -ErrorAction SilentlyContinue
                $retries--
                if (-not (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex))
                {
                    Start-Sleep -Seconds 1
                }
            }
            until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex) -or $retries -le 0)
        }


        if ($retries -gt 0)
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' was started"
        }
        else
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' could NOT be started"
            return
        }

        foreach ($dependentService in $dependentServices)
        {
            if (Get-ServiceRestartInfo -ServiceName $dependentService -WasStarted -Index $newestEventLogIndex)
            {
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$dependentService' has already auto-started"
            }
            else
            {
                $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
                $retries = 5
                do
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to start depending service '$dependentService'"
                    Start-Service $dependentService -ErrorAction SilentlyContinue
                    $retries--
                }
                until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex) -or $retries -le 0)

                if (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex)
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$ServiceName' was started"
                }
                else
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$ServiceName' could NOT be started"
                }
            }
        }

        $VerbosePreference = $BackupVerbosePreference
        $DebugPreference   = $BackupDebugPreference
    ,ArgumentList=nlasvc)
VERBOSE: [09:05:50][Invoke-LabCommand] Executing lab command activity 'Restart service 'nlasvc' on computers 'DC01'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:175)
VERBOSE: [09:05:51][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:52][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:52][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:05:52][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:081)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=True,Verbose=True,ComputerName=DC01,Retries=3,ArgumentList=nlasvc,ScriptBlock=
        param
        (
            [string]$ServiceName
        )

        function Get-ServiceRestartInfo
        {
            param
            (
                [string]$ServiceName,
                [switch]$WasStopped,
                [switch]$WasStarted,
                [double]$Index
            )

            $serviceDisplayName = (Get-Service $ServiceName).DisplayName

            $newestEvent = "($((Get-EventLog -LogName System -newest 1).Index)) " + (Get-EventLog -LogName System -newest 1).Message
            Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Get-ServiceRestartInfo - ServiceName: $ServiceName ($serviceDisplayName) - WasStopped: $WasStopped - WasStarted:$WasStarted - Index: $Index - Newest event: $newestEvent"


            $result = $true

            if ($WasStopped)
            {
                $events = @(Get-EventLog -LogName System -Index ($Index..($Index+10000)) | Where-Object {$_.Message -like "*$serviceDisplayName*entered*stopped*"})
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Events found: $($events.count)"
                $result = ($events.count -gt 0)
            }
            if ($WasStarted)
            {
                $events = @(Get-EventLog -LogName System -Index ($Index..($Index+10000)) | Where-Object {$_.Message -like "*$serviceDisplayName*entered*running*"})
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Events found: $($events.count)"
                $result = ($events.count -gt 0)
            }

            Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Result:$result"
            $result
        }


        $BackupVerbosePreference = $VerbosePreference
        $BackupDebugPreference   = $DebugPreference
        $VerbosePreference = 'Continue'
        $DebugPreference   = 'Continue'

        $ServiceName = 'nlasvc'

        $dependentServices = Get-Service -Name $ServiceName -DependentServices | Where-Object {$_.Status -eq 'Running'} | Select-Object -ExpandProperty Name
        Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent services: '$($dependentServices -join ',')'"


        $serviceDisplayName = (Get-Service $ServiceName).DisplayName
        if ((Get-Service -Name "$ServiceName").Status -eq 'Running')
        {
            $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
            $retries = 5
            do
            {
                Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to stop service '$ServiceName'"
                $EAPbackup = $ErrorActionPreference
                $WAPbackup = $WarningPreference

                $ErrorActionPreference = 'SilentlyContinue'
                $WarningPreference     = 'SilentlyContinue'
                Stop-Service -Name $ServiceName -Force
                $ErrorActionPreference = $EAPbackup
                $WarningPreference = $WAPbackup

                $retries--
                Start-Sleep -Seconds 1
            }
            until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStopped -Index $newestEventLogIndex) -or $retries -le 0)
        }

        if ($retries -gt 0)
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' has been stopped"
        }
        else
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' could NOT be stopped"
            return
        }


        if (-not (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex))
        {
            #if service did not start by itself
            $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
            $retries = 5
            do
            {
                Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to start service '$ServiceName'"
                Start-Service -Name $ServiceName -ErrorAction SilentlyContinue
                $retries--
                if (-not (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex))
                {
                    Start-Sleep -Seconds 1
                }
            }
            until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex) -or $retries -le 0)
        }


        if ($retries -gt 0)
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' was started"
        }
        else
        {
            Write-Verbose -Message "$(Get-Date -Format 'mm:dd:ss') - Service '$ServiceName' could NOT be started"
            return
        }

        foreach ($dependentService in $dependentServices)
        {
            if (Get-ServiceRestartInfo -ServiceName $dependentService -WasStarted -Index $newestEventLogIndex)
            {
                Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$dependentService' has already auto-started"
            }
            else
            {
                $newestEventLogIndex = (Get-EventLog -LogName System -Newest 1).Index
                $retries = 5
                do
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Trying to start depending service '$dependentService'"
                    Start-Service $dependentService -ErrorAction SilentlyContinue
                    $retries--
                }
                until ((Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex) -or $retries -le 0)

                if (Get-ServiceRestartInfo -ServiceName $ServiceName -WasStarted -Index $newestEventLogIndex)
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$ServiceName' was started"
                }
                else
                {
                    Write-Debug -Message "$(Get-Date -Format 'mm:dd:ss') - Dependent service '$ServiceName' could NOT be started"
                }
            }
        }

        $VerbosePreference = $BackupVerbosePreference
        $DebugPreference   = $BackupDebugPreference
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Restart service 'nlasvc' on computers 'DC01')
VERBOSE: [09:05:52][Invoke-LWCommand] Starting Activity 'Restart service 'nlasvc' on computers 'DC01''
VERBOSE: [09:05:52][Invoke-LWCommand] Finished Installation Activity 'Restart service 'nlasvc' on computers 'DC01''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:301)
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),NoDisplay=True,Timeout=30,NoNewLine=True,ProgressIndicator=10)
VERBOSE: [09:05:53][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:03:257)
VERBOSE: Restart-ServiceResilient...leaving...(Time elapsed: 00:00:03:319)
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: Reset-DNSConfiguration Entering... (ComputerName=DC01,ProgressIndicator=30,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=Reset DNS client configuration to match specified DNS configuration,ScriptBlock=
            param
            (
                $DnsServers
            )
            $AdapterNames = (Get-WmiObject -Namespace Root\CIMv2 -Class Win32_NetworkAdapter | Where-Object {$_.PhysicalAdapter}).NetConnectionID
            foreach ($AdapterName in $AdapterNames)
            {
                netsh.exe interface ipv4 set dnsservers "$AdapterName" static $DnsServers primary

                "netsh interface ipv6 delete dnsservers '$AdapterName' all"
                netsh.exe interface ipv6 delete dnsservers "$AdapterName" all
            }
        ,AsJob=True,PassThru=True,NoDisplay=True,ArgumentList=<null>)
VERBOSE: [09:05:57][Invoke-LabCommand] Executing lab command activity 'Reset DNS client configuration to match specified DNS configuration' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: [09:05:58][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:05:58][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:05:58][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:05:58][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=True,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            param
            (
                $DnsServers
            )
            $AdapterNames = (Get-WmiObject -Namespace Root\CIMv2 -Class Win32_NetworkAdapter | Where-Object {$_.PhysicalAdapter}).NetConnectionID
            foreach ($AdapterName in $AdapterNames)
            {
                netsh.exe interface ipv4 set dnsservers "$AdapterName" static $DnsServers primary

                "netsh interface ipv6 delete dnsservers '$AdapterName' all"
                netsh.exe interface ipv6 delete dnsservers "$AdapterName" all
            }
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Reset DNS client configuration to match specified DNS configuration)
VERBOSE: [09:05:59][Invoke-LWCommand] Starting Activity 'Reset DNS client configuration to match specified DNS configuration'
VERBOSE: [09:05:59][Invoke-LWCommand] Finished Installation Activity 'Reset DNS client configuration to match specified DNS configuration'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:148)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:298)
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),NoDisplay=True,Timeout=30,ProgressIndicator=30,NoNewLine=True)
VERBOSE: [09:05:59][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:270)
VERBOSE: Reset-DNSConfiguration...leaving...(Time elapsed: 00:00:00:330)
VERBOSE: [09:05:59][Install-LabRootDcs] Restarting DNS and Netlogon service on Root Domain Controllers
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: Sync-LabActiveDirectory Entering... (ComputerName=DC01,ProgressIndicator=5,AsJob=True,Passthru=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Performing ipconfig /registerdns on 'DC01',ComputerName=DC01,ScriptBlock= ipconfig.exe /registerdns ,NoDisplay=True)
VERBOSE: [09:06:00][Invoke-LabCommand] Executing lab command activity 'Performing ipconfig /registerdns on 'DC01'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:083)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:148)
VERBOSE: [09:06:01][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:06:01][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:06:01][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:06:02][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock= ipconfig.exe /registerdns ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Performing ipconfig /registerdns on 'DC01')
VERBOSE: [09:06:02][Invoke-LWCommand] Starting Activity 'Performing ipconfig /registerdns on 'DC01''
VERBOSE: [09:06:05][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_9ee549ab-aa87-47f1-9b54-53cac6778fd8'
VERBOSE: [09:06:05][Invoke-LWCommand] Finished Installation Activity 'Performing ipconfig /registerdns on 'DC01''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:03:213)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:03:495)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Triggering replication on 'DC01',ComputerName=DC01,ScriptBlock=
            $VerbosePreference = $using:VerbosePreference

            ipconfig.exe -flushdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log

            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            ipconfig.exe /registerdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log
            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            ipconfig.exe /registerdns

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            #for debugging
            #dnscmd /zoneexport $env:USERDNSDOMAIN "c:\DeployDebug\$($env:USERDNSDOMAIN).txt"
        ,AsJob=True,PassThru=True,NoDisplay=True)
VERBOSE: [09:06:06][Invoke-LabCommand] Executing lab command activity 'Triggering replication on 'DC01'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:169)
VERBOSE: [09:06:07][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:06:07][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:06:07][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:06:07][New-LabPSSession] Session DC01_323ab945-c4e9-43cf-ac26-2f8ac968a3bf is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 3'...(Time elapsed: 00:00:00:084)
VERBOSE: Invoke-LWCommand Entering... (AsJob=True,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            $VerbosePreference = $using:VerbosePreference

            ipconfig.exe -flushdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log

            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            ipconfig.exe /registerdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log
            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            ipconfig.exe /registerdns

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            #for debugging
            #dnscmd /zoneexport $env:USERDNSDOMAIN "c:\DeployDebug\$($env:USERDNSDOMAIN).txt"
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Triggering replication on 'DC01')
VERBOSE: [09:06:08][Invoke-LWCommand] Starting Activity 'Triggering replication on 'DC01''
VERBOSE: [09:06:08][Invoke-LWCommand] Finished Installation Activity 'Triggering replication on 'DC01''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:154)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:308)
VERBOSE: Sync-LabActiveDirectory...leaving...(Time elapsed: 00:00:00:385)
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=5,NoDisplay=True,NoNewLine=True)
VERBOSE: [09:06:08][Write-ScreenInfo] .
.
VERBOSE: [09:06:13][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:07:404)
VERBOSE: Get-LabVM Entering... )
VERBOSE: [09:06:16][Write-ScreenInfo] .
.
VERBOSE: Install-LabRootDcs...leaving...(Time elapsed: 00:00:00:209)
VERBOSE: [09:06:16][Write-ScreenInfo] Done
VERBOSE: [09:06:16][Write-ScreenInfo] 09:06:16|00:08:49|00:07:15.814| - Done
09:06:16|00:08:49|00:07:15.814| - Done
VERBOSE: Get-LabVM Entering... (Role=Routing)
VERBOSE: Get-LabVM Entering... (Role=DHCP)
VERBOSE: Get-LabVM Entering... (Role=FirstChildDC)
VERBOSE: Get-LabVM Entering... (Role=DC)
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: Get-LabVM Entering... (Role=CaRoot, CaSubordinate)
VERBOSE: [09:06:17][Write-ScreenInfo] Installing Certificate Servers
VERBOSE: [09:06:17][Write-ScreenInfo] 09:06:17|00:08:49|00:00:00.001| Installing Certificate Servers
09:06:17|00:08:49|00:00:00.001| Installing Certificate Servers
VERBOSE: Install-LabCA Entering... (CreateCheckPoints=<null>)
VERBOSE: Get-LabVM Entering... (Role=CaRoot, CaSubordinate)
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: [09:06:17][Write-ScreenInfo] Machines with Root CA role to be installed: 'CA01'
VERBOSE: [09:06:17][Write-ScreenInfo] 09:06:17|00:08:50|00:00:00.001| - Machines with Root CA role to be installed: 'CA01'
09:06:17|00:08:50|00:00:00.001| - Machines with Root CA role to be installed: 'CA01'
VERBOSE: [09:06:17][Write-ScreenInfo] Waiting for machines to start up
09:06:17|00:08:50|00:00:00.068|   - Waiting for machines to start up
VERBOSE: [09:06:17][Write-ScreenInfo] 09:06:17|00:08:50|00:00:00.068|   - Waiting for machines to start up
VERBOSE: Start-LabVM Entering... (RoleName=CaRoot, CaSubordinate,Wait=True,ProgressIndicator=15)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: [09:06:18][Start-LabVM] Starting VMs 'CA01'
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:094)
VERBOSE: Start-LWHypervVM...leaving...(Time elapsed: 00:00:00:457)
VERBOSE: Wait-LabVM Entering... (ComputerName=CA01,TimeoutInMinutes=60,DoNotUseCredSsp=<null>,ProgressIndicator=15,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:06:20][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:273)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Wait-LabVM Entering... (ComputerName=CA01,TimeoutInMinutes=60,PostDelaySeconds=<null>,ProgressIndicator=15,DoNotUseCredSsp=True,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:06:21][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:268)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:103)
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:06:22][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:06:22][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='CA01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:06:22][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: Connection Timeout
VERBOSE: [09:06:24][New-LabPSSession] Port was NOT open, cannot create session.
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: '...(Time elapsed: 00:00:07:885)
VERBOSE: [09:06:29][Wait-LabVM] Computer '' was not reachable, waiting...
VERBOSE: [09:06:29][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=15,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:06:30][Write-ScreenInfo] .
.
VERBOSE: [09:06:45][Write-ScreenInfo] .
.
VERBOSE: [09:07:00][Write-ScreenInfo] .
.
VERBOSE: [09:07:15][Write-ScreenInfo] .
.
VERBOSE: [09:07:30][Write-ScreenInfo] .
.
VERBOSE: [09:07:45][Write-ScreenInfo] .
.
VERBOSE: [09:08:00][Write-ScreenInfo] .
.
VERBOSE: [09:08:15][Write-ScreenInfo] .
.
VERBOSE: [09:08:31][Write-ScreenInfo] .
.
VERBOSE: [09:08:46][Write-ScreenInfo] .
.
VERBOSE: [09:09:01][Write-ScreenInfo] .
.
VERBOSE: [09:09:16][Write-ScreenInfo] .
.
VERBOSE: [09:09:31][Write-ScreenInfo] .
.
VERBOSE: [09:09:46][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:03:17:190)
VERBOSE: [09:09:47][Wait-LabVM] The following machines are ready: CA01
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:120)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=CA01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:378)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:09:48][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:133)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:223)
VERBOSE: [09:09:50][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:09:50][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:09:50][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:09:50][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:09:51][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:09:51][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 4'...(Time elapsed: 00:00:00:083)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:09:52][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:09:53][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:01:713)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:895)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=CA01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:416)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:519)
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:09:55][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:09:55][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='CA01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:09:55][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:09:56][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:09:56][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 5'...(Time elapsed: 00:00:00:107)
VERBOSE: [09:09:56][Wait-LabVM] Computer 'CA01' was reachable
VERBOSE: [09:09:57][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=15,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:09:57][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:422)
VERBOSE: [09:09:57][Wait-LabVM] The following machines are ready: CA01
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:144)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:269)
VERBOSE: [09:09:58][Write-ScreenInfo] .
.
VERBOSE: Start-LabVM...leaving...(Time elapsed: 00:00:00:585)
VERBOSE: Get-LabVM Entering... (Role=CaRoot,IsRunning=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:138)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:238)
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ActivityName=Check if CA is already installed on 'CA01',ScriptBlock= (Get-WindowsFeature -Name 'ADCS-Cert-Authority') ,PassThru=True,NoDisplay=True)
VERBOSE: [09:10:00][Invoke-LabCommand] Executing lab command activity 'Check if CA is already installed on 'CA01'' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:136)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:263)
VERBOSE: [09:10:01][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:02][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:02][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:10:02][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:10:02][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:10:03][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:103)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock= (Get-WindowsFeature -Name 'ADCS-Cert-Authority') ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Check if CA is already installed on 'CA01')
VERBOSE: [09:10:03][Invoke-LWCommand] Starting Activity 'Check if CA is already installed on 'CA01''
VERBOSE: [09:10:05][Invoke-LWCommand] Finished Installation Activity 'Check if CA is already installed on 'CA01''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:01:519)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:697)
VERBOSE: Install-LabCAMachine Entering... (Machine=CA01,PassThru=True,PreDelaySeconds=<null>)
VERBOSE: [09:10:05][Install-LabCAMachine] ****************************************************
VERBOSE: [09:10:05][Install-LabCAMachine] Starting installation of machine: CA01
VERBOSE: [09:10:05][Install-LabCAMachine] ****************************************************
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: [09:10:05][Write-ScreenInfo] Parameter "CAType" is not specified. Automatically setting CAtype to "EnterpriseRootCA" since machine is domain joined and Root CA role is specified
VERBOSE: [09:10:05][Write-ScreenInfo] 09:10:05|00:12:38|00:03:48.054|   - Parameter "CAType" is not specified. Automatically setting CAtype to "EnterpriseRootCA" since machine is domain joined and Root CA role is specified
09:10:05|00:12:38|00:03:48.054|   - Parameter "CAType" is not specified. Automatically setting CAtype to "EnterpriseRootCA" since machine is domain joined and Root CA role is specified
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
            $name = certutil.exe -getreg CA\CommonName | Where-Object { $_ -match 'CommonName REG' }
            if ($name)
            {
                $name.Split('=')[1].Trim()
            }
        ,NoDisplay=True,PassThru=True)
VERBOSE: [09:10:06][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:109)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:180)
VERBOSE: [09:10:07][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:08][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:08][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:08][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:105)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
            $name = certutil.exe -getreg CA\CommonName | Where-Object { $_ -match 'CommonName REG' }
            if ($name)
            {
                $name.Split('=')[1].Trim()
            }
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:10:08][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:10:08][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:213)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:342)
VERBOSE: Get-LabVM Entering... )
VERBOSE: [09:10:09][Write-ScreenInfo] Adding parameter 'CertsValidityPeriodUnits' with value of '5' to machine roles properties of machine CA01
VERBOSE: [09:10:09][Write-ScreenInfo] 09:10:09|00:12:41|00:03:51.162|   - Adding parameter 'CertsValidityPeriodUnits' with value of '5' to machine roles properties of machine CA01
09:10:09|00:12:41|00:03:51.162|   - Adding parameter 'CertsValidityPeriodUnits' with value of '5' to machine roles properties of machine CA01
VERBOSE: [09:10:09][Write-ScreenInfo] Adding parameter 'CertsValidityPeriod' with value of 'Years' to machine roles properties of machine CA01
VERBOSE: [09:10:09][Write-ScreenInfo] 09:10:09|00:12:41|00:03:51.244|   - Adding parameter 'CertsValidityPeriod' with value of 'Years' to machine roles properties of machine CA01
09:10:09|00:12:41|00:03:51.244|   - Adding parameter 'CertsValidityPeriod' with value of 'Years' to machine roles properties of machine CA01
VERBOSE: Get-LabVM Entering... (Role=CaSubordinate,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (Role=FirstChildDC)
VERBOSE: Wait-LWLabJob Entering... (Job=<null>,Timeout=15,NoDisplay=True,ProgressIndicator=10)
VERBOSE: [09:10:09][Write-ScreenInfo] .
09:10:09|00:12:42|00:03:51.891|   - .
VERBOSE: [09:10:09][Write-ScreenInfo] 09:10:09|00:12:42|00:03:51.891|   - .
VERBOSE: [09:10:09][Wait-LWLabJob] There is no job to wait for
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:164)
VERBOSE: Get-LabVM Entering... (Role=DC)
VERBOSE: Wait-LWLabJob Entering... (Job=<null>,Timeout=15,NoDisplay=True,ProgressIndicator=10)
VERBOSE: [09:10:10][Write-ScreenInfo] .
.
VERBOSE: [09:10:10][Wait-LWLabJob] There is no job to wait for
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:141)
VERBOSE: [09:10:10][Install-LabCAMachine] Starting install of EnterpriseRootCA role on machine 'CA01'
VERBOSE: Install-LWLabCAServers Entering... (UserName=contoso.com\Administrator,Password=P@ssw0rd,ForestAdminUserName=contoso\Administrator,ForestAdminPassword=P@ssw0rd,ComputerName=CA01,DomainName=contoso.com,CACommonName=LabRootCA1,CAType=EnterpriseRootCA,KeyLength=4096,CryptoProviderName=RSA#Microsoft Software Key Storage Provider,HashAlgorithmName=SHA256,DatabaseDirectory=<null>,LogDirectory=<null>,ValidityPeriod=Years,ValidityPeriodUnits=10,CertsValidityPeriod=Years,CertsValidityPeriodUnits=5,CRLPeriod=Months,CRLPeriodUnits=15,CRLOverlapPeriod=Weeks,CRLOverlapUnits=16,CRLDeltaPeriod=Days,CRLDeltaPeriodUnits=228,UseLDAPAIA=True,UseHTTPAia=<null>,AIAHTTPURL01=<null>,AiaHttpUrl02=<null>,AIAHTTPURL01UploadLocation=<null>,AiaHttpUrl02UploadLocation=<null>,UseLDAPCRL=True,UseHTTPCRL=<null>,CDPHTTPURL01=<null>,CDPHTTPURL02=<null>,CDPHTTPURL01UploadLocation=<null>,CDPHTTPURL02UploadLocation=<null>,InstallWebEnrollment=<null>,InstallWebRole=<null>,CpsUrl=http://CA01.contoso.com/cps/cps.html,CpsText=Certification Practice Statement,InstallOCSP=<null>,OCSPHttpUrl01=<null>,OCSPHttpUrl02=<null>,DoNotLoadDefaultTemplates=<null>,PreDelaySeconds=<null>)
VERBOSE: Install-LabWindowsFeature Entering... (ComputerName=CA01,FeatureName=RSAT-AD-Tools,IncludeAllSubFeature=True,NoDisplay=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:089)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:156)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=CA01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:11][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'CA01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:10:12][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:097)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:165)
VERBOSE: [09:10:13][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:13][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:13][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:13][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:10:14][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:10:14][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:223)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:349)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:10:21][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:090)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:156)
VERBOSE: [09:10:22][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:23][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:23][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:23][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:079)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:10:23][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:10:23][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:172)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:299)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:364)
VERBOSE: Install-LWHypervWindowsFeature Entering... (Machine=AutomatedLab.Machine[](1),FeatureName=RSAT-AD-Tools,UseLocalCredential=<null>,IncludeAllSubFeature=True,IncludeManagementTools=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ActivityName=Install Windows Feature(s): 'RSAT-AD-Tools',NoDisplay=True,ScriptBlock=Install-WindowsFeature RSAT-AD-Tools -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$True -IncludeManagementTools:$False -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:10:24][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'RSAT-AD-Tools'' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:086)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:154)
VERBOSE: [09:10:25][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:25][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:25][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:26][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:099)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature RSAT-AD-Tools -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$True -IncludeManagementTools:$False -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'RSAT-AD-Tools')
VERBOSE: [09:10:26][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'RSAT-AD-Tools''
VERBOSE: [09:10:47][Invoke-LWCommand] The Output of the task on machine 'CA01' will be available in the variable 'AL_a48d2db3-2d36-49c2-b4b6-352421b93b1f'
VERBOSE: [09:10:47][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'RSAT-AD-Tools''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:21:057)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:21:191)
VERBOSE: Install-LWHypervWindowsFeature...leaving...(Time elapsed: 00:00:21:254)
VERBOSE: Dismount-LabIsoImage Entering... (ComputerName=CA01,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:47][Dismount-LWIsoImage] Removing DVD drive for machine 'CA01'
VERBOSE: Dismount-LabIsoImage...leaving...(Time elapsed: 00:00:00:618)
VERBOSE: Install-LabWindowsFeature...leaving...(Time elapsed: 00:00:00:732)
VERBOSE: [09:10:48][Install-LWLabCAServers] Performing installation of EnterpriseRootCA on 'CA01'
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Install CA on 'CA01',ComputerName=CA01,ScriptBlock=

        param ($param)
        
        $param | Export-Clixml C:\DeployDebug\CaParams.xml

        #Make semi-sure that each install of CA server is not done at the same time
        Start-Sleep -Seconds $param.PreDelaySeconds

        Import-Module -Name ServerManager

        #region - Check if CA is already installed
        if ((Get-WindowsFeature -Name 'ADCS-Cert-Authority').Installed)
        {
            Write-Output "A Certificate Authority is already installed on '$($param.ComputerName)'. Skipping installation."
            return
        }
        #endregion

        #region - Create CAPolicy file        
        $caPolicyFileName = "$Env:Windir\CAPolicy.inf"
        if (-not (Test-Path -Path $caPolicyFileName))
        {
            Write-Verbose -Message 'Create CAPolicy.inf file'
            Set-Content $caPolicyFileName -Force -Value '
VERBOSE: [09:10:49][Invoke-LabCommand] Executing lab command activity 'Install CA on 'CA01'' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:113)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:181)
VERBOSE: [09:10:49][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:10:50][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:10:50][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:10:50][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:082)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=True,Verbose=True,ComputerName=CA01,Retries=3,ArgumentList=System.Object[](1),ScriptBlock=

        param ($param)
        
        $param | Export-Clixml C:\DeployDebug\CaParams.xml

        #Make semi-sure that each install of CA server is not done at the same time
        Start-Sleep -Seconds $param.PreDelaySeconds

        Import-Module -Name ServerManager

        #region - Check if CA is already installed
        if ((Get-WindowsFeature -Name 'ADCS-Cert-Authority').Installed)
        {
            Write-Output "A Certificate Authority is already installed on '$($param.ComputerName)'. Skipping installation."
            return
        }
        #endregion

        #region - Create CAPolicy file        
        $caPolicyFileName = "$Env:Windir\CAPolicy.inf"
        if (-not (Test-Path -Path $caPolicyFileName))
        {
            Write-Verbose -Message 'Create CAPolicy.inf file'
            Set-Content $caPolicyFileName -Force -Value '
VERBOSE: [09:10:51][Invoke-LWCommand] Starting Activity 'Install CA on 'CA01''
VERBOSE: [09:10:51][Invoke-LWCommand] Finished Installation Activity 'Install CA on 'CA01''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:216)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:415)
VERBOSE: Install-LWLabCAServers...leaving...(Time elapsed: 00:00:00:517)
VERBOSE: Install-LabCAMachine...leaving...(Time elapsed: 00:00:00:615)
VERBOSE: [09:10:51][Write-ScreenInfo] Waiting for Root CA(s) to complete installation
Waiting for Root CA(s) to complete installation
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoDisplay=True)
VERBOSE: [09:10:51][Write-ScreenInfo] .
.
VERBOSE: [09:11:02][Write-ScreenInfo] .
.
VERBOSE: [09:11:12][Write-ScreenInfo] .
.
VERBOSE: [09:11:22][Write-ScreenInfo] .
.
VERBOSE: [09:11:32][Write-ScreenInfo] .
.
VERBOSE: [09:11:42][Write-ScreenInfo] .
.
VERBOSE: [09:11:53][Write-ScreenInfo] .
.
VERBOSE: [09:12:03][Write-ScreenInfo] .
.
VERBOSE: [09:12:03][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:01:11:569)
VERBOSE: [09:12:03][Install-LabCA] Getting certificates from Root CA servers and placing them in '<labfolder>\Certs' on host machine
VERBOSE: Get-LabVM Entering... (Role=CaRoot)
VERBOSE: Get-LabCAInstallCertificates Entering... )
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
                (Get-Item -Path 'C:\Windows\System32\CertSrv\CertEnroll\*.crt' |
                    Sort-Object -Property LastWritten -Descending |
                Select-Object -First 1).FullName
            ,PassThru=True,NoDisplay=True)
VERBOSE: [09:12:04][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:132)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:201)
VERBOSE: [09:12:04][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:12:05][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:12:05][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:12:05][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:084)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
                (Get-Item -Path 'C:\Windows\System32\CertSrv\CertEnroll\*.crt' |
                    Sort-Object -Property LastWritten -Descending |
                Select-Object -First 1).FullName
            ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:12:05][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:12:05][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:182)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:305)
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:12:06][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:12:06][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:12:06][New-LabPSSession] Session CA01_baf78f21-674d-4ca5-a444-a4a4f3d6933a is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 6'...(Time elapsed: 00:00:00:074)
VERBOSE: PSFileTransfer: Receiving file C:\Windows\System32\CertSrv\CertEnroll\CA01.contoso.com_LabRootCA1.crt to C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Certificates\CA01.crt from CA01 (1 MB chunks)
VERBOSE: PSFileTransfer: Finished receiving file C:\Windows\System32\CertSrv\CertEnroll\CA01.contoso.com_LabRootCA1.crt
VERBOSE: Get-LabCAInstallCertificates...leaving...(Time elapsed: 00:00:00:354)
VERBOSE: [09:12:07][Write-ScreenInfo] Publishing certificates from CA servers to all online machines
09:12:07|00:14:39|00:05:49.273|   - Publishing certificates from CA servers to all online machines
VERBOSE: [09:12:07][Write-ScreenInfo] 09:12:07|00:14:39|00:05:49.273|   - Publishing certificates from CA servers to all online machines
VERBOSE: Publish-LabCAInstallCertificates Entering... (PassThru=True)
VERBOSE: Get-LabVM Entering... (All=True,IsRunning=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:134)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:193)
VERBOSE: Get-LabVM Entering... (All=True,IsRunning=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:12:08][Publish-LabCAInstallCertificates] Target machines for publishing: 'DC01'
VERBOSE: Get-LabVM Entering... (All=True)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:12:09][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:12:09][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:12:09][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [09:12:09][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:12:10][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 7'...(Time elapsed: 00:00:00:072)
VERBOSE: [09:12:10][Publish-LabCAInstallCertificates] Send file 'C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Certificates\CA01.crt' to 'C:\Windows\CA01.crt'
VERBOSE: PSFileTransfer: Sending file C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Certificates\CA01.crt to C:\Windows on DC01 (1 MB chunks)
VERBOSE: PSFileTransfer: Finished sending file C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Certificates\CA01.crt
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Publish Lab CA(s) and install certificates,ComputerName=DC01,ScriptBlock=
            foreach ($certfile in (Get-ChildItem -Path 'C:\Windows\*.crt'))
            {
                Write-Verbose -Message "Install certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) on machine $(hostname)"
                #If workgroup, publish to local store
                if ((Get-WmiObject -Namespace root\cimv2 -Class Win32_ComputerSystem).DomainRole -eq 2)
                {
                    Write-Verbose -Message '  Machine is not domain joined. Publishing certificate to local store'

                    $Cert = Get-PfxCertificate $certfile.FullName
                    if ($Cert.GetNameInfo('SimpleName', $false) -eq $Cert.GetNameInfo('SimpleName', $true))
                    {
                        $targetStore = 'Root'
                    }
                    else
                    {
                        $targetStore = 'CA'
                    }

                    if (-not (Get-ChildItem -Path "Cert:\LocalMachine\$targetStore" | Where-Object { $_.ThumbPrint -eq (Get-PfxCertificate $($certfile.FullName)).ThumbPrint }))
                    {
                        $result = Invoke-Expression -Command "certutil -addstore -f $targetStore c:\Windows\$($certfile.BaseName).crt"

                        if ($result | Where-Object { $_ -like '*already in store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in local store on $(hostname)"
                        }
                        elseif ($result | Where-Object { $_ -like '*added to store.' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) added to local store on $(hostname)"
                        }
                        else
                        {
                            Write-Error -Message "Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) was not added to local store on $(hostname)"
                        }
                    }
                    else
                    {
                        Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in local store on $(hostname)"
                    }
                }
                else #If domain joined, publish to AD Enterprise store
                {
                    Write-Verbose -Message '  Machine is domain controller. Publishing certificate to AD Enterprise store'

                    if (((Get-PfxCertificate $($certfile.FullName)).Subject) -like '*root*')
                    {
                        $dsPublishStoreName = 'RootCA'
                        $readStoreName = 'Root'
                    }
                    else
                    {
                        $dsPublishStoreName = 'SubCA'
                        $readStoreName = 'CA'
                    }


                    if (-not (Get-ChildItem "Cert:\LocalMachine\$readStoreName" | Where-Object { $_.ThumbPrint -eq (Get-PfxCertificate $($certfile.FullName)).ThumbPrint }))
                    {
                        $result = Invoke-Expression -Command "certutil -f -dspublish c:\Windows\$($certfile.BaseName).crt $dsPublishStoreName"

                        if ($result | Where-Object { $_ -like '*Certificate added to DS store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) added to DS store on $(hostname)"
                        }
                        elseif ($result | Where-Object { $_ -like '*Certificate already in DS store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in DS store on $(hostname)"
                        }
                        else
                        {
                            Write-Error -Message "Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) was not added to DS store on $(hostname)"
                        }
                    }
                    else
                    {
                        Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in DS store on $(hostname)"
                    }
                }
            }
        ,NoDisplay=True,AsJob=True,PassThru=True)
VERBOSE: [09:12:10][Invoke-LabCommand] Executing lab command activity 'Publish Lab CA(s) and install certificates' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:094)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:177)
VERBOSE: [09:12:11][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:12:12][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:12:12][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:12:12][New-LabPSSession] Session DC01_f7ed8161-f7de-42bf-8e5c-f6554d2a1094 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 7'...(Time elapsed: 00:00:00:070)
VERBOSE: Invoke-LWCommand Entering... (AsJob=True,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            foreach ($certfile in (Get-ChildItem -Path 'C:\Windows\*.crt'))
            {
                Write-Verbose -Message "Install certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) on machine $(hostname)"
                #If workgroup, publish to local store
                if ((Get-WmiObject -Namespace root\cimv2 -Class Win32_ComputerSystem).DomainRole -eq 2)
                {
                    Write-Verbose -Message '  Machine is not domain joined. Publishing certificate to local store'

                    $Cert = Get-PfxCertificate $certfile.FullName
                    if ($Cert.GetNameInfo('SimpleName', $false) -eq $Cert.GetNameInfo('SimpleName', $true))
                    {
                        $targetStore = 'Root'
                    }
                    else
                    {
                        $targetStore = 'CA'
                    }

                    if (-not (Get-ChildItem -Path "Cert:\LocalMachine\$targetStore" | Where-Object { $_.ThumbPrint -eq (Get-PfxCertificate $($certfile.FullName)).ThumbPrint }))
                    {
                        $result = Invoke-Expression -Command "certutil -addstore -f $targetStore c:\Windows\$($certfile.BaseName).crt"

                        if ($result | Where-Object { $_ -like '*already in store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in local store on $(hostname)"
                        }
                        elseif ($result | Where-Object { $_ -like '*added to store.' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) added to local store on $(hostname)"
                        }
                        else
                        {
                            Write-Error -Message "Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) was not added to local store on $(hostname)"
                        }
                    }
                    else
                    {
                        Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in local store on $(hostname)"
                    }
                }
                else #If domain joined, publish to AD Enterprise store
                {
                    Write-Verbose -Message '  Machine is domain controller. Publishing certificate to AD Enterprise store'

                    if (((Get-PfxCertificate $($certfile.FullName)).Subject) -like '*root*')
                    {
                        $dsPublishStoreName = 'RootCA'
                        $readStoreName = 'Root'
                    }
                    else
                    {
                        $dsPublishStoreName = 'SubCA'
                        $readStoreName = 'CA'
                    }


                    if (-not (Get-ChildItem "Cert:\LocalMachine\$readStoreName" | Where-Object { $_.ThumbPrint -eq (Get-PfxCertificate $($certfile.FullName)).ThumbPrint }))
                    {
                        $result = Invoke-Expression -Command "certutil -f -dspublish c:\Windows\$($certfile.BaseName).crt $dsPublishStoreName"

                        if ($result | Where-Object { $_ -like '*Certificate added to DS store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) added to DS store on $(hostname)"
                        }
                        elseif ($result | Where-Object { $_ -like '*Certificate already in DS store*' })
                        {
                            Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in DS store on $(hostname)"
                        }
                        else
                        {
                            Write-Error -Message "Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) was not added to DS store on $(hostname)"
                        }
                    }
                    else
                    {
                        Write-Verbose -Message "  Certificate ($((Get-PfxCertificate $certfile.FullName).Subject)) is already in DS store on $(hostname)"
                    }
                }
            }
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Publish Lab CA(s) and install certificates)
VERBOSE: [09:12:12][Invoke-LWCommand] Starting Activity 'Publish Lab CA(s) and install certificates'
VERBOSE: [09:12:12][Invoke-LWCommand] Finished Installation Activity 'Publish Lab CA(s) and install certificates'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:139)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:291)
VERBOSE: Publish-LabCAInstallCertificates...leaving...(Time elapsed: 00:00:00:364)
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=20,Timeout=30,NoNewLine=True,NoDisplay=True)
VERBOSE: [09:12:13][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:258)
VERBOSE: [09:12:13][Install-LabCA] Waiting for all running machines to be contactable
VERBOSE: Get-LabVM Entering... (All=True,IsRunning=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:158)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:220)
VERBOSE: Wait-LabVM Entering... (ComputerName=System.Object[],ProgressIndicator=20,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:12:14][Remove-LabPSSession] Removed 1 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:262)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:084)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:12:15][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:12:15][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:12:15][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [09:12:16][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:12:16][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 8'...(Time elapsed: 00:00:00:071)
VERBOSE: [09:12:16][Wait-LabVM] Computer 'DC01' was reachable
VERBOSE: Remove-LabPSSession Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:17:46][Remove-LabPSSession] Removed 3 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:05:29:446)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:133)
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:17:47][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:17:47][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='CA01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:17:47][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:17:48][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:17:48][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 9'...(Time elapsed: 00:00:00:077)
VERBOSE: [09:17:48][Wait-LabVM] Computer 'CA01' was reachable
VERBOSE: [09:17:48][Wait-LabVM] Waiting for 2 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](2),ProgressIndicator=20,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:17:48][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:298)
VERBOSE: [09:17:48][Wait-LabVM] The following machines are ready: DC01, CA01
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:087)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: [09:17:49][Install-LabCA] Invoking a GPUpdate on all running machines
VERBOSE: Get-LabVM Entering... (All=True,IsRunning=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:144)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:207)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=GPUpdate after Root CA install,ComputerName=System.Object[],ScriptBlock=
            gpupdate.exe /force
        ,AsJob=True,PassThru=True,NoDisplay=True)
VERBOSE: [09:17:50][Invoke-LabCommand] Executing lab command activity 'GPUpdate after Root CA install' on machines 'DC01, CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:092)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:155)
VERBOSE: [09:17:51][Invoke-LabCommand] Creating session to computer(s) 'DC01 CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:17:52][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:17:52][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:17:52][New-LabPSSession] Session DC01_09122253-ab09-4033-837d-f5ee6d576a76 is available and will be reused
VERBOSE: [09:17:52][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:17:52][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:17:52][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:17:53][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:17:53][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 8, 10'...(Time elapsed: 00:00:00:073)
VERBOSE: Invoke-LWCommand Entering... (AsJob=True,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=True,ScriptBlock=
            gpupdate.exe /force
        ,Session=System.Management.Automation.Runspaces.PSSession[](2),RetryIntervalInSeconds=10,ActivityName=GPUpdate after Root CA install)
VERBOSE: [09:17:53][Invoke-LWCommand] Starting Activity 'GPUpdate after Root CA install'
VERBOSE: [09:17:53][Invoke-LWCommand] Finished Installation Activity 'GPUpdate after Root CA install'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:145)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:357)
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=20,Timeout=30,NoDisplay=True)
VERBOSE: [09:17:54][Write-ScreenInfo] .
.
VERBOSE: [09:18:06][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:12:403)
VERBOSE: [09:18:06][Write-ScreenInfo] Finished installation of Root CAs
VERBOSE: [09:18:06][Write-ScreenInfo] 09:18:06|00:20:39|00:11:48.499|   - Finished installation of Root CAs
09:18:06|00:20:39|00:11:48.499|   - Finished installation of Root CAs
VERBOSE: Install-LabCA...leaving...(Time elapsed: 00:00:12:550)
VERBOSE: [09:18:06][Write-ScreenInfo] Done
VERBOSE: [09:18:06][Write-ScreenInfo] 09:18:06|00:20:39|00:11:49.317| - Done
09:18:06|00:20:39|00:11:49.317| - Done
VERBOSE: Get-LabVM Entering... (Role=DSCPullServer)
VERBOSE: Get-LabVM Entering... (Role=HyperV)
VERBOSE: Get-LabVM Entering... (Role=FailoverStorage, FailoverNode)
VERBOSE: Get-LabVM Entering... (Role=SQLServer)
VERBOSE: Get-LabVM Entering... (Role=ADFS)
VERBOSE: Get-LabVM Entering... (Role=WebServer)
VERBOSE: Get-LabVM Entering... (Role=Orchestrator2012)
VERBOSE: Get-LabVM Entering... (Role=SharePoint2013)
VERBOSE: Get-LabVM Entering... (Role=VisualStudio2013)
VERBOSE: Get-LabVM Entering... (Role=VisualStudio2015)
VERBOSE: Get-LabVM Entering... (Role=Office2013)
VERBOSE: Get-LabVM Entering... (Role=Office2016)
VERBOSE: Get-LabVM Entering... (Role=Tfs2015, Tfs2017, TfsBuildWorker, Tfs2018, AzDevOps)
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: [09:18:08][Write-ScreenInfo] Starting remaining machines
VERBOSE: [09:18:08][Write-ScreenInfo] 09:18:08|00:20:41|00:00:00.001| Starting remaining machines
09:18:08|00:20:41|00:00:00.001| Starting remaining machines
VERBOSE: [09:18:08][Write-ScreenInfo] Waiting for machines to start up...
09:18:08|00:20:41|00:00:00.078| - Waiting for machines to start up...
VERBOSE: [09:18:08][Write-ScreenInfo] 09:18:08|00:20:41|00:00:00.078| - Waiting for machines to start up...
VERBOSE: Start-LabVM Entering... (All=True,DelayBetweenComputers=<null>,ProgressIndicator=30,TimeoutInMinutes=60,Wait=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:145)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:208)
VERBOSE: [09:18:09][Start-LabVM] Starting VMs 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:094)
VERBOSE: Repair-LWHypervNetworkConfig Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE01,NoNewLine=True,ProgressIndicator=10)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:18:11][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:271)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE01,TimeoutInMinutes=60,PostDelaySeconds=<null>,ProgressIndicator=10,DoNotUseCredSsp=True,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:18:12][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:370)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:114)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:18:13][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:18:13][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='IISNODE01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:18:13][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: Connection Timeout
VERBOSE: [09:18:16][New-LabPSSession] Port was NOT open, cannot create session.
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: '...(Time elapsed: 00:00:07:896)
VERBOSE: [09:18:21][Wait-LabVM] Computer '' was not reachable, waiting...
VERBOSE: [09:18:21][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:18:21][Write-ScreenInfo] .
.
VERBOSE: [09:18:31][Write-ScreenInfo] .
.
VERBOSE: [09:18:41][Write-ScreenInfo] .
.
VERBOSE: [09:18:51][Write-ScreenInfo] .
.
VERBOSE: [09:19:02][Write-ScreenInfo] .
.
VERBOSE: [09:19:12][Write-ScreenInfo] .
.
VERBOSE: [09:19:22][Write-ScreenInfo] .
.
VERBOSE: [09:19:32][Write-ScreenInfo] .
.
VERBOSE: [09:19:42][Write-ScreenInfo] .
.
VERBOSE: [09:19:52][Write-ScreenInfo] .
.
VERBOSE: [09:20:02][Write-ScreenInfo] .
.
VERBOSE: [09:20:12][Write-ScreenInfo] .
.
VERBOSE: [09:20:23][Write-ScreenInfo] .
.
VERBOSE: [09:20:33][Write-ScreenInfo] .
.
VERBOSE: [09:20:43][Write-ScreenInfo] .
.
VERBOSE: [09:20:53][Write-ScreenInfo] .
.
VERBOSE: [09:21:03][Write-ScreenInfo] .
.
VERBOSE: [09:21:13][Write-ScreenInfo] .
.
VERBOSE: [09:21:23][Write-ScreenInfo] .
.
VERBOSE: [09:21:33][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:03:13:514)
VERBOSE: [09:21:35][Wait-LabVM] The following machines are ready: IISNODE01
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:114)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:399)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:21:36][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:103)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:224)
VERBOSE: [09:21:37][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:21:38][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:21:38][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:21:38][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:21:39][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:21:39][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 11'...(Time elapsed: 00:00:00:073)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:21:39][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:21:40][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:598)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:717)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:140)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:237)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:21:41][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:21:41][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='IISNODE01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:21:41][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:21:42][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:21:42][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 12'...(Time elapsed: 00:00:00:073)
VERBOSE: [09:21:42][Wait-LabVM] Computer 'IISNODE01' was reachable
VERBOSE: [09:21:42][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:21:42][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:310)
VERBOSE: [09:21:42][Wait-LabVM] The following machines are ready: IISNODE01
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:163)
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='E:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='E:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ActivityName=Network config on 'IISNODE01' (renaming and ordering),ScriptBlock=
        $machine = [System.Management.Automation.PSSerializer]::Deserialize($machineStream)

        Write-Verbose "Renaming network adapters"
        #rename the adapters as defined in the lab
        
        $newNames = @()
        foreach ($adapterInfo in $machine.NetworkAdapters)
        {
            $newName = Add-StringIncrement -String $adapterInfo.VirtualSwitch.Name
            while ($newName -in $newNames)
            {
                $newName = Add-StringIncrement -String $newName
            }
            $newNames += $newName
            $adapterInfo.VirtualSwitch.Name = $newName
                
            if ($machine.OperatingSystem.Version.Major -lt 6 -and $machine.OperatingSystem.Version.Minor -lt 2)
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join ':'
                $filter = 'MACAddress = "{0}"' -f $mac
                Write-Verbose "Looking for network adapter with using filter '$filter'"
                $adapter = Get-CimInstance -Class Win32_NetworkAdapter -Filter $filter
    
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                $adapter.NetConnectionID = $newName
                $adapter.Put()
            }
            else
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join '-'
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                Get-NetAdapter | Where-Object MacAddress -eq $mac | Rename-NetAdapter -NewName $newName
            }
        }

        #There is no need to change the network binding order in Windows 10 or 2016
        #Adjusting the Network Protocol Bindings in Windows 10 https://blogs.technet.microsoft.com/networking/2015/08/14/adjusting-the-network-protocol-bindings-in-windows-10/
        if ([System.Environment]::OSVersion.Version.Major -lt 10)
        {
            $retries = $machine.NetworkAdapters.Count * $machine.NetworkAdapters.Count * 2
            $i = 0

            $sortedAdapters = New-Object System.Collections.ArrayList
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -ne 'Internal' }))
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -eq 'Internal' }))
             
            Write-Verbose "Setting the network order"
            [array]::Reverse($machine.NetworkAdapters)
            foreach ($adapterInfo in $sortedAdapters)
            {
                Write-Verbose "Setting the order for adapter '$($adapterInfo.VirtualSwitch.Name)'"
                do {
                    nvspbind.exe /+ $adapterInfo.VirtualSwitch.Name ms_tcpip | Out-File -FilePath c:\nvspbind.log -Append
                    $i++

                    if ($i -gt $retries) { return }
                }  until ($LASTEXITCODE -eq 14)
            }
        }
    
    ,Function=System.Management.Automation.FunctionInfo[](2),Variable=System.Management.Automation.PSVariable[](1),NoDisplay=True)
VERBOSE: [09:21:45][Invoke-LabCommand] Executing lab command activity 'Network config on 'IISNODE01' (renaming and ordering)' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: [09:21:46][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:21:46][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:21:46][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:21:46][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:21:47][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:21:47][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 13'...(Time elapsed: 00:00:00:072)
VERBOSE: [09:21:47][Invoke-LabCommand] Adding functions 'Get-StringSection,Add-StringIncrement' to session
VERBOSE: [09:21:48][Invoke-LabCommand] Adding variables 'System.Management.Automation.PSVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=
        $machine = [System.Management.Automation.PSSerializer]::Deserialize($machineStream)

        Write-Verbose "Renaming network adapters"
        #rename the adapters as defined in the lab
        
        $newNames = @()
        foreach ($adapterInfo in $machine.NetworkAdapters)
        {
            $newName = Add-StringIncrement -String $adapterInfo.VirtualSwitch.Name
            while ($newName -in $newNames)
            {
                $newName = Add-StringIncrement -String $newName
            }
            $newNames += $newName
            $adapterInfo.VirtualSwitch.Name = $newName
                
            if ($machine.OperatingSystem.Version.Major -lt 6 -and $machine.OperatingSystem.Version.Minor -lt 2)
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join ':'
                $filter = 'MACAddress = "{0}"' -f $mac
                Write-Verbose "Looking for network adapter with using filter '$filter'"
                $adapter = Get-CimInstance -Class Win32_NetworkAdapter -Filter $filter
    
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                $adapter.NetConnectionID = $newName
                $adapter.Put()
            }
            else
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join '-'
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                Get-NetAdapter | Where-Object MacAddress -eq $mac | Rename-NetAdapter -NewName $newName
            }
        }

        #There is no need to change the network binding order in Windows 10 or 2016
        #Adjusting the Network Protocol Bindings in Windows 10 https://blogs.technet.microsoft.com/networking/2015/08/14/adjusting-the-network-protocol-bindings-in-windows-10/
        if ([System.Environment]::OSVersion.Version.Major -lt 10)
        {
            $retries = $machine.NetworkAdapters.Count * $machine.NetworkAdapters.Count * 2
            $i = 0

            $sortedAdapters = New-Object System.Collections.ArrayList
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -ne 'Internal' }))
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -eq 'Internal' }))
             
            Write-Verbose "Setting the network order"
            [array]::Reverse($machine.NetworkAdapters)
            foreach ($adapterInfo in $sortedAdapters)
            {
                Write-Verbose "Setting the order for adapter '$($adapterInfo.VirtualSwitch.Name)'"
                do {
                    nvspbind.exe /+ $adapterInfo.VirtualSwitch.Name ms_tcpip | Out-File -FilePath c:\nvspbind.log -Append
                    $i++

                    if ($i -gt $retries) { return }
                }  until ($LASTEXITCODE -eq 14)
            }
        }
    
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Network config on 'IISNODE01' (renaming and ordering))
VERBOSE: [09:21:48][Invoke-LWCommand] Starting Activity 'Network config on 'IISNODE01' (renaming and ordering)'
VERBOSE: [09:21:49][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_6bfbf289-e135-429f-a0ad-23a244b24247'
VERBOSE: [09:21:49][Invoke-LWCommand] Finished Installation Activity 'Network config on 'IISNODE01' (renaming and ordering)'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:01:132)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:258)
VERBOSE: Repair-LWHypervNetworkConfig...leaving...(Time elapsed: 00:00:02:310)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:145)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:089)
VERBOSE: Repair-LWHypervNetworkConfig Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE02,NoNewLine=True,ProgressIndicator=10)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:21:52][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:281)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:118)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE02,TimeoutInMinutes=60,PostDelaySeconds=<null>,ProgressIndicator=10,DoNotUseCredSsp=True,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:21:53][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:294)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:123)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:21:54][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:21:54][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='IISNODE02\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:21:54][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: Connection Timeout
VERBOSE: [09:21:57][New-LabPSSession] Port was NOT open, cannot create session.
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: '...(Time elapsed: 00:00:07:871)
VERBOSE: [09:22:02][Wait-LabVM] Computer '' was not reachable, waiting...
VERBOSE: [09:22:02][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:22:02][Write-ScreenInfo] .
.
VERBOSE: [09:22:13][Write-ScreenInfo] .
.
VERBOSE: [09:22:23][Write-ScreenInfo] .
.
VERBOSE: [09:22:33][Write-ScreenInfo] .
.
VERBOSE: [09:22:43][Write-ScreenInfo] .
.
VERBOSE: [09:22:53][Write-ScreenInfo] .
.
VERBOSE: [09:23:03][Write-ScreenInfo] .
.
VERBOSE: [09:23:13][Write-ScreenInfo] .
.
VERBOSE: [09:23:23][Write-ScreenInfo] .
.
VERBOSE: [09:23:33][Write-ScreenInfo] .
.
VERBOSE: [09:23:44][Write-ScreenInfo] .
.
VERBOSE: [09:23:54][Write-ScreenInfo] .
.
VERBOSE: [09:24:04][Write-ScreenInfo] .
.
VERBOSE: [09:24:14][Write-ScreenInfo] .
.
VERBOSE: [09:24:24][Write-ScreenInfo] .
.
VERBOSE: [09:24:34][Write-ScreenInfo] .
.
VERBOSE: [09:24:44][Write-ScreenInfo] .
.
VERBOSE: [09:24:54][Write-ScreenInfo] .
.
VERBOSE: [09:25:04][Write-ScreenInfo] .
.
VERBOSE: [09:25:14][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:03:12:322)
VERBOSE: [09:25:15][Wait-LabVM] The following machines are ready: IISNODE02
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:424)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE02)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:687)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:18][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:131)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:204)
VERBOSE: [09:25:19][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:19][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:19][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:25:20][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:20][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:20][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 14'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:21][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:25:21][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:618)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:752)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE02)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:245)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:388)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:22][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:22][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='IISNODE02\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:22][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:23][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:23][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 15'...(Time elapsed: 00:00:00:080)
VERBOSE: [09:25:23][Wait-LabVM] Computer 'IISNODE02' was reachable
VERBOSE: [09:25:24][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=10,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:25:24][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:304)
VERBOSE: [09:25:24][Wait-LabVM] The following machines are ready: IISNODE02
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:093)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:156)
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='E:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='E:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Perform operation 'Query CimInstances' with following parameters, ''queryExpression' = SELECT * FROM Win32_LogicalDisk WHERE DeviceId='C:','queryDialect' = WQL,'namespaceName' = root\cimv2'.
VERBOSE: Operation 'Query CimInstances' complete.
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ActivityName=Network config on 'IISNODE02' (renaming and ordering),ScriptBlock=
        $machine = [System.Management.Automation.PSSerializer]::Deserialize($machineStream)

        Write-Verbose "Renaming network adapters"
        #rename the adapters as defined in the lab
        
        $newNames = @()
        foreach ($adapterInfo in $machine.NetworkAdapters)
        {
            $newName = Add-StringIncrement -String $adapterInfo.VirtualSwitch.Name
            while ($newName -in $newNames)
            {
                $newName = Add-StringIncrement -String $newName
            }
            $newNames += $newName
            $adapterInfo.VirtualSwitch.Name = $newName
                
            if ($machine.OperatingSystem.Version.Major -lt 6 -and $machine.OperatingSystem.Version.Minor -lt 2)
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join ':'
                $filter = 'MACAddress = "{0}"' -f $mac
                Write-Verbose "Looking for network adapter with using filter '$filter'"
                $adapter = Get-CimInstance -Class Win32_NetworkAdapter -Filter $filter
    
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                $adapter.NetConnectionID = $newName
                $adapter.Put()
            }
            else
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join '-'
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                Get-NetAdapter | Where-Object MacAddress -eq $mac | Rename-NetAdapter -NewName $newName
            }
        }

        #There is no need to change the network binding order in Windows 10 or 2016
        #Adjusting the Network Protocol Bindings in Windows 10 https://blogs.technet.microsoft.com/networking/2015/08/14/adjusting-the-network-protocol-bindings-in-windows-10/
        if ([System.Environment]::OSVersion.Version.Major -lt 10)
        {
            $retries = $machine.NetworkAdapters.Count * $machine.NetworkAdapters.Count * 2
            $i = 0

            $sortedAdapters = New-Object System.Collections.ArrayList
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -ne 'Internal' }))
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -eq 'Internal' }))
             
            Write-Verbose "Setting the network order"
            [array]::Reverse($machine.NetworkAdapters)
            foreach ($adapterInfo in $sortedAdapters)
            {
                Write-Verbose "Setting the order for adapter '$($adapterInfo.VirtualSwitch.Name)'"
                do {
                    nvspbind.exe /+ $adapterInfo.VirtualSwitch.Name ms_tcpip | Out-File -FilePath c:\nvspbind.log -Append
                    $i++

                    if ($i -gt $retries) { return }
                }  until ($LASTEXITCODE -eq 14)
            }
        }
    
    ,Function=System.Management.Automation.FunctionInfo[](2),Variable=System.Management.Automation.PSVariable[](1),NoDisplay=True)
VERBOSE: [09:25:26][Invoke-LabCommand] Executing lab command activity 'Network config on 'IISNODE02' (renaming and ordering)' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:112)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:180)
VERBOSE: [09:25:27][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:28][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:28][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:28][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:28][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:29][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 16'...(Time elapsed: 00:00:00:095)
VERBOSE: [09:25:29][Invoke-LabCommand] Adding functions 'Get-StringSection,Add-StringIncrement' to session
VERBOSE: [09:25:29][Invoke-LabCommand] Adding variables 'System.Management.Automation.PSVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=<null>,ScriptBlock=
        $machine = [System.Management.Automation.PSSerializer]::Deserialize($machineStream)

        Write-Verbose "Renaming network adapters"
        #rename the adapters as defined in the lab
        
        $newNames = @()
        foreach ($adapterInfo in $machine.NetworkAdapters)
        {
            $newName = Add-StringIncrement -String $adapterInfo.VirtualSwitch.Name
            while ($newName -in $newNames)
            {
                $newName = Add-StringIncrement -String $newName
            }
            $newNames += $newName
            $adapterInfo.VirtualSwitch.Name = $newName
                
            if ($machine.OperatingSystem.Version.Major -lt 6 -and $machine.OperatingSystem.Version.Minor -lt 2)
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join ':'
                $filter = 'MACAddress = "{0}"' -f $mac
                Write-Verbose "Looking for network adapter with using filter '$filter'"
                $adapter = Get-CimInstance -Class Win32_NetworkAdapter -Filter $filter
    
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                $adapter.NetConnectionID = $newName
                $adapter.Put()
            }
            else
            {
                $mac = (Get-StringSection -String $adapterInfo.MacAddress -SectionSize 2) -join '-'
                Write-Verbose "Renaming adapter '$($adapter.NetConnectionID)' -> '$newName'"
                Get-NetAdapter | Where-Object MacAddress -eq $mac | Rename-NetAdapter -NewName $newName
            }
        }

        #There is no need to change the network binding order in Windows 10 or 2016
        #Adjusting the Network Protocol Bindings in Windows 10 https://blogs.technet.microsoft.com/networking/2015/08/14/adjusting-the-network-protocol-bindings-in-windows-10/
        if ([System.Environment]::OSVersion.Version.Major -lt 10)
        {
            $retries = $machine.NetworkAdapters.Count * $machine.NetworkAdapters.Count * 2
            $i = 0

            $sortedAdapters = New-Object System.Collections.ArrayList
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -ne 'Internal' }))
            $sortedAdapters.AddRange(@($machine.NetworkAdapters | Where-Object { $_.VirtualSwitch.SwitchType.Value -eq 'Internal' }))
             
            Write-Verbose "Setting the network order"
            [array]::Reverse($machine.NetworkAdapters)
            foreach ($adapterInfo in $sortedAdapters)
            {
                Write-Verbose "Setting the order for adapter '$($adapterInfo.VirtualSwitch.Name)'"
                do {
                    nvspbind.exe /+ $adapterInfo.VirtualSwitch.Name ms_tcpip | Out-File -FilePath c:\nvspbind.log -Append
                    $i++

                    if ($i -gt $retries) { return }
                }  until ($LASTEXITCODE -eq 14)
            }
        }
    
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Network config on 'IISNODE02' (renaming and ordering))
VERBOSE: [09:25:29][Invoke-LWCommand] Starting Activity 'Network config on 'IISNODE02' (renaming and ordering)'
VERBOSE: [09:25:30][Invoke-LWCommand] The Output of the task on machine 'IISNODE02' will be available in the variable 'AL_04ecc834-3a08-497b-a275-ae607107bc40'
VERBOSE: [09:25:30][Invoke-LWCommand] Finished Installation Activity 'Network config on 'IISNODE02' (renaming and ordering)'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:01:154)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:281)
VERBOSE: Repair-LWHypervNetworkConfig...leaving...(Time elapsed: 00:00:02:423)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE02)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:165)
VERBOSE: Start-LWHypervVM...leaving...(Time elapsed: 00:00:00:276)
VERBOSE: Wait-LabVM Entering... (ComputerName=System.Object[],TimeoutInMinutes=60,DoNotUseCredSsp=<null>,ProgressIndicator=30,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:25:33][Remove-LabPSSession] Removed 1 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:346)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:187)
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:25:34][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:25:34][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:34][New-LabPSSession] Testing port 5985 on computer 'DC01'
VERBOSE: [09:25:35][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:35][New-LabPSSession] Session to computer 'DC01' created
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:093)
VERBOSE: [09:25:35][Wait-LabVM] Computer 'DC01' was reachable
VERBOSE: Remove-LabPSSession Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:25:36][Remove-LabPSSession] Removed 2 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:380)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:098)
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:25:37][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:25:37][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='CA01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:37][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:25:37][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:38][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 18'...(Time elapsed: 00:00:00:095)
VERBOSE: [09:25:38][Wait-LabVM] Computer 'CA01' was reachable
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:25:39][Remove-LabPSSession] Removed 3 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:679)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:119)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE01,TimeoutInMinutes=60,PostDelaySeconds=<null>,ProgressIndicator=30,DoNotUseCredSsp=True,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:25:40][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:274)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:086)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:25:41][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:25:41][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='IISNODE01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:25:41][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:25:41][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:42][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 19'...(Time elapsed: 00:00:00:088)
VERBOSE: [09:25:42][Wait-LabVM] Computer 'IISNODE01' was reachable
VERBOSE: [09:25:42][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=30,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:25:42][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:311)
VERBOSE: [09:25:42][Wait-LabVM] The following machines are ready: IISNODE01
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:43][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:105)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:187)
VERBOSE: [09:25:44][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:25:45][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:25:45][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:25:45][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:25:45][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:46][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 20'...(Time elapsed: 00:00:00:087)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:46][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:25:46][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:315)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:452)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE01)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:353)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:458)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:25:48][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:25:48][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='IISNODE01\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:48][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:25:48][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:48][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 21'...(Time elapsed: 00:00:00:083)
VERBOSE: [09:25:49][Wait-LabVM] Computer 'IISNODE01' was reachable
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:50][Remove-LabPSSession] Removed 3 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:707)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:110)
VERBOSE: Wait-LabVM Entering... (ComputerName=IISNODE02,TimeoutInMinutes=60,PostDelaySeconds=<null>,ProgressIndicator=30,DoNotUseCredSsp=True,NoNewLine=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Remove-LabPSSession Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:51][Remove-LabPSSession] Removed 0 PSSessions...
VERBOSE: Remove-LabPSSession...leaving...(Time elapsed: 00:00:00:276)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:096)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=True,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:52][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:52][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='IISNODE02\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:25:52][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:52][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:52][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 22'...(Time elapsed: 00:00:00:076)
VERBOSE: [09:25:52][Wait-LabVM] Computer 'IISNODE02' was reachable
VERBOSE: [09:25:53][Wait-LabVM] Waiting for 1 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](1),ProgressIndicator=30,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:25:53][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:310)
VERBOSE: [09:25:53][Wait-LabVM] The following machines are ready: IISNODE02
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:54][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:112)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:191)
VERBOSE: [09:25:55][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=True,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:56][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:56][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='True')
VERBOSE: [09:25:56][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:56][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:56][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 23'...(Time elapsed: 00:00:00:086)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=

                        if ($PSVersionTable.PSVersion.Major -eq 2)
                        {
                            $d = "{0:HH:mm}" -f (Get-Date).AddMinutes(1)
                            $jobName = "AL_EnableCredSsp"
                            $Path = 'PowerShell'
                            $CommandLine = '-Command Enable-WSManCredSSP -Role Server -Force
VERBOSE: [09:25:57][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:25:57][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:275)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:417)
VERBOSE: Set-LWHypervVMDescription Entering... (Hashtable=System.Collections.Hashtable,ComputerName=IISNODE02)
VERBOSE: Set-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:371)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:489)
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,UseLocalCredential=True,Retries=1,DoNotUseCredSsp=<null>,ErrorAction=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:25:58][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:25:58][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='IISNODE02\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:25:58][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:25:59][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:25:59][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 24'...(Time elapsed: 00:00:00:081)
VERBOSE: [09:25:59][Wait-LabVM] Computer 'IISNODE02' was reachable
VERBOSE: [09:25:59][Wait-LabVM] Waiting for 4 machines to respond in timeout (60 minute(s))
VERBOSE: Wait-LWLabJob Entering... (Job=System.Management.Automation.Job[](4),ProgressIndicator=30,NoNewLine=True,NoDisplay=True,Timeout=60)
VERBOSE: [09:26:00][Write-ScreenInfo] .
.
VERBOSE: Wait-LWLabJob...leaving...(Time elapsed: 00:00:00:342)
VERBOSE: [09:26:00][Wait-LabVM] The following machines are ready: DC01, CA01, IISNODE01, IISNODE02
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:110)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:109)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:108)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMDescription...leaving...(Time elapsed: 00:00:00:113)
VERBOSE: Wait-LabVM...leaving...(Time elapsed: 00:00:00:193)
VERBOSE: [09:26:01][Write-ScreenInfo] .
.
VERBOSE: Start-LabVM...leaving...(Time elapsed: 00:00:00:343)
VERBOSE: [09:26:01][Write-ScreenInfo] Done
VERBOSE: [09:26:01][Write-ScreenInfo] 09:26:01|00:28:34|00:07:53.210| - Done
09:26:01|00:28:34|00:07:53.210| - Done
VERBOSE: Get-LabVM Entering... )
VERBOSE: Get-LabVM Entering... )
VERBOSE: Invoke-LabCommand Entering... (PostInstallationActivity=True,ActivityName=Post-installation,ComputerName=System.Object[],PassThru=True,NoDisplay=True)
VERBOSE: [09:26:02][Invoke-LabCommand] Executing lab command activity 'Post-installation' on machines 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: [09:26:02][Invoke-LabCommand] There are no machine with PostInstallationActivity defined, exiting...
VERBOSE: Get-LabAzureWebApp Entering... )
VERBOSE: Get-LabAzureWebApp...leaving...(Time elapsed: 00:00:00:084)
VERBOSE: [09:26:03][Send-ALNotification] Send-ALToastNotification
VERBOSE: Install-Lab...leaving...(Time elapsed: 00:00:00:623)
VERBOSE: Get-LabVM Entering... )
VERBOSE: Install-LabWindowsFeature Entering... (FeatureName=Telnet-Client,ComputerName=System.Object[],IncludeManagementTools=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: [09:26:03][Write-ScreenInfo] Installing Windows Feature(s) 'Telnet-Client' on computer(s) 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: [09:26:03][Write-ScreenInfo] 09:26:03|00:28:36|00:00:00.001| Installing Windows Feature(s) 'Telnet-Client' on computer(s) 'DC01, CA01, IISNODE01, IISNODE02'
09:26:03|00:28:36|00:00:00.001| Installing Windows Feature(s) 'Telnet-Client' on computer(s) 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:154)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:243)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=DC01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:26:05][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'DC01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:05][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:109)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:182)
VERBOSE: [09:26:06][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:26:07][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:26:07][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:26:07][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:094)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:07][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:08][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:341)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:483)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:14][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:093)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:159)
VERBOSE: [09:26:15][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:26:15][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:26:15][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:26:15][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:091)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:16][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:16][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:180)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:306)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:373)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=CA01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:26:16][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'CA01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:17][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:108)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:173)
VERBOSE: [09:26:18][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:26:18][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:26:18][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:26:18][New-LabPSSession] Testing port 5985 on computer 'CA01'
VERBOSE: [09:26:19][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:26:19][New-LabPSSession] Session to computer 'CA01' created
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:082)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:19][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:19][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:283)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:408)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:26][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:095)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:26:27][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:26:27][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:26:27][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:26:27][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:074)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:27][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:27][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:160)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:296)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:362)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:26:28][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:29][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:097)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:26:29][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:26:30][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:26:30][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:26:30][New-LabPSSession] Testing port 5985 on computer 'IISNODE01'
VERBOSE: [09:26:31][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:26:31][New-LabPSSession] Session to computer 'IISNODE01' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:071)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:31][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:31][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:322)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:442)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:38][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:166)
VERBOSE: [09:26:38][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:26:39][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:26:39][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:26:39][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:077)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:39][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:39][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:292)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:357)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE02,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:26:40][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE02'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:40][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:103)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: [09:26:41][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:26:42][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:26:42][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: [09:26:42][New-LabPSSession] Testing port 5985 on computer 'IISNODE02'
VERBOSE: [09:26:42][New-LabPSSession] Port was open, trying to create the session
VERBOSE: [09:26:43][New-LabPSSession] Session to computer 'IISNODE02' created
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:072)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:43][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:43][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:285)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:415)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:26:49][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:093)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:26:50][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:26:51][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:26:51][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:26:51][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:068)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:26:51][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:26:51][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:295)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:364)
VERBOSE: Install-LWHypervWindowsFeature Entering... (Machine=AutomatedLab.Machine[](4),FeatureName=Telnet-Client,UseLocalCredential=<null>,IncludeAllSubFeature=<null>,IncludeManagementTools=True,AsJob=<null>,PassThru=<null>)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=Install Windows Feature(s): 'Telnet-Client',NoDisplay=True,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:26:52][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'Telnet-Client'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: [09:26:53][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:26:53][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:26:53][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:26:53][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:068)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'Telnet-Client')
VERBOSE: [09:26:54][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: [09:27:05][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_dfc25362-13f0-4df4-bb0d-064968c3a55e'
VERBOSE: [09:27:05][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:11:375)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:11:533)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ActivityName=Install Windows Feature(s): 'Telnet-Client',NoDisplay=True,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:27:06][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'Telnet-Client'' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:099)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: [09:27:06][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:27:07][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:27:07][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:27:07][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:083)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'Telnet-Client')
VERBOSE: [09:27:07][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: [09:27:16][Invoke-LWCommand] The Output of the task on machine 'CA01' will be available in the variable 'AL_b3dab9cc-60af-4132-9186-f4a18e9ce229'
VERBOSE: [09:27:16][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:08:499)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:08:632)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ActivityName=Install Windows Feature(s): 'Telnet-Client',NoDisplay=True,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:27:17][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'Telnet-Client'' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:125)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:189)
VERBOSE: [09:27:18][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:27:18][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:27:18][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:27:18][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:073)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'Telnet-Client')
VERBOSE: [09:27:19][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: [09:27:28][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_505200f7-5b64-438e-aa1f-68105e869bb9'
VERBOSE: [09:27:28][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:09:299)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:09:475)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ActivityName=Install Windows Feature(s): 'Telnet-Client',NoDisplay=True,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:27:29][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'Telnet-Client'' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:112)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:182)
VERBOSE: [09:27:30][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:27:30][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:27:30][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:27:30][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:094)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature Telnet-Client -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'Telnet-Client')
VERBOSE: [09:27:31][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: [09:27:40][Invoke-LWCommand] The Output of the task on machine 'IISNODE02' will be available in the variable 'AL_29b40419-02b1-4d9d-9588-dad7bd11ae0d'
VERBOSE: [09:27:40][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'Telnet-Client''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:09:553)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:09:680)
VERBOSE: Install-LWHypervWindowsFeature...leaving...(Time elapsed: 00:00:09:743)
VERBOSE: Dismount-LabIsoImage Entering... (ComputerName=System.Object[],SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:27:41][Dismount-LWIsoImage] Removing DVD drive for machine 'DC01'
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:27:41][Dismount-LWIsoImage] Removing DVD drive for machine 'CA01'
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:27:42][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE01'
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:27:43][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE02'
VERBOSE: Dismount-LabIsoImage...leaving...(Time elapsed: 00:00:00:706)
VERBOSE: [09:27:44][Write-ScreenInfo] Done
VERBOSE: [09:27:44][Write-ScreenInfo] 09:27:44|00:30:16|00:01:40.079| - Done
09:27:44|00:30:16|00:01:40.079| - Done
VERBOSE: Install-LabWindowsFeature...leaving...(Time elapsed: 00:00:00:847)
VERBOSE: Install-LabWindowsFeature Entering... (FeatureName=System.Object[],ComputerName=System.Object[],IncludeManagementTools=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: [09:27:44][Write-ScreenInfo] Installing Windows Feature(s) 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth' on computer(s) 'IISNODE01, IISNODE02'
VERBOSE: [09:27:44][Write-ScreenInfo] 09:27:44|00:30:17|00:00:00.000| Installing Windows Feature(s) 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth' on computer(s) 'IISNODE01, IISNODE02'
09:27:44|00:30:17|00:00:00.000| Installing Windows Feature(s) 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth' on computer(s) 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:119)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:181)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:27:45][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:27:46][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:083)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:151)
VERBOSE: [09:27:46][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:27:47][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:27:47][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:27:47][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:079)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:27:47][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:27:47][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:149)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:275)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:27:55][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:095)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:160)
VERBOSE: [09:27:56][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:27:56][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:27:56][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:27:56][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:074)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:27:57][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:27:57][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:158)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:281)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:356)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE02,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:27:57][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE02'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:27:58][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:169)
VERBOSE: [09:27:58][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:27:59][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:27:59][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:27:59][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:086)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:27:59][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:27:59][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:159)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:290)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:28:06][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:091)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:28:07][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:28:07][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:28:07][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:28:07][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:082)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:28:08][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:28:08][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:170)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:298)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:370)
VERBOSE: Install-LWHypervWindowsFeature Entering... (Machine=AutomatedLab.Machine[](2),FeatureName=System.Object[],UseLocalCredential=<null>,IncludeAllSubFeature=<null>,IncludeManagementTools=True,AsJob=<null>,PassThru=<null>)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth',NoDisplay=True,ScriptBlock=Install-WindowsFeature FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:28:08][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth'' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:121)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:204)
VERBOSE: [09:28:09][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:28:10][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:28:10][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:28:10][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:089)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth')
VERBOSE: [09:28:10][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth''
VERBOSE: [09:29:09][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_be5a0c63-3cc6-4382-b221-1922654f1224'
VERBOSE: [09:29:09][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:58:777)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:58:948)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth',NoDisplay=True,ScriptBlock=Install-WindowsFeature FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:29:10][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth'' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:131)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:219)
VERBOSE: [09:29:11][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:29:12][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:29:12][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:29:12][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:097)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth')
VERBOSE: [09:29:12][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth''
VERBOSE: [09:30:11][Invoke-LWCommand] The Output of the task on machine 'IISNODE02' will be available in the variable 'AL_a75e6a96-24d1-4d49-9326-99123bdab43e'
VERBOSE: [09:30:11][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'FS-DFS-Replication, Web-Server, Web-Asp-Net45, Web-Request-Monitor, Web-Windows-Auth''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:59:598)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:59:754)
VERBOSE: Install-LWHypervWindowsFeature...leaving...(Time elapsed: 00:00:59:835)
VERBOSE: Dismount-LabIsoImage Entering... (ComputerName=System.Object[],SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:30:12][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE01'
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:30:13][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE02'
VERBOSE: Dismount-LabIsoImage...leaving...(Time elapsed: 00:00:00:750)
VERBOSE: [09:30:14][Write-ScreenInfo] Done
VERBOSE: [09:30:14][Write-ScreenInfo] 09:30:14|00:32:47|00:02:29.991| - Done
09:30:14|00:32:47|00:02:29.991| - Done
VERBOSE: Install-LabWindowsFeature...leaving...(Time elapsed: 00:00:00:916)
VERBOSE: Install-LabWindowsFeature Entering... (FeatureName=FS-DFS-Replication,ComputerName=DC01,IncludeManagementTools=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:14][Write-ScreenInfo] Installing Windows Feature(s) 'FS-DFS-Replication' on computer(s) 'DC01'
VERBOSE: [09:30:14][Write-ScreenInfo] 09:30:14|00:32:47|00:00:00.002| Installing Windows Feature(s) 'FS-DFS-Replication' on computer(s) 'DC01'
09:30:14|00:32:47|00:00:00.002| Installing Windows Feature(s) 'FS-DFS-Replication' on computer(s) 'DC01'
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:121)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:210)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=DC01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:16][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'DC01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:30:16][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:114)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:201)
VERBOSE: [09:30:17][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:30:18][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:30:18][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:18][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:081)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:30:18][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:30:18][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:215)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:347)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:30:26][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:111)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:195)
VERBOSE: [09:30:27][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:30:28][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:30:28][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:28][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:094)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:30:28][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:30:28][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:211)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:380)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:470)
VERBOSE: Install-LWHypervWindowsFeature Entering... (Machine=AutomatedLab.Machine[](1),FeatureName=FS-DFS-Replication,UseLocalCredential=<null>,IncludeAllSubFeature=<null>,IncludeManagementTools=True,AsJob=<null>,PassThru=<null>)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=DC01,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication',NoDisplay=True,ScriptBlock=Install-WindowsFeature FS-DFS-Replication -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:30:30][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'FS-DFS-Replication'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:124)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:207)
VERBOSE: [09:30:31][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:30:31][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:30:31][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:32][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:117)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature FS-DFS-Replication -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'FS-DFS-Replication')
VERBOSE: [09:30:32][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'FS-DFS-Replication''
VERBOSE: [09:30:49][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_eed03742-4786-47b5-803f-7fe6eb8804dc'
VERBOSE: [09:30:49][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'FS-DFS-Replication''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:16:974)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:17:164)
VERBOSE: Install-LWHypervWindowsFeature...leaving...(Time elapsed: 00:00:17:263)
VERBOSE: Dismount-LabIsoImage Entering... (ComputerName=DC01,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:30:50][Dismount-LWIsoImage] Removing DVD drive for machine 'DC01'
VERBOSE: Dismount-LabIsoImage...leaving...(Time elapsed: 00:00:00:731)
VERBOSE: [09:30:50][Write-ScreenInfo] Done
VERBOSE: [09:30:50][Write-ScreenInfo] 09:30:50|00:33:23|00:00:36.023| - Done
09:30:50|00:33:23|00:00:36.023| - Done
VERBOSE: Install-LabWindowsFeature...leaving...(Time elapsed: 00:00:00:900)
VERBOSE: Install-LabWindowsFeature Entering... (FeatureName=System.Object[],ComputerName=System.Object[],IncludeManagementTools=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: [09:30:51][Write-ScreenInfo] Installing Windows Feature(s) 'NLB, Web-CertProvider' on computer(s) 'IISNODE01, IISNODE02'
VERBOSE: [09:30:51][Write-ScreenInfo] 09:30:51|00:33:24|00:00:00.002| Installing Windows Feature(s) 'NLB, Web-CertProvider' on computer(s) 'IISNODE01, IISNODE02'
09:30:51|00:33:24|00:00:00.002| Installing Windows Feature(s) 'NLB, Web-CertProvider' on computer(s) 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:151)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:232)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE01,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:30:52][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE01'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:30:53][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:106)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:186)
VERBOSE: [09:30:54][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:30:54][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:30:54][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:30:55][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:095)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:30:55][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:30:55][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:268)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:421)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:31:02][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:109)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:189)
VERBOSE: [09:31:03][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:31:03][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:31:03][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:31:03][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:093)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:31:04][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:31:04][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:201)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:354)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:448)
VERBOSE: Mount-LabIsoImage Entering... (ComputerName=IISNODE02,IsoPath=C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso,SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:31:04][Mount-LWIsoImage] Adding DVD drive 'C:\LabSources\ISOs\en_windows_server_2016_updated_feb_2018_x64_dvd_11636692.iso' to machine 'IISNODE02'
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:31:05][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:119)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:201)
VERBOSE: [09:31:06][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:31:07][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:31:07][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:31:07][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:116)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:31:07][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:31:07][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:248)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:405)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:31:14][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:124)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:208)
VERBOSE: [09:31:15][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:31:16][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:31:16][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:31:16][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:107)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
            Get-WmiObject -Class Win32_LogicalDisk -Filter 'DriveType = 5 AND FileSystem LIKE "%"' | Select-Object -ExpandProperty DeviceID
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:31:16][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:31:16][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:191)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:341)
VERBOSE: Mount-LabIsoImage...leaving...(Time elapsed: 00:00:00:423)
VERBOSE: Install-LWHypervWindowsFeature Entering... (Machine=AutomatedLab.Machine[](2),FeatureName=System.Object[],UseLocalCredential=<null>,IncludeAllSubFeature=<null>,IncludeManagementTools=True,AsJob=<null>,PassThru=<null>)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE01,ActivityName=Install Windows Feature(s): 'NLB, Web-CertProvider',NoDisplay=True,ScriptBlock=Install-WindowsFeature NLB, Web-CertProvider -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:31:17][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'NLB, Web-CertProvider'' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:119)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:196)
VERBOSE: [09:31:18][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:31:19][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:31:19][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:31:19][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:093)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature NLB, Web-CertProvider -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'NLB, Web-CertProvider')
VERBOSE: [09:31:19][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'NLB, Web-CertProvider''
VERBOSE: [09:31:43][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_d55022be-24fc-4ac8-b4c6-4976f2113b2d'
VERBOSE: [09:31:43][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'NLB, Web-CertProvider''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:24:130)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:24:288)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=IISNODE02,ActivityName=Install Windows Feature(s): 'NLB, Web-CertProvider',NoDisplay=True,ScriptBlock=Install-WindowsFeature NLB, Web-CertProvider -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,UseLocalCredential=<null>,AsJob=<null>,PassThru=<null>)
VERBOSE: [09:31:44][Invoke-LabCommand] Executing lab command activity 'Install Windows Feature(s): 'NLB, Web-CertProvider'' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:130)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:209)
VERBOSE: [09:31:45][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:31:46][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:31:46][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:31:46][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:093)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=<null>,ScriptBlock=Install-WindowsFeature NLB, Web-CertProvider -Source "$(@(Get-WmiObject -Class Win32_CDRomDrive)[-1].Drive)\sources\sxs" -IncludeAllSubFeature:$False -IncludeManagementTools:$True -WarningAction SilentlyContinue,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Install Windows Feature(s): 'NLB, Web-CertProvider')
VERBOSE: [09:31:47][Invoke-LWCommand] Starting Activity 'Install Windows Feature(s): 'NLB, Web-CertProvider''
VERBOSE: [09:32:05][Invoke-LWCommand] The Output of the task on machine 'IISNODE02' will be available in the variable 'AL_7eb84693-2664-45e0-a0a4-dbdad8bad856'
VERBOSE: [09:32:05][Invoke-LWCommand] Finished Installation Activity 'Install Windows Feature(s): 'NLB, Web-CertProvider''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:18:745)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:18:897)
VERBOSE: Install-LWHypervWindowsFeature...leaving...(Time elapsed: 00:00:18:975)
VERBOSE: Dismount-LabIsoImage Entering... (ComputerName=System.Object[],SupressOutput=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:32:06][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE01'
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:32:07][Dismount-LWIsoImage] Removing DVD drive for machine 'IISNODE02'
VERBOSE: Dismount-LabIsoImage...leaving...(Time elapsed: 00:00:00:670)
VERBOSE: [09:32:07][Write-ScreenInfo] Done
VERBOSE: [09:32:07][Write-ScreenInfo] 09:32:07|00:34:40|00:01:16.546| - Done
09:32:07|00:34:40|00:01:16.546| - Done
VERBOSE: Install-LabWindowsFeature...leaving...(Time elapsed: 00:00:00:841)
VERBOSE: Get-LabVM Entering... (Role=CaRoot, CaSubordinate)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:08][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: [09:32:09][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:10][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:10][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:10][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:081)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:10][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:10][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:310)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:439)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,ArgumentList=CA01,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:11][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:088)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:150)
VERBOSE: [09:32:12][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:12][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:12][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:12][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:076)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,ArgumentList=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:13][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:13][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:194)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:321)
VERBOSE: New-LabCATemplate Entering... (TemplateName=WebServerSSL,DisplayName=Web Server SSL,SourceTemplateName=WebServer,ApplicationPolicy=Server Authentication,EnrollmentFlags=Autoenrollment,PrivateKeyFlags=AllowKeyExport,Version=2,SamAccountName=Domain Computers,ComputerName=CA01,ErrorAction=Stop)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Duplicating CA template WebServer -> WebServerSSL,ComputerName=CA01,ScriptBlock=
        Add-Type -TypeDefinition $pkiInternalsTypes

        $p = Sync-Parameter -Command (Get-Command -Name New-CATemplate) -Parameters $ALBoundParameters
        New-CATemplate @p -ErrorVariable e

        if (-not $e)
        {
            $p = Sync-Parameter -Command (Get-Command -Name Add-CATemplateStandardPermission) -Parameters $ALBoundParameters
            Add-CATemplateStandardPermission @p | Out-Null
        }
    ,Variable=System.Management.Automation.PSVariable[](5),Function=System.Management.Automation.FunctionInfo[](6),PassThru=True)
VERBOSE: [09:32:14][Write-ScreenInfo] Executing lab command activity: 'Duplicating CA template WebServer -> WebServerSSL' on machines 'CA01'
VERBOSE: [09:32:14][Write-ScreenInfo] 09:32:14|00:34:46|00:00:00.001| Executing lab command activity: 'Duplicating CA template WebServer -> WebServerSSL' on machines 'CA01'
09:32:14|00:34:46|00:00:00.001| Executing lab command activity: 'Duplicating CA template WebServer -> WebServerSSL' on machines 'CA01'
VERBOSE: [09:32:14][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:32:14][Write-ScreenInfo] 09:32:14|00:34:46|00:00:00.080| - Waiting for completion
09:32:14|00:34:46|00:00:00.080| - Waiting for completion
VERBOSE: [09:32:14][Invoke-LabCommand] Executing lab command activity 'Duplicating CA template WebServer -> WebServerSSL' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:106)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: [09:32:14][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:15][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:15][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:15][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:087)
VERBOSE: [09:32:15][Invoke-LabCommand] Adding functions 'New-CATemplate,Add-CATemplateStandardPermission,Publish-CaTemplate,Get-NextOid,Sync-Parameter,Find-CertificateAuthority' to session
VERBOSE: [09:32:15][Invoke-LabCommand] Adding variables 'System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.LocalVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
        Add-Type -TypeDefinition $pkiInternalsTypes

        $p = Sync-Parameter -Command (Get-Command -Name New-CATemplate) -Parameters $ALBoundParameters
        New-CATemplate @p -ErrorVariable e

        if (-not $e)
        {
            $p = Sync-Parameter -Command (Get-Command -Name Add-CATemplateStandardPermission) -Parameters $ALBoundParameters
            Add-CATemplateStandardPermission @p | Out-Null
        }
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Duplicating CA template WebServer -> WebServerSSL)
VERBOSE: [09:32:16][Invoke-LWCommand] Starting Activity 'Duplicating CA template WebServer -> WebServerSSL'
VERBOSE: [09:32:17][Invoke-LWCommand] Finished Installation Activity 'Duplicating CA template WebServer -> WebServerSSL'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:01:455)
VERBOSE: [09:32:17][Write-ScreenInfo] Activity done
VERBOSE: [09:32:17][Write-ScreenInfo] 09:32:17|00:34:50|00:00:03.491| - Activity done
09:32:17|00:34:50|00:00:03.491| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:600)
VERBOSE: Get-LabVM Entering... (Role=RootDC)
VERBOSE: Sync-LabActiveDirectory Entering... (ComputerName=DC01)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Performing ipconfig /registerdns on 'DC01',ComputerName=DC01,ScriptBlock= ipconfig.exe /registerdns ,NoDisplay=True)
VERBOSE: [09:32:18][Invoke-LabCommand] Executing lab command activity 'Performing ipconfig /registerdns on 'DC01'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:167)
VERBOSE: [09:32:19][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:32:19][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:32:19][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:32:19][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:082)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock= ipconfig.exe /registerdns ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Performing ipconfig /registerdns on 'DC01')
VERBOSE: [09:32:20][Invoke-LWCommand] Starting Activity 'Performing ipconfig /registerdns on 'DC01''
VERBOSE: [09:32:23][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_e26f6439-364c-4396-9002-405b045c5145'
VERBOSE: [09:32:23][Invoke-LWCommand] Finished Installation Activity 'Performing ipconfig /registerdns on 'DC01''
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:03:228)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:03:365)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Triggering replication on 'DC01',ComputerName=DC01,ScriptBlock=
            $VerbosePreference = $using:VerbosePreference

            ipconfig.exe -flushdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log

            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            ipconfig.exe /registerdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log
            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            ipconfig.exe /registerdns

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            #for debugging
            #dnscmd /zoneexport $env:USERDNSDOMAIN "c:\DeployDebug\$($env:USERDNSDOMAIN).txt"
        ,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:24][Invoke-LabCommand] Executing lab command activity 'Triggering replication on 'DC01'' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:118)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:189)
VERBOSE: [09:32:24][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:32:25][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:32:25][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:32:25][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:078)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=True,ScriptBlock=
            $VerbosePreference = $using:VerbosePreference

            ipconfig.exe -flushdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log

            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            ipconfig.exe /registerdns

            Write-Verbose -Message 'Getting list of DCs'
            $dcs = repadmin.exe /viewlist *
            Write-Verbose -Message "List: '$($dcs -join ', ')'"
            (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path c:\DeployDebug\DCList.log -Force
            $dcs | Add-Content -Path c:\DeployDebug\DCList.log
            foreach ($dc in $dcs)
            {
                if ($dc)
                {
                    $dcName = $dc.Split()[2]
                    Write-Verbose -Message "Executing 'repadmin.exe /SyncAll /Ae $dcname'"
                    $result = repadmin.exe /SyncAll /Ae $dcName
                    (Get-Date -Format 'yyyy-MM-dd hh:mm:ss') | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log" -Force
                    $result | Add-Content -Path "c:\DeployDebug\Syncs-$($dcName).log"
                }
            }
            Write-Verbose -Message "Executing 'repadmin.exe /ReplSum'"
            $result = repadmin.exe /ReplSum
            $result | Add-Content -Path c:\DeployDebug\repadmin.exeResult.log

            ipconfig.exe /registerdns

            Restart-Service -Name DNS -WarningAction SilentlyContinue

            #for debugging
            #dnscmd /zoneexport $env:USERDNSDOMAIN "c:\DeployDebug\$($env:USERDNSDOMAIN).txt"
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Triggering replication on 'DC01')
VERBOSE: [09:32:25][Invoke-LWCommand] Starting Activity 'Triggering replication on 'DC01''
VERBOSE: [09:32:33][Invoke-LWCommand] Finished Installation Activity 'Triggering replication on 'DC01''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:07:630)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:07:755)
VERBOSE: Sync-LabActiveDirectory...leaving...(Time elapsed: 00:00:07:816)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Publishing CA template WebServerSSL,ComputerName=CA01,ScriptBlock=

        $p = Sync-Parameter -Command (Get-Command -Name Publish-CATemplate, Find-CertificateAuthority) -Parameters $ALBoundParameters
        Publish-CATemplate @p

    ,Function=System.Management.Automation.FunctionInfo[](6),Variable=System.Management.Automation.PSVariable[](5))
VERBOSE: [09:32:34][Write-ScreenInfo] Executing lab command activity: 'Publishing CA template WebServerSSL' on machines 'CA01'
VERBOSE: [09:32:34][Write-ScreenInfo] 09:32:34|00:35:06|00:00:00.001| Executing lab command activity: 'Publishing CA template WebServerSSL' on machines 'CA01'
09:32:34|00:35:06|00:00:00.001| Executing lab command activity: 'Publishing CA template WebServerSSL' on machines 'CA01'
VERBOSE: [09:32:34][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:32:34][Write-ScreenInfo] 09:32:34|00:35:06|00:00:00.084| - Waiting for completion
09:32:34|00:35:06|00:00:00.084| - Waiting for completion
VERBOSE: [09:32:34][Invoke-LabCommand] Executing lab command activity 'Publishing CA template WebServerSSL' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:106)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:165)
VERBOSE: [09:32:35][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:35][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:35][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:35][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:078)
VERBOSE: [09:32:35][Invoke-LabCommand] Adding functions 'New-CATemplate,Add-CATemplateStandardPermission,Publish-CaTemplate,Get-NextOid,Sync-Parameter,Find-CertificateAuthority' to session
VERBOSE: [09:32:35][Invoke-LabCommand] Adding variables 'System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.PSVariable,System.Management.Automation.LocalVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=<null>,ScriptBlock=

        $p = Sync-Parameter -Command (Get-Command -Name Publish-CATemplate, Find-CertificateAuthority) -Parameters $ALBoundParameters
        Publish-CATemplate @p

    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Publishing CA template WebServerSSL)
VERBOSE: [09:32:36][Invoke-LWCommand] Starting Activity 'Publishing CA template WebServerSSL'
VERBOSE: [09:32:48][Invoke-LWCommand] The Output of the task on machine 'CA01' will be available in the variable 'AL_19631263-8e7d-448f-bc6b-d221950e7bab'
VERBOSE: [09:32:48][Invoke-LWCommand] Finished Installation Activity 'Publishing CA template WebServerSSL'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:12:473)
VERBOSE: [09:32:48][Write-ScreenInfo] Activity done
VERBOSE: [09:32:48][Write-ScreenInfo] 09:32:48|00:35:21|00:00:14.494| - Activity done
09:32:48|00:35:21|00:00:14.494| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:12:621)
VERBOSE: Request-LabCertificate Entering... (Subject=CN=nlb.contoso.com,SAN=System.Object[],TemplateName=WebServerSSL,ComputerName=IISNODE01,PassThru=True,ErrorAction=Stop)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LabVM Entering... (Role=CaRoot, CaSubordinate)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:49][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:107)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:177)
VERBOSE: [09:32:50][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:51][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:51][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:51][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:080)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:51][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:51][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:220)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:353)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,ArgumentList=CA01,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:52][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:082)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:151)
VERBOSE: [09:32:53][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:53][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:53][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:53][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:081)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,ArgumentList=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:54][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:54][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:187)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:318)
VERBOSE: Get-LabVM Entering... (Role=CaRoot, CaSubordinate)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:54][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:107)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:174)
VERBOSE: [09:32:55][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:56][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:56][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:56][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:075)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,PassThru=True,ScriptBlock=
        $templates = certutil.exe -CATemplates
        if ($templates -like '*Machine*')
        {
            $env:COMPUTERNAME
        }
    ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:56][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:56][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:205)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:331)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: Invoke-LabCommand Entering... (ComputerName=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,ArgumentList=CA01,PassThru=True,NoDisplay=True)
VERBOSE: [09:32:57][Invoke-LabCommand] Executing lab command activity '<unnamed>' on machines 'CA01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=CA01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=CA01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:090)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:157)
VERBOSE: [09:32:58][Invoke-LabCommand] Creating session to computer(s) 'CA01'
VERBOSE: New-LabPSSession Entering... (ComputerName=CA01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=CA01,IncludeLinux=True)
VERBOSE: [09:32:58][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:32:58][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:32:59][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 25'...(Time elapsed: 00:00:00:074)
VERBOSE: Invoke-LWCommand Entering... (PassThru=True,AsJob=<null>,Verbose=True,ComputerName=CA01,Retries=3,ArgumentList=CA01,ScriptBlock= ((certutil -config $args[0] -ping)[1] -split '"')[1] ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=<unnamed>)
VERBOSE: [09:32:59][Invoke-LWCommand] Starting Activity '<unnamed>'
VERBOSE: [09:32:59][Invoke-LWCommand] Finished Installation Activity '<unnamed>'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:178)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:318)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Requesting certificate for template 'WebServerSSL',ComputerName=IISNODE01,ScriptBlock=

            Sync-Parameter -Command (Get-Command -Name Request-Certificate)
            Request-Certificate @ALBoundParameters

        ,Variable=System.Management.Automation.PSVariable[](1),Function=System.Management.Automation.FunctionInfo[](4),PassThru=True)
VERBOSE: [09:33:00][Write-ScreenInfo] Executing lab command activity: 'Requesting certificate for template 'WebServerSSL'' on machines 'IISNODE01'
VERBOSE: [09:33:00][Write-ScreenInfo] 09:33:00|00:35:32|00:00:00.000| Executing lab command activity: 'Requesting certificate for template 'WebServerSSL'' on machines 'IISNODE01'
09:33:00|00:35:32|00:00:00.000| Executing lab command activity: 'Requesting certificate for template 'WebServerSSL'' on machines 'IISNODE01'
VERBOSE: [09:33:00][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:00][Write-ScreenInfo] 09:33:00|00:35:32|00:00:00.081| - Waiting for completion
09:33:00|00:35:32|00:00:00.081| - Waiting for completion
VERBOSE: [09:33:00][Invoke-LabCommand] Executing lab command activity 'Requesting certificate for template 'WebServerSSL'' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:104)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:167)
VERBOSE: [09:33:00][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:33:01][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:01][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:01][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:076)
VERBOSE: [09:33:01][Invoke-LabCommand] Adding functions 'Get-CATemplate,Request-Certificate,Find-CertificateAuthority,Sync-Parameter' to session
VERBOSE: [09:33:01][Invoke-LabCommand] Adding variables 'System.Management.Automation.LocalVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=

            Sync-Parameter -Command (Get-Command -Name Request-Certificate)
            Request-Certificate @ALBoundParameters

        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Requesting certificate for template 'WebServerSSL')
VERBOSE: [09:33:02][Invoke-LWCommand] Starting Activity 'Requesting certificate for template 'WebServerSSL''
VERBOSE: [09:33:15][Invoke-LWCommand] Finished Installation Activity 'Requesting certificate for template 'WebServerSSL''
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:13:186)
VERBOSE: [09:33:15][Write-ScreenInfo] Activity done
VERBOSE: [09:33:15][Write-ScreenInfo] 09:33:15|00:35:47|00:00:15.187| - Activity done
09:33:15|00:35:47|00:00:15.187| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:13:331)
VERBOSE: Request-LabCertificate...leaving...(Time elapsed: 00:00:13:416)
VERBOSE: Add-LabCertificate Entering... (ComputerName=IISNODE02,Store=My,Password=P@ssw0rd)
VERBOSE: Get-LabCertificate Entering... (ComputerName=IISNODE01,SearchString=nlb.contoso.com,FindType=FindBySubjectName,ExportPrivateKey=True,Password=System.Security.SecureString)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Adding Cert Store Types,ComputerName=IISNODE01,ScriptBlock=
            Add-Type -TypeDefinition $args[0]
            Add-Type -TypeDefinition $args[1]
        ,ArgumentList=System.Object[],NoDisplay=True)
VERBOSE: [09:33:16][Invoke-LabCommand] Executing lab command activity 'Adding Cert Store Types' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:107)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:171)
VERBOSE: [09:33:16][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:33:17][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:17][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:17][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:101)
VERBOSE: Invoke-LWCommand Entering... (PassThru=<null>,AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,ArgumentList=System.Object[],ScriptBlock=
            Add-Type -TypeDefinition $args[0]
            Add-Type -TypeDefinition $args[1]
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Adding Cert Store Types)
VERBOSE: [09:33:17][Invoke-LWCommand] Starting Activity 'Adding Cert Store Types'
VERBOSE: [09:33:18][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_323594d1-d30a-4637-9dcb-20c949d339ca'
VERBOSE: [09:33:18][Invoke-LWCommand] Finished Installation Activity 'Adding Cert Store Types'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:531)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:692)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Exporting certificates,ComputerName=IISNODE01,ScriptBlock=
            Sync-Parameter -Command (Get-Command -Name Get-Certificate2)
            Get-Certificate2 @ALBoundParameters

        ,Variable=System.Management.Automation.PSVariable[](1),Function=System.Management.Automation.FunctionInfo[](2),PassThru=True,NoDisplay=True)
VERBOSE: [09:33:19][Invoke-LabCommand] Executing lab command activity 'Exporting certificates' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:092)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:161)
VERBOSE: [09:33:19][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:33:20][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:20][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:20][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:086)
VERBOSE: [09:33:20][Invoke-LabCommand] Adding functions 'Get-Certificate2,Sync-Parameter' to session
VERBOSE: [09:33:20][Invoke-LabCommand] Adding variables 'System.Management.Automation.LocalVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=True,ScriptBlock=
            Sync-Parameter -Command (Get-Command -Name Get-Certificate2)
            Get-Certificate2 @ALBoundParameters

        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Exporting certificates)
VERBOSE: [09:33:21][Invoke-LWCommand] Starting Activity 'Exporting certificates'
VERBOSE: [09:33:21][Invoke-LWCommand] Finished Installation Activity 'Exporting certificates'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:708)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Adding Cert Store Types,ComputerName=IISNODE02,ScriptBlock=
            Add-Type -TypeDefinition $args[0]
            Add-Type -TypeDefinition $args[1]
        ,ArgumentList=System.Object[],NoDisplay=True)
VERBOSE: [09:33:22][Invoke-LabCommand] Executing lab command activity 'Adding Cert Store Types' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:102)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:178)
VERBOSE: [09:33:23][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:33:23][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:23][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:23][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:085)
VERBOSE: Invoke-LWCommand Entering... (PassThru=<null>,AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,ArgumentList=System.Object[],ScriptBlock=
            Add-Type -TypeDefinition $args[0]
            Add-Type -TypeDefinition $args[1]
        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Adding Cert Store Types)
VERBOSE: [09:33:24][Invoke-LWCommand] Starting Activity 'Adding Cert Store Types'
VERBOSE: [09:33:24][Invoke-LWCommand] The Output of the task on machine 'IISNODE02' will be available in the variable 'AL_8ebca200-3558-4903-9fba-95c5f807c404'
VERBOSE: [09:33:24][Invoke-LWCommand] Finished Installation Activity 'Adding Cert Store Types'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:511)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:644)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Importing Cert file,ComputerName=IISNODE02,ScriptBlock=
        
            Sync-Parameter -Command (Get-Command -Name Add-Certificate2)
            Add-Certificate2 @ALBoundParameters | Out-Null

        ,Variable=System.Management.Automation.PSVariable[](1),Function=System.Management.Automation.FunctionInfo[](2),PassThru=True,NoDisplay=True)
VERBOSE: [09:33:25][Invoke-LabCommand] Executing lab command activity 'Importing Cert file' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:082)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:160)
VERBOSE: [09:33:26][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:33:26][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:26][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:26][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:073)
VERBOSE: [09:33:26][Invoke-LabCommand] Adding functions 'Add-Certificate2,Sync-Parameter' to session
VERBOSE: [09:33:26][Invoke-LabCommand] Adding variables 'System.Management.Automation.LocalVariable' to session
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=True,ScriptBlock=
        
            Sync-Parameter -Command (Get-Command -Name Add-Certificate2)
            Add-Certificate2 @ALBoundParameters | Out-Null

        ,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Importing Cert file)
VERBOSE: [09:33:27][Invoke-LWCommand] Starting Activity 'Importing Cert file'
VERBOSE: [09:33:27][Invoke-LWCommand] Finished Installation Activity 'Importing Cert file'
VERBOSE: Invoke-LWCommand...leaving...(Time elapsed: 00:00:00:413)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:546)
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:618)
VERBOSE: Get-LabCertificate...leaving...(Time elapsed: 00:00:00:683)
VERBOSE: Add-LabCertificate...leaving...(Time elapsed: 00:00:00:745)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Exporting the Web Server Certificate into the future "Central Certificate Store" directory,ComputerName=System.Object[],ScriptBlock=
    New-Item -Path C:\CentralCertificateStore -ItemType Directory -Force
    $WebServerSSLCert = Get-ChildItem -Path Cert:\LocalMachine\My\ -DnsName "$using:WebSiteName" -SSLServerAuthentication | Where-Object -FilterScript {
        $_.hasPrivateKey 
    }  
    if ($WebServerSSLCert)
    {
        $WebServerSSLCert | Export-PfxCertificate -FilePath "C:\CentralCertificateStore\$using:WebSiteName.pfx" -Password $Using:SecurePassword
        $WebServerSSLCert | Remove-Item -Force
        #Import-PfxCertificate -FilePath "C:\CentralCertificateStore\$using:WebSiteName.pfx" -Password $Using:SecurePassword -CertStoreLocation Cert:\LocalMachine\My\ -Exportable 
    }
    else
    {
        Write-Error -Exception "[ERROR] Unable to create the 'Web Server SSL' certificate for $using:WebSiteName"
    }
)
VERBOSE: [09:33:28][Write-ScreenInfo] Executing lab command activity: 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:28][Write-ScreenInfo] 09:33:28|00:36:00|00:00:00.001| Executing lab command activity: 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory' on machines 'IISNODE01, IISNODE02'
09:33:28|00:36:00|00:00:00.001| Executing lab command activity: 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:28][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:28][Write-ScreenInfo] 09:33:28|00:36:01|00:00:00.079| - Waiting for completion
09:33:28|00:36:01|00:00:00.079| - Waiting for completion
VERBOSE: [09:33:28][Invoke-LabCommand] Executing lab command activity 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory' on machines 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:126)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:190)
VERBOSE: [09:33:29][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01 IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:33:29][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:29][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:29][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: [09:33:30][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:30][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:30][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26, 27'...(Time elapsed: 00:00:00:084)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=<null>,ScriptBlock=
    New-Item -Path C:\CentralCertificateStore -ItemType Directory -Force
    $WebServerSSLCert = Get-ChildItem -Path Cert:\LocalMachine\My\ -DnsName "$using:WebSiteName" -SSLServerAuthentication | Where-Object -FilterScript {
        $_.hasPrivateKey 
    }  
    if ($WebServerSSLCert)
    {
        $WebServerSSLCert | Export-PfxCertificate -FilePath "C:\CentralCertificateStore\$using:WebSiteName.pfx" -Password $Using:SecurePassword
        $WebServerSSLCert | Remove-Item -Force
        #Import-PfxCertificate -FilePath "C:\CentralCertificateStore\$using:WebSiteName.pfx" -Password $Using:SecurePassword -CertStoreLocation Cert:\LocalMachine\My\ -Exportable 
    }
    else
    {
        Write-Error -Exception "[ERROR] Unable to create the 'Web Server SSL' certificate for $using:WebSiteName"
    }
,Session=System.Management.Automation.Runspaces.PSSession[](2),RetryIntervalInSeconds=10,ActivityName=Exporting the Web Server Certificate into the future "Central Certificate Store" directory)
VERBOSE: [09:33:30][Invoke-LWCommand] Starting Activity 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory'
VERBOSE: [09:33:31][Invoke-LWCommand] The Output of the task on machine 'IISNODE01 IISNODE02' will be available in the variable 'AL_9fc1bb37-d027-42e7-93af-860903f6e947'
VERBOSE: [09:33:31][Invoke-LWCommand] Finished Installation Activity 'Exporting the Web Server Certificate into the future "Central Certificate Store" directory'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:723)
VERBOSE: [09:33:31][Write-ScreenInfo] Activity done
VERBOSE: [09:33:31][Write-ScreenInfo] 09:33:31|00:36:03|00:00:02.934| - Activity done
09:33:31|00:36:03|00:00:02.934| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:873)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone,ComputerName=System.Object[],ScriptBlock=
    #Disabling IE ESC
    $AdminKey = 'HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}'
    $UserKey = 'HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}'
    Set-ItemProperty -Path $AdminKey -Name 'IsInstalled' -Value 0 -Force
    Set-ItemProperty -Path $UserKey -Name 'IsInstalled' -Value 0 -Force

    #Setting nlb.contoso.com, IISNODE01.contoso.com and IISNODE02.contoso.com in the Local Intranet Zone for all servers : mandatory for Kerberos authentication       
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Name http -Value 1 -Type DWord -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Name https -Value 1 -Type DWord -Force
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Name http -Value 1 -Type DWord -Force
    #Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Name https -Value 1 -Type DWord -Force
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Name http -Value 1 -Type DWord -Force
    #Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Name https -Value 1 -Type DWord -Force

    #Changing the start page for IE
    $path = "HKCU:\Software\Microsoft\Internet Explorer\Main\"
    $name = "start page"
    $value = "https://$using:WebSiteName/"
    Set-ItemProperty -Path $path -Name $name -Value $value -Force
)
VERBOSE: [09:33:31][Write-ScreenInfo] Executing lab command activity: 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone' on machines 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: [09:33:31][Write-ScreenInfo] 09:33:31|00:36:04|00:00:00.000| Executing lab command activity: 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone' on machines 'DC01, CA01, IISNODE01, IISNODE02'
09:33:31|00:36:04|00:00:00.000| Executing lab command activity: 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone' on machines 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: [09:33:31][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:31][Write-ScreenInfo] 09:33:31|00:36:04|00:00:00.087| - Waiting for completion
09:33:31|00:36:04|00:00:00.087| - Waiting for completion
VERBOSE: [09:33:31][Invoke-LabCommand] Executing lab command activity 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone' on machines 'DC01, CA01, IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:140)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:200)
VERBOSE: [09:33:32][Invoke-LabCommand] Creating session to computer(s) 'DC01 CA01 IISNODE01 IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:33:33][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:33:33][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:33:33][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: [09:33:33][New-LabPSSession] Connecting to machine 'CA01' using the DNS name 'CA01'
VERBOSE: [09:33:33][New-LabPSSession] Creating a new PSSession to machine 'CA01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=CA01)
VERBOSE: [09:33:33][New-LabPSSession] Session CA01_a24f9496-0fb0-484e-8ebe-2fd5e9edc2ea is available and will be reused
VERBOSE: [09:33:33][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:33][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:34][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: [09:33:34][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:34][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:34][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17, 25, 26, 27'...(Time elapsed: 00:00:00:085)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=<null>,ScriptBlock=
    #Disabling IE ESC
    $AdminKey = 'HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}'
    $UserKey = 'HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}'
    Set-ItemProperty -Path $AdminKey -Name 'IsInstalled' -Value 0 -Force
    Set-ItemProperty -Path $UserKey -Name 'IsInstalled' -Value 0 -Force

    #Setting nlb.contoso.com, IISNODE01.contoso.com and IISNODE02.contoso.com in the Local Intranet Zone for all servers : mandatory for Kerberos authentication       
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Name http -Value 1 -Type DWord -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\$using:WebSiteName" -Name https -Value 1 -Type DWord -Force
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Name http -Value 1 -Type DWord -Force
    #Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE01.$using:FQDNDomainName" -Name https -Value 1 -Type DWord -Force
    $null = New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Force
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Name http -Value 1 -Type DWord -Force
    #Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\IISNODE02.$using:FQDNDomainName" -Name https -Value 1 -Type DWord -Force

    #Changing the start page for IE
    $path = "HKCU:\Software\Microsoft\Internet Explorer\Main\"
    $name = "start page"
    $value = "https://$using:WebSiteName/"
    Set-ItemProperty -Path $path -Name $name -Value $value -Force
,Session=System.Management.Automation.Runspaces.PSSession[](4),RetryIntervalInSeconds=10,ActivityName=Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone)
VERBOSE: [09:33:34][Invoke-LWCommand] Starting Activity 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone'
VERBOSE: [09:33:34][Invoke-LWCommand] The Output of the task on machine 'DC01 CA01 IISNODE01 IISNODE02' will be available in the variable 'AL_2d986a3f-e003-4fac-93f3-aa31ee48fc65'
VERBOSE: [09:33:34][Invoke-LWCommand] Finished Installation Activity 'Disabling IE ESC and Adding nlb.contoso.com to the IE intranet zone'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:295)
VERBOSE: [09:33:34][Write-ScreenInfo] Activity done
VERBOSE: [09:33:34][Write-ScreenInfo] 09:33:34|00:36:07|00:00:03.162| - Activity done
09:33:34|00:36:07|00:00:03.162| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:454)
VERBOSE: Copy-LabFileItem Entering... (Path=C:\Users\lavanack\OneDrive - Microsoft\Source Control\GitHub\laurentvanacker.com\PowerShell\IIS\AutomatedLab\NLB & IIS\nlb.contoso.com.zip,DestinationFolderPath=C:\Temp,ComputerName=System.Object[])
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[])
VERBOSE: Copying the items 'C:\Users\lavanack\OneDrive - Microsoft\Source Control\GitHub\laurentvanacker.com\PowerShell\IIS\AutomatedLab\NLB & IIS\nlb.contoso.com.zip' to machines 'IISNODE01, IISNODE02'
VERBOSE: Files copied on to machine 'IISNODE01'
VERBOSE: Files copied on to machine 'IISNODE02'
VERBOSE: Copy-LabFileItem...leaving...(Time elapsed: 00:00:00:640)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=IIS Setup,ComputerName=System.Object[],ScriptBlock=
    #Install-WindowsFeature FS-DFS-Replication, Web-Server,Web-Asp-Net45,Web-Request-Monitor -includeManagementTools
    #Removing "Default Web Site"
    Remove-WebSite -Name 'Default Web Site'

    #Creating a dedicated application pool
    New-WebAppPool -Name "$using:WebSiteName" -Force

    #Changing the application pool identity to classic mode (for ASP.Net impersonation)
    #Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']" -name "managedPipelineMode" -value "Classic"
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'identityType' -value 3
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'userName' -value "$Using:NetBiosDomainName\$Using:IISAppPoolUser"
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'password' -value $Using:ClearTextPassword

    #Creating a dedicated web site 
    New-WebSite -Name "$using:WebSiteName" -Port 80 -PhysicalPath "$env:systemdrive\inetpub\wwwroot" -Force
    #Assigning the the nlb.contoso.com application pool to the nlb.contoso.com web sitre
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/sites/site[@name='$using:WebSiteName']/application[@path='/']" -name 'applicationPool' -value "$using:WebSiteName"
    #Enabling the Windows useAppPoolCredentials
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'useAppPoolCredentials' -value 'True'

    #setting default.aspx as first default page
    Remove-WebconfigurationProperty -Filter 'system.webserver/defaultdocument/files' -Location "IIS:\sites\$using:WebSiteName" -name collection -AtElement @{
        value = 'default.aspx'
    } -Force
    Add-WebConfiguration -Filter 'system.webserver/defaultdocument/files' -Location "IIS:\sites\$using:WebSiteName" -atIndex 0 -Value @{
        value = 'default.aspx'
    } -Force
    
    Expand-Archive 'C:\Temp\nlb.contoso.com.zip' -DestinationPath C:\inetpub\wwwroot -Force
    '<%=HttpContext.Current.Server.MachineName%>' | Out-File -FilePath 'C:\inetpub\wwwroot\server.aspx' -Force
    'ok' | Out-File -FilePath 'C:\inetpub\wwwroot\healthcheck.aspx' -Force
)
VERBOSE: [09:33:36][Write-ScreenInfo] Executing lab command activity: 'IIS Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:36][Write-ScreenInfo] 09:33:36|00:36:09|00:00:00.000| Executing lab command activity: 'IIS Setup' on machines 'IISNODE01, IISNODE02'
09:33:36|00:36:09|00:00:00.000| Executing lab command activity: 'IIS Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:36][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:36][Write-ScreenInfo] 09:33:36|00:36:09|00:00:00.078| - Waiting for completion
09:33:36|00:36:09|00:00:00.078| - Waiting for completion
VERBOSE: [09:33:36][Invoke-LabCommand] Executing lab command activity 'IIS Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:128)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:192)
VERBOSE: [09:33:37][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01 IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:33:37][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:37][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:37][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: [09:33:38][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:38][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:38][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26, 27'...(Time elapsed: 00:00:00:070)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=<null>,ScriptBlock=
    #Install-WindowsFeature FS-DFS-Replication, Web-Server,Web-Asp-Net45,Web-Request-Monitor -includeManagementTools
    #Removing "Default Web Site"
    Remove-WebSite -Name 'Default Web Site'

    #Creating a dedicated application pool
    New-WebAppPool -Name "$using:WebSiteName" -Force

    #Changing the application pool identity to classic mode (for ASP.Net impersonation)
    #Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']" -name "managedPipelineMode" -value "Classic"
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'identityType' -value 3
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'userName' -value "$Using:NetBiosDomainName\$Using:IISAppPoolUser"
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'password' -value $Using:ClearTextPassword

    #Creating a dedicated web site 
    New-WebSite -Name "$using:WebSiteName" -Port 80 -PhysicalPath "$env:systemdrive\inetpub\wwwroot" -Force
    #Assigning the the nlb.contoso.com application pool to the nlb.contoso.com web sitre
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/sites/site[@name='$using:WebSiteName']/application[@path='/']" -name 'applicationPool' -value "$using:WebSiteName"
    #Enabling the Windows useAppPoolCredentials
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'useAppPoolCredentials' -value 'True'

    #setting default.aspx as first default page
    Remove-WebconfigurationProperty -Filter 'system.webserver/defaultdocument/files' -Location "IIS:\sites\$using:WebSiteName" -name collection -AtElement @{
        value = 'default.aspx'
    } -Force
    Add-WebConfiguration -Filter 'system.webserver/defaultdocument/files' -Location "IIS:\sites\$using:WebSiteName" -atIndex 0 -Value @{
        value = 'default.aspx'
    } -Force
    
    Expand-Archive 'C:\Temp\nlb.contoso.com.zip' -DestinationPath C:\inetpub\wwwroot -Force
    '<%=HttpContext.Current.Server.MachineName%>' | Out-File -FilePath 'C:\inetpub\wwwroot\server.aspx' -Force
    'ok' | Out-File -FilePath 'C:\inetpub\wwwroot\healthcheck.aspx' -Force
,Session=System.Management.Automation.Runspaces.PSSession[](2),RetryIntervalInSeconds=10,ActivityName=IIS Setup)
VERBOSE: [09:33:38][Invoke-LWCommand] Starting Activity 'IIS Setup'
VERBOSE: [09:33:45][Invoke-LWCommand] The Output of the task on machine 'IISNODE01 IISNODE02' will be available in the variable 'AL_8c96806f-dce9-4263-a72a-510113d0734e'
VERBOSE: [09:33:45][Invoke-LWCommand] Finished Installation Activity 'IIS Setup'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:07:054)
VERBOSE: [09:33:45][Write-ScreenInfo] Activity done
VERBOSE: [09:33:45][Write-ScreenInfo] 09:33:45|00:36:18|00:00:09.287| - Activity done
09:33:45|00:36:18|00:00:09.287| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:07:213)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=DNS & DFS-R Setup on DC,ComputerName=DC01,ScriptBlock=
    New-ADUser -Name "$Using:IISAppPoolUser" -PasswordNeverExpires $True -AccountPassword $Using:SecurePassword -CannotChangePassword $True -Enabled $True

    #Reverse lookup zone creation
    Add-DnsServerPrimaryZone -NetworkID '10.0.0.0/16' -ReplicationScope 'Forest' 
    #DNS Host entry for the nlb.contoso.com website 
    Add-DnsServerResourceRecordA -Name 'nlb' -ZoneName $using:FQDNDomainName -IPv4Address '10.0.0.101' -CreatePtr
    #Installing DFS-R on IIS servers for the shared configuration
    #Install-WindowsFeature FS-DFS-Replication -includeManagementTools

    #Removing any DFS Replication group with the same name
    Get-DfsReplicationGroup -GroupName 'IIS Shared Configuration' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders
    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'IIS Shared Configuration' |
    New-DfsReplicatedFolder -FolderName 'C:\IISSharedConfiguration' |
    Add-DfsrMember -ComputerName IISNODE01, IISNODE02
    #Adding the member (replication in both ways)
    Add-DfsrConnection -GroupName 'IIS Shared Configuration' -SourceComputerName 'IISNODE01' -DestinationComputerName 'IISNODE02'
    #Adding the members and specifiyng the primary server
    Set-DfsrMembership -GroupName 'IIS Shared Configuration' -FolderName 'C:\IISSharedConfiguration' -ContentPath 'C:\IISSharedConfiguration' -ComputerName 'IISNODE01' -PrimaryMember $True -Force
    Set-DfsrMembership -GroupName 'IIS Shared Configuration' -FolderName 'C:\IISSharedConfiguration' -ContentPath 'C:\IISSharedConfiguration' -ComputerName 'IISNODE02' -Force

    #Removing any DFS Replication group with the same name
    Get-DfsReplicationGroup -GroupName 'IIS Shared Configuration' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders
    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'IIS Shared Configuration' |
    New-DfsReplicatedFolder -FolderName 'C:\IISSharedConfiguration' |
    Get-DfsReplicationGroup -GroupName 'Central Certificate Store' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders

    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'Central Certificate Store' |
    New-DfsReplicatedFolder -FolderName 'C:\CentralCertificateStore' |
    Add-DfsrMember -ComputerName IISNODE01, IISNODE02
    #Adding the member (replication in both ways)
    Add-DfsrConnection -GroupName 'Central Certificate Store' -SourceComputerName 'IISNODE01' -DestinationComputerName 'IISNODE02'
    #Adding the members and specifiyng the primary server
    Set-DfsrMembership -GroupName 'Central Certificate Store' -FolderName 'C:\CentralCertificateStore' -ContentPath 'C:\CentralCertificateStore' -ComputerName 'IISNODE01' -PrimaryMember $True -Force
    Set-DfsrMembership -GroupName 'Central Certificate Store' -FolderName 'C:\CentralCertificateStore' -ContentPath 'C:\CentralCertificateStore' -ComputerName 'IISNODE02' -Force

    #Setting SPN on the Application Pool Identity
    setspn.exe -S "HTTP/$using:WebSiteName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/nlb" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE01.$using:FQDNDomainName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE01" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE02.$using:FQDNDomainName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE02" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
)
VERBOSE: [09:33:46][Write-ScreenInfo] Executing lab command activity: 'DNS & DFS-R Setup on DC' on machines 'DC01'
VERBOSE: [09:33:46][Write-ScreenInfo] 09:33:46|00:36:18|00:00:00.002| Executing lab command activity: 'DNS & DFS-R Setup on DC' on machines 'DC01'
09:33:46|00:36:18|00:00:00.002| Executing lab command activity: 'DNS & DFS-R Setup on DC' on machines 'DC01'
VERBOSE: [09:33:46][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:46][Write-ScreenInfo] 09:33:46|00:36:19|00:00:00.083| - Waiting for completion
09:33:46|00:36:19|00:00:00.083| - Waiting for completion
VERBOSE: [09:33:46][Invoke-LabCommand] Executing lab command activity 'DNS & DFS-R Setup on DC' on machines 'DC01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=DC01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=DC01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:100)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:168)
VERBOSE: [09:33:47][Invoke-LabCommand] Creating session to computer(s) 'DC01'
VERBOSE: New-LabPSSession Entering... (ComputerName=DC01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=DC01,IncludeLinux=True)
VERBOSE: [09:33:47][New-LabPSSession] Connecting to machine 'DC01' using the DNS name 'DC01'
VERBOSE: [09:33:47][New-LabPSSession] Creating a new PSSession to machine 'DC01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=DC01)
VERBOSE: [09:33:47][New-LabPSSession] Session DC01_bd9b9a06-004d-4e72-b8bc-20e8b43eb891 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 17'...(Time elapsed: 00:00:00:082)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=DC01,Retries=3,PassThru=<null>,ScriptBlock=
    New-ADUser -Name "$Using:IISAppPoolUser" -PasswordNeverExpires $True -AccountPassword $Using:SecurePassword -CannotChangePassword $True -Enabled $True

    #Reverse lookup zone creation
    Add-DnsServerPrimaryZone -NetworkID '10.0.0.0/16' -ReplicationScope 'Forest' 
    #DNS Host entry for the nlb.contoso.com website 
    Add-DnsServerResourceRecordA -Name 'nlb' -ZoneName $using:FQDNDomainName -IPv4Address '10.0.0.101' -CreatePtr
    #Installing DFS-R on IIS servers for the shared configuration
    #Install-WindowsFeature FS-DFS-Replication -includeManagementTools

    #Removing any DFS Replication group with the same name
    Get-DfsReplicationGroup -GroupName 'IIS Shared Configuration' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders
    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'IIS Shared Configuration' |
    New-DfsReplicatedFolder -FolderName 'C:\IISSharedConfiguration' |
    Add-DfsrMember -ComputerName IISNODE01, IISNODE02
    #Adding the member (replication in both ways)
    Add-DfsrConnection -GroupName 'IIS Shared Configuration' -SourceComputerName 'IISNODE01' -DestinationComputerName 'IISNODE02'
    #Adding the members and specifiyng the primary server
    Set-DfsrMembership -GroupName 'IIS Shared Configuration' -FolderName 'C:\IISSharedConfiguration' -ContentPath 'C:\IISSharedConfiguration' -ComputerName 'IISNODE01' -PrimaryMember $True -Force
    Set-DfsrMembership -GroupName 'IIS Shared Configuration' -FolderName 'C:\IISSharedConfiguration' -ContentPath 'C:\IISSharedConfiguration' -ComputerName 'IISNODE02' -Force

    #Removing any DFS Replication group with the same name
    Get-DfsReplicationGroup -GroupName 'IIS Shared Configuration' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders
    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'IIS Shared Configuration' |
    New-DfsReplicatedFolder -FolderName 'C:\IISSharedConfiguration' |
    Get-DfsReplicationGroup -GroupName 'Central Certificate Store' | Remove-DfsReplicationGroup -Force -RemoveReplicatedFolders

    #Creating the DFS Replication group for the shared configuration
    New-DfsReplicationGroup -GroupName 'Central Certificate Store' |
    New-DfsReplicatedFolder -FolderName 'C:\CentralCertificateStore' |
    Add-DfsrMember -ComputerName IISNODE01, IISNODE02
    #Adding the member (replication in both ways)
    Add-DfsrConnection -GroupName 'Central Certificate Store' -SourceComputerName 'IISNODE01' -DestinationComputerName 'IISNODE02'
    #Adding the members and specifiyng the primary server
    Set-DfsrMembership -GroupName 'Central Certificate Store' -FolderName 'C:\CentralCertificateStore' -ContentPath 'C:\CentralCertificateStore' -ComputerName 'IISNODE01' -PrimaryMember $True -Force
    Set-DfsrMembership -GroupName 'Central Certificate Store' -FolderName 'C:\CentralCertificateStore' -ContentPath 'C:\CentralCertificateStore' -ComputerName 'IISNODE02' -Force

    #Setting SPN on the Application Pool Identity
    setspn.exe -S "HTTP/$using:WebSiteName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/nlb" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE01.$using:FQDNDomainName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE01" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE02.$using:FQDNDomainName" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
    setspn.exe -S "HTTP/IISNODE02" "$using:NetBiosDomainName\$Using:IISAppPoolUser"
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=DNS & DFS-R Setup on DC)
VERBOSE: [09:33:48][Invoke-LWCommand] Starting Activity 'DNS & DFS-R Setup on DC'
VERBOSE: [09:33:51][Invoke-LWCommand] The Output of the task on machine 'DC01' will be available in the variable 'AL_9b45bd05-062b-4c4e-9e9a-5cb851490f14'
VERBOSE: [09:33:51][Invoke-LWCommand] Finished Installation Activity 'DNS & DFS-R Setup on DC'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:03:509)
VERBOSE: [09:33:51][Write-ScreenInfo] Activity done
VERBOSE: [09:33:51][Write-ScreenInfo] 09:33:51|00:36:24|00:00:05.426| - Activity done
09:33:51|00:36:24|00:00:05.426| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:03:663)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers,ComputerName=System.Object[],ScriptBlock=

    #Installing and setting up DFS-R, NLB and Windows Authentication on IIS Servers
    #Install-WindowsFeature NLB, Web-CertProvider -includeManagementTools
    #Renaming the NIC and setting up the metric for NLB management
    Rename-NetAdapter -Name "$using:labName 0" -NewName 'Internal' -PassThru | Set-NetIPInterface -InterfaceMetric 1
    Rename-NetAdapter -Name "$using:labName 1" -NewName 'NLB' -PassThru | Set-NetIPInterface -InterfaceMetric 2
    #Creating replicated folder for shared configuration
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    Enable-WebCentralCertProvider -CertStoreLocation 'C:\CentralCertificateStore\' -UserName $Using:Logon -Password $Using:ClearTextPassword -PrivateKeyPassword $Using:ClearTextPassword
)
VERBOSE: [09:33:52][Write-ScreenInfo] Executing lab command activity: 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:52][Write-ScreenInfo] 09:33:52|00:36:24|00:00:00.001| Executing lab command activity: 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers' on machines 'IISNODE01, IISNODE02'
09:33:52|00:36:24|00:00:00.001| Executing lab command activity: 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:33:52][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:52][Write-ScreenInfo] 09:33:52|00:36:25|00:00:00.088| - Waiting for completion
09:33:52|00:36:25|00:00:00.088| - Waiting for completion
VERBOSE: [09:33:52][Invoke-LabCommand] Executing lab command activity 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers' on machines 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:123)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:184)
VERBOSE: [09:33:53][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01 IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:33:53][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:53][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:53][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: [09:33:53][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:33:53][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:33:54][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26, 27'...(Time elapsed: 00:00:00:081)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=<null>,ScriptBlock=

    #Installing and setting up DFS-R, NLB and Windows Authentication on IIS Servers
    #Install-WindowsFeature NLB, Web-CertProvider -includeManagementTools
    #Renaming the NIC and setting up the metric for NLB management
    Rename-NetAdapter -Name "$using:labName 0" -NewName 'Internal' -PassThru | Set-NetIPInterface -InterfaceMetric 1
    Rename-NetAdapter -Name "$using:labName 1" -NewName 'NLB' -PassThru | Set-NetIPInterface -InterfaceMetric 2
    #Creating replicated folder for shared configuration
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    Enable-WebCentralCertProvider -CertStoreLocation 'C:\CentralCertificateStore\' -UserName $Using:Logon -Password $Using:ClearTextPassword -PrivateKeyPassword $Using:ClearTextPassword
,Session=System.Management.Automation.Runspaces.PSSession[](2),RetryIntervalInSeconds=10,ActivityName=NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers)
VERBOSE: [09:33:54][Invoke-LWCommand] Starting Activity 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers'
VERBOSE: [09:33:55][Invoke-LWCommand] The Output of the task on machine 'IISNODE01 IISNODE02' will be available in the variable 'AL_f882f420-e33f-4fc8-a196-fac6230bc245'
VERBOSE: [09:33:55][Invoke-LWCommand] Finished Installation Activity 'NLB, IIS Central Certificate Store and IIS Shared Configuration Setup on IIS servers'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:01:726)
VERBOSE: [09:33:56][Write-ScreenInfo] Activity done
VERBOSE: [09:33:56][Write-ScreenInfo] 09:33:56|00:36:28|00:00:03.882| - Activity done
09:33:56|00:36:28|00:00:03.882| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:01:874)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=NLB Setup,ComputerName=IISNODE01,ScriptBlock=
    #Creating new NLB cluster
    New-NlbCluster -HostName IISNODE01 -ClusterName "$using:WebSiteName" -InterfaceName NLB -ClusterPrimaryIP 10.0.0.101 -SubnetMask 255.255.0.0 -OperationMode 'Multicast'
    #Removing default port rule for the new cluster
    #Get-NlbClusterPortRule -HostName . | Remove-NlbClusterPortRule -Force
    #Adding port rules
    #Add-NlbClusterPortRule -Protocol Tcp -Mode Multiple -Affinity Single -StartPort 80 -EndPort 80 -InterfaceName $InterfaceName | Out-Null
    #Add-NlbClusterPortRule -Protocol Tcp -Mode Multiple -Affinity Single -StartPort 443 -EndPort 443 -InterfaceName $InterfaceName | Out-Null
    #Adding the second node to the cluster
    Get-NlbCluster | Add-NlbClusterNode -NewNodeName IISNODE02 -NewNodeInterface NLB
    #Client Affinity: Do not enable it to see the load balacing between the two IIS Servers    
    Get-NlbClusterPortRule | Set-NlbClusterPortRule -NewAffinity None
)
VERBOSE: [09:33:56][Write-ScreenInfo] Executing lab command activity: 'NLB Setup' on machines 'IISNODE01'
VERBOSE: [09:33:56][Write-ScreenInfo] 09:33:56|00:36:29|00:00:00.001| Executing lab command activity: 'NLB Setup' on machines 'IISNODE01'
09:33:56|00:36:29|00:00:00.001| Executing lab command activity: 'NLB Setup' on machines 'IISNODE01'
VERBOSE: [09:33:56][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:33:56][Write-ScreenInfo] 09:33:56|00:36:29|00:00:00.070| - Waiting for completion
09:33:56|00:36:29|00:00:00.070| - Waiting for completion
VERBOSE: [09:33:56][Invoke-LabCommand] Executing lab command activity 'NLB Setup' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:087)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:155)
VERBOSE: [09:33:57][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:33:58][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:33:58][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:33:58][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:074)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=
    #Creating new NLB cluster
    New-NlbCluster -HostName IISNODE01 -ClusterName "$using:WebSiteName" -InterfaceName NLB -ClusterPrimaryIP 10.0.0.101 -SubnetMask 255.255.0.0 -OperationMode 'Multicast'
    #Removing default port rule for the new cluster
    #Get-NlbClusterPortRule -HostName . | Remove-NlbClusterPortRule -Force
    #Adding port rules
    #Add-NlbClusterPortRule -Protocol Tcp -Mode Multiple -Affinity Single -StartPort 80 -EndPort 80 -InterfaceName $InterfaceName | Out-Null
    #Add-NlbClusterPortRule -Protocol Tcp -Mode Multiple -Affinity Single -StartPort 443 -EndPort 443 -InterfaceName $InterfaceName | Out-Null
    #Adding the second node to the cluster
    Get-NlbCluster | Add-NlbClusterNode -NewNodeName IISNODE02 -NewNodeInterface NLB
    #Client Affinity: Do not enable it to see the load balacing between the two IIS Servers    
    Get-NlbClusterPortRule | Set-NlbClusterPortRule -NewAffinity None
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=NLB Setup)
VERBOSE: [09:33:58][Invoke-LWCommand] Starting Activity 'NLB Setup'
VERBOSE: [09:35:12][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_ace69df7-433c-4d04-ad4a-8a081ad580ff'
VERBOSE: [09:35:12][Invoke-LWCommand] Finished Installation Activity 'NLB Setup'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:01:14:443)
VERBOSE: [09:35:12][Write-ScreenInfo] Activity done
VERBOSE: [09:35:12][Write-ScreenInfo] 09:35:12|00:37:45|00:01:16.292| - Activity done
09:35:12|00:37:45|00:01:16.292| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:01:14:626)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=SNI/CSS and URL Rewrite Setup,ComputerName=System.Object[],ScriptBlock=
    Import-Module -Name WebAdministration
    #Adding a HTTP:443 Binding
    #0: Regular certificate in Windows certificate storage.
    #1: SNI certificate.
    #2: Central certificate store.
    #3: SNI certificate in central certificate store.
    #New-WebBinding -Name "$using:WebSiteName" -Port 443 -IPAddress * -Protocol https -sslFlags 3 -HostHeader "$using:WebSiteName"
    New-WebBinding -Name "$using:WebSiteName" -sslFlags 3 -Protocol https -HostHeader "$using:WebSiteName"
    New-Item -Path "IIS:\SslBindings\!443!$using:WebSiteName" -sslFlags 3 -Store CentralCertStore
    #Removing Default Binding
    #Get-WebBinding -Port 80 -Name "$using:WebSiteName" | Remove-WebBinding

    #Require SSL
    Get-IISConfigSection -SectionPath 'system.webServer/security/access' -Location "$using:WebSiteName" | Set-IISConfigAttributeValue -AttributeName sslFlags -AttributeValue Ssl

    #Adding and URL Rewrite rule to redirect http traffic to HTTPS
    Add-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter 'system.webserver/rewrite/globalRules' -name '.' -value @{
        name           = 'HTTP to HTTPS Redirect'
        patternSyntax  = 'Regular Expressions'
        stopProcessing = 'True'
    }
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webserver/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/match" -name url -value '(.*)'
    Add-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webserver/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/conditions" -name '.' -value @{
        input   = '{HTTPS}'
        pattern = '^OFF$'
    }
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'type' -value 'Redirect'
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'url' -value 'https://{HTTP_HOST}/{R:1}'
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'redirectType' -value 'Permanent' 
)
VERBOSE: [09:35:13][Write-ScreenInfo] Executing lab command activity: 'SNI/CSS and URL Rewrite Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:35:13][Write-ScreenInfo] 09:35:13|00:37:46|00:00:00.001| Executing lab command activity: 'SNI/CSS and URL Rewrite Setup' on machines 'IISNODE01, IISNODE02'
09:35:13|00:37:46|00:00:00.001| Executing lab command activity: 'SNI/CSS and URL Rewrite Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: [09:35:13][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:35:13][Write-ScreenInfo] 09:35:13|00:37:46|00:00:00.080| - Waiting for completion
09:35:13|00:37:46|00:00:00.080| - Waiting for completion
VERBOSE: [09:35:13][Invoke-LabCommand] Executing lab command activity 'SNI/CSS and URL Rewrite Setup' on machines 'IISNODE01, IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=System.Object[],AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=System.Object[])
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:157)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:231)
VERBOSE: [09:35:14][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01 IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=System.Object[],DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=System.Object[],IncludeLinux=True)
VERBOSE: [09:35:15][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:35:15][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:35:15][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: [09:35:15][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:35:15][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:35:15][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26, 27'...(Time elapsed: 00:00:00:083)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=System.Object[],Retries=3,PassThru=<null>,ScriptBlock=
    Import-Module -Name WebAdministration
    #Adding a HTTP:443 Binding
    #0: Regular certificate in Windows certificate storage.
    #1: SNI certificate.
    #2: Central certificate store.
    #3: SNI certificate in central certificate store.
    #New-WebBinding -Name "$using:WebSiteName" -Port 443 -IPAddress * -Protocol https -sslFlags 3 -HostHeader "$using:WebSiteName"
    New-WebBinding -Name "$using:WebSiteName" -sslFlags 3 -Protocol https -HostHeader "$using:WebSiteName"
    New-Item -Path "IIS:\SslBindings\!443!$using:WebSiteName" -sslFlags 3 -Store CentralCertStore
    #Removing Default Binding
    #Get-WebBinding -Port 80 -Name "$using:WebSiteName" | Remove-WebBinding

    #Require SSL
    Get-IISConfigSection -SectionPath 'system.webServer/security/access' -Location "$using:WebSiteName" | Set-IISConfigAttributeValue -AttributeName sslFlags -AttributeValue Ssl

    #Adding and URL Rewrite rule to redirect http traffic to HTTPS
    Add-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter 'system.webserver/rewrite/globalRules' -name '.' -value @{
        name           = 'HTTP to HTTPS Redirect'
        patternSyntax  = 'Regular Expressions'
        stopProcessing = 'True'
    }
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webserver/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/match" -name url -value '(.*)'
    Add-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webserver/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/conditions" -name '.' -value @{
        input   = '{HTTPS}'
        pattern = '^OFF$'
    }
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'type' -value 'Redirect'
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'url' -value 'https://{HTTP_HOST}/{R:1}'
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -filter "system.webServer/rewrite/globalRules/rule[@name='HTTP to HTTPS Redirect']/action" -name 'redirectType' -value 'Permanent' 
,Session=System.Management.Automation.Runspaces.PSSession[](2),RetryIntervalInSeconds=10,ActivityName=SNI/CSS and URL Rewrite Setup)
VERBOSE: [09:35:15][Invoke-LWCommand] Starting Activity 'SNI/CSS and URL Rewrite Setup'
VERBOSE: [09:35:23][Invoke-LWCommand] The Output of the task on machine 'IISNODE01 IISNODE02' will be available in the variable 'AL_d53aa7a9-d530-4150-8ca5-c34e939ff4d5'
VERBOSE: [09:35:23][Invoke-LWCommand] Finished Installation Activity 'SNI/CSS and URL Rewrite Setup'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:07:743)
VERBOSE: [09:35:23][Write-ScreenInfo] Activity done
VERBOSE: [09:35:23][Write-ScreenInfo] 09:35:23|00:37:56|00:00:10.141| - Activity done
09:35:23|00:37:56|00:00:10.141| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:07:894)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Exporting IIS Shared Configuration and Windows Authentication Setup,ComputerName=IISNODE01,ScriptBlock=
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    Import-Module -Name WebAdministration
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'identityType' -value 3
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'userName' -value "$Using:NetBiosDomainName\$Using:IISAppPoolUser"
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'password' -value $Using:ClearTextPassword

    #Disabling the Anonymous authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/anonymousAuthentication' -name 'enabled' -value 'False'
    #Enabling the Windows authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'enabled' -value 'True'

    #Enabling the Anonymous authentication for the healthcheck test page
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName/healthcheck.aspx" -filter 'system.webServer/security/authentication/anonymousAuthentication' -name 'enabled' -value 'True'
    #Disabling the Windows authentication for the healthcheck test page
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName/healthcheck.aspx" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'enabled' -value 'False'

    #Disabling validation for application pool in integrated mode due to ASP.Net impersonation incompatibility
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName"  -filter 'system.webServer/validation' -name 'validateIntegratedModeConfiguration' -value 'False' -verbose

    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Exporting the configuration
    Export-IISConfiguration -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
)
VERBOSE: [09:35:24][Write-ScreenInfo] Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: [09:35:24][Write-ScreenInfo] 09:35:24|00:37:57|00:00:00.001| Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
09:35:24|00:37:57|00:00:00.001| Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: [09:35:24][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:35:24][Write-ScreenInfo] 09:35:24|00:37:57|00:00:00.079| - Waiting for completion
09:35:24|00:37:57|00:00:00.079| - Waiting for completion
VERBOSE: [09:35:24][Invoke-LabCommand] Executing lab command activity 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:107)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:175)
VERBOSE: [09:35:25][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:35:25][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:35:25][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:35:25][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:083)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    Import-Module -Name WebAdministration
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'identityType' -value 3
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'userName' -value "$Using:NetBiosDomainName\$Using:IISAppPoolUser"
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST'  -filter "system.applicationHost/applicationPools/add[@name='$using:WebSiteName']/processModel" -name 'password' -value $Using:ClearTextPassword

    #Disabling the Anonymous authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/anonymousAuthentication' -name 'enabled' -value 'False'
    #Enabling the Windows authentication
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'enabled' -value 'True'

    #Enabling the Anonymous authentication for the healthcheck test page
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName/healthcheck.aspx" -filter 'system.webServer/security/authentication/anonymousAuthentication' -name 'enabled' -value 'True'
    #Disabling the Windows authentication for the healthcheck test page
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName/healthcheck.aspx" -filter 'system.webServer/security/authentication/windowsAuthentication' -name 'enabled' -value 'False'

    #Disabling validation for application pool in integrated mode due to ASP.Net impersonation incompatibility
    Set-WebConfigurationProperty -pspath 'MACHINE/WEBROOT/APPHOST' -location "$using:WebSiteName"  -filter 'system.webServer/validation' -name 'validateIntegratedModeConfiguration' -value 'False' -verbose

    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Exporting the configuration
    Export-IISConfiguration -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Exporting IIS Shared Configuration and Windows Authentication Setup)
VERBOSE: [09:35:26][Invoke-LWCommand] Starting Activity 'Exporting IIS Shared Configuration and Windows Authentication Setup'
VERBOSE: [09:35:34][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_fda65f8f-3ad8-42c1-9aa9-82df0185aba4'
VERBOSE: [09:35:34][Invoke-LWCommand] Finished Installation Activity 'Exporting IIS Shared Configuration and Windows Authentication Setup'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:08:427)
VERBOSE: [09:35:34][Write-ScreenInfo] Activity done
VERBOSE: [09:35:34][Write-ScreenInfo] 09:35:34|00:38:07|00:00:10.341| - Activity done
09:35:34|00:38:07|00:00:10.341| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:08:574)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Exporting IIS Shared Configuration and Windows Authentication Setup,ComputerName=IISNODE01,ScriptBlock=
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Exporting the configuration
    Export-IISConfiguration -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
    Enable-IISSharedConfig  -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
)
VERBOSE: [09:35:35][Write-ScreenInfo] Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: [09:35:35][Write-ScreenInfo] 09:35:35|00:38:07|00:00:00.000| Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
09:35:35|00:38:07|00:00:00.000| Executing lab command activity: 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: [09:35:35][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:35:35][Write-ScreenInfo] 09:35:35|00:38:08|00:00:00.078| - Waiting for completion
09:35:35|00:38:08|00:00:00.078| - Waiting for completion
VERBOSE: [09:35:35][Invoke-LabCommand] Executing lab command activity 'Exporting IIS Shared Configuration and Windows Authentication Setup' on machines 'IISNODE01'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE01,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE01)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:137)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:204)
VERBOSE: [09:35:36][Invoke-LabCommand] Creating session to computer(s) 'IISNODE01'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE01,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01,IncludeLinux=True)
VERBOSE: [09:35:36][New-LabPSSession] Connecting to machine 'IISNODE01' using the DNS name 'IISNODE01'
VERBOSE: [09:35:36][New-LabPSSession] Creating a new PSSession to machine 'IISNODE01:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE01)
VERBOSE: [09:35:36][New-LabPSSession] Session IISNODE01_81cfe57b-9f77-4ac1-8304-c24a35022688 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 26'...(Time elapsed: 00:00:00:116)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE01,Retries=3,PassThru=<null>,ScriptBlock=
    #Changing the application pool identity for an AD Account : mandatory for Kerberos authentication
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Exporting the configuration
    Export-IISConfiguration -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
    Enable-IISSharedConfig  -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Exporting IIS Shared Configuration and Windows Authentication Setup)
VERBOSE: [09:35:37][Invoke-LWCommand] Starting Activity 'Exporting IIS Shared Configuration and Windows Authentication Setup'
VERBOSE: [09:35:37][Invoke-LWCommand] The Output of the task on machine 'IISNODE01' will be available in the variable 'AL_57203873-aad9-4e7e-8a94-4118c5a9c97b'
VERBOSE: [09:35:37][Invoke-LWCommand] Finished Installation Activity 'Exporting IIS Shared Configuration and Windows Authentication Setup'
VERBOSE: Invoke-LWCommand...leaving - return value is 'System.Management.Automation.PSVariable'...(Time elapsed: 00:00:00:429)
VERBOSE: [09:35:37][Write-ScreenInfo] Activity done
VERBOSE: [09:35:37][Write-ScreenInfo] 09:35:37|00:38:10|00:00:02.502| - Activity done
09:35:37|00:38:10|00:00:02.502| - Activity done
VERBOSE: Invoke-LabCommand...leaving...(Time elapsed: 00:00:00:585)
VERBOSE: Invoke-LabCommand Entering... (ActivityName=Enabling IIS Shared Configuration on IIS servers,ComputerName=IISNODE02,ScriptBlock=
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Enabling the shared configuration
    While (-not(Test-Path -Path C:\IISSharedConfiguration\applicationHost.config))
    {
        Write-Verbose -Message 'Waiting the replication via DFS-R of applicationHost.config. Sleeping 10 seconds ...'
        Start-Sleep -Seconds 10
    }
    Enable-IISSharedConfig  -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
)
VERBOSE: [09:35:38][Write-ScreenInfo] Executing lab command activity: 'Enabling IIS Shared Configuration on IIS servers' on machines 'IISNODE02'
VERBOSE: [09:35:38][Write-ScreenInfo] 09:35:38|00:38:11|00:00:00.001| Executing lab command activity: 'Enabling IIS Shared Configuration on IIS servers' on machines 'IISNODE02'
09:35:38|00:38:11|00:00:00.001| Executing lab command activity: 'Enabling IIS Shared Configuration on IIS servers' on machines 'IISNODE02'
VERBOSE: [09:35:38][Write-ScreenInfo] Waiting for completion
VERBOSE: [09:35:38][Write-ScreenInfo] 09:35:38|00:38:11|00:00:00.075| - Waiting for completion
09:35:38|00:38:11|00:00:00.075| - Waiting for completion
VERBOSE: [09:35:38][Invoke-LabCommand] Executing lab command activity 'Enabling IIS Shared Configuration on IIS servers' on machines 'IISNODE02'
VERBOSE: Get-LabVM Entering... (IncludeLinux=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LabVMStatus Entering... (ComputerName=IISNODE02,AsHashTable=True)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: Get-LWHypervVMStatus Entering... (ComputerName=IISNODE02)
VERBOSE: Get-LWHypervVMStatus...leaving...(Time elapsed: 00:00:00:113)
VERBOSE: Get-LabVMStatus...leaving...(Time elapsed: 00:00:00:185)
VERBOSE: [09:35:39][Invoke-LabCommand] Creating session to computer(s) 'IISNODE02'
VERBOSE: New-LabPSSession Entering... (ComputerName=IISNODE02,DoNotUseCredSsp=<null>,UseLocalCredential=<null>,Credential=<null>)
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02,IncludeLinux=True)
VERBOSE: [09:35:39][New-LabPSSession] Connecting to machine 'IISNODE02' using the DNS name 'IISNODE02'
VERBOSE: [09:35:39][New-LabPSSession] Creating a new PSSession to machine 'IISNODE02:5985' (UserName='contoso.com\Administrator', Password='P@ssw0rd', DoNotUseCredSsp='False')
VERBOSE: Get-LabVM Entering... (ComputerName=IISNODE02)
VERBOSE: [09:35:39][New-LabPSSession] Session IISNODE02_f6ef556e-39a7-42ef-a21f-4fb994e11c95 is available and will be reused
VERBOSE: New-LabPSSession...leaving - return value is 'Session IDs: 27'...(Time elapsed: 00:00:00:072)
VERBOSE: Invoke-LWCommand Entering... (AsJob=<null>,Verbose=True,ComputerName=IISNODE02,Retries=3,PassThru=<null>,ScriptBlock=
    New-Item -Path C:\IISSharedConfiguration -ItemType Directory -Force
    #Enabling the shared configuration
    While (-not(Test-Path -Path C:\IISSharedConfiguration\applicationHost.config))
    {
        Write-Verbose -Message 'Waiting the replication via DFS-R of applicationHost.config. Sleeping 10 seconds ...'
        Start-Sleep -Seconds 10
    }
    Enable-IISSharedConfig  -PhysicalPath C:\IISSharedConfiguration -KeyEncryptionPassword $Using:SecurePassword -Force
,Session=System.Management.Automation.Runspaces.PSSession[](1),RetryIntervalInSeconds=10,ActivityName=Enabling IIS Shared Configuration on IIS servers)
VERBOSE: [09:35:40][Invoke-LWCommand] Starting Activity 'Enabling IIS Shared Configuration on IIS servers'
**********************
Command start time: 20191213094454
**********************
PS>TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
Transcript started, output file is C:\Users\lavanack\OneDrive - Microsoft\Source Control\GitHub\laurentvanacker.com\PowerShell\IIS\AutomatedLab\NLB & IIS\AutomatedLab - NLB & IIS_20191213094700.txt
**********************
Command start time: 20191213094702
**********************
PS C:\WINDOWS\system32> CommandInvocation(Remove-PSBreakpoint): "Remove-PSBreakpoint"
>> ParameterBinding(Remove-PSBreakpoint): name="Id"; value="0"
VERBOSE: Import-Lab Entering... (Path=C:\ProgramData\AutomatedLab\Labs\NLBIISLab\Lab.xml,ErrorAction=<null>,PassThru=True)
VERBOSE: Clear-Lab Entering... )
VERBOSE: Clear-Lab...leaving...(Time elapsed: 00:00:00:086)
